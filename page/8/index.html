<!DOCTYPE html>












  


<html class="theme-next muse use-motion" lang="English">
<head><meta name="generator" content="Hexo 3.9.0">
  <!-- hexo-inject:begin --><!-- hexo-inject:end --><meta charset="UTF-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=2">
<meta name="theme-color" content="#222">












<meta http-equiv="Cache-Control" content="no-transform">
<meta http-equiv="Cache-Control" content="no-siteapp">






















<link href="/lib/font-awesome/css/font-awesome.min.css?v=4.6.2" rel="stylesheet" type="text/css">

<link href="/css/main.css?v=6.3.0" rel="stylesheet" type="text/css">


  <link rel="apple-touch-icon" sizes="180x180" href="/images/logo3d.png?v=6.3.0">


  <link rel="icon" type="image/png" sizes="32x32" href="/images/logo3d_32X32.png?v=6.3.0">


  <link rel="icon" type="image/png" sizes="16x16" href="/images/logo3d_16x16.png?v=6.3.0">


  <link rel="mask-icon" href="/images/logo3d.svg?v=6.3.0" color="#222">









<script type="text/javascript" id="hexo.configurations">
  var NexT = window.NexT || {};
  var CONFIG = {
    root: '/',
    scheme: 'Muse',
    version: '6.3.0',
    sidebar: {"position":"left","display":"post","offset":12,"b2t":false,"scrollpercent":false,"onmobile":false},
    fancybox: false,
    fastclick: false,
    lazyload: false,
    tabs: true,
    motion: {"enable":true,"async":false,"transition":{"post_block":"fadeIn","post_header":"slideDownIn","post_body":"slideDownIn","coll_header":"slideLeftIn","sidebar":"slideUpIn"}},
    algolia: {
      applicationID: '',
      apiKey: '',
      indexName: '',
      hits: {"per_page":10},
      labels: {"input_placeholder":"Search for Posts","hits_empty":"We didn't find any results for the search: ${query}","hits_stats":"${hits} results found in ${time} ms"}
    }
  };
</script>


  




  <meta name="description" content="Longer Vision Technology Github Blog">
<meta name="keywords" content="Longer Vision, Computer Vision, AI, Machine Learning">
<meta property="og:type" content="website">
<meta property="og:title" content="Longer Vision Technology">
<meta property="og:url" content="http://longervision.ca/page/8/index.html">
<meta property="og:site_name" content="Longer Vision Technology">
<meta property="og:description" content="Longer Vision Technology Github Blog">
<meta property="og:locale" content="English">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="Longer Vision Technology">
<meta name="twitter:description" content="Longer Vision Technology Github Blog">






  <link rel="canonical" href="http://longervision.ca/page/8/">



<script type="text/javascript" id="page.configurations">
  CONFIG.page = {
    sidebar: "",
  };
</script>

  <title>Longer Vision Technology</title>
  









  <noscript>
  <style type="text/css">
    .use-motion .motion-element,
    .use-motion .brand,
    .use-motion .menu-item,
    .sidebar-inner,
    .use-motion .post-block,
    .use-motion .pagination,
    .use-motion .comments,
    .use-motion .post-header,
    .use-motion .post-body,
    .use-motion .collection-title { opacity: initial; }

    .use-motion .logo,
    .use-motion .site-title,
    .use-motion .site-subtitle {
      opacity: initial;
      top: initial;
    }

    .use-motion {
      .logo-line-before i { left: initial; }
      .logo-line-after i { right: initial; }
    }
  </style>
</noscript><!-- hexo-inject:begin --><!-- hexo-inject:end -->

</head>

<body itemscope itemtype="http://schema.org/WebPage" lang="English">

  
  
    
  

  <!-- hexo-inject:begin --><!-- hexo-inject:end --><div class="container sidebar-position-left 
  page-home">
    <div class="headband"></div>

    <header id="header" class="header" itemscope itemtype="http://schema.org/WPHeader">
      <div class="header-inner"><div class="site-brand-wrapper">
  <div class="site-meta ">
    

    <div class="custom-logo-site-title">
      <a href="/" class="brand" rel="start">
        <span class="logo-line-before"><i></i></span>
        <span class="site-title">Longer Vision Technology</span>
        <span class="logo-line-after"><i></i></span>
      </a>
    </div>
    
      
        <p class="site-subtitle">Github Blog</p>
      
    
  </div>

  <div class="site-nav-toggle">
    <button aria-label="Toggle navigation bar">
      <span class="btn-bar"></span>
      <span class="btn-bar"></span>
      <span class="btn-bar"></span>
    </button>
  </div>
</div>



<nav class="site-nav">
  
    <ul id="menu" class="menu">
      
        
        
        
          
          <li class="menu-item menu-item-home">
    <a href="/" rel="section">
      <i class="menu-item-icon fa fa-fw fa-home"></i> <br>Home</a>
  </li>
        
        
        
          
          <li class="menu-item menu-item-archives">
    <a href="/archives/" rel="section">
      <i class="menu-item-icon fa fa-fw fa-archive"></i> <br>Archives</a>
  </li>
        
        
        
          
          <li class="menu-item menu-item-categories">
    <a href="/categories/" rel="section">
      <i class="menu-item-icon fa fa-fw fa-th"></i> <br>Categories</a>
  </li>
        
        
        
          
          <li class="menu-item menu-item-tags">
    <a href="/tags/" rel="section">
      <i class="menu-item-icon fa fa-fw fa-tags"></i> <br>Tags</a>
  </li>
        
        
        
          
          <li class="menu-item menu-item-about">
    <a href="/about/" rel="section">
      <i class="menu-item-icon fa fa-fw fa-user"></i> <br>About</a>
  </li>

      
      
    </ul>
  

  
    

  

  
</nav>



  



</div>
    </header>

    


    <main id="main" class="main">
      <div class="main-inner">
        <div class="content-wrap">
          
          <div id="content" class="content">
            
  <section id="posts" class="posts-expand">
    
      

  

  
  
  

  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://longervision.ca/2018/02/24/SBCs/ARM/nanopi-neo-armbian/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="Nobody">
      <meta itemprop="description" content="Longer Vision Technology Github Blog">
      <meta itemprop="image" content="/images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Longer Vision Technology">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2018/02/24/SBCs/ARM/nanopi-neo-armbian/" itemprop="url">
                  Install Armbian Debian Server onto NanoPi NEO
                </a>
              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">

            
            
            

            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">Posted on</span>
              

              
                
              

              <time title="Created: 2018-02-24 00:00:00" itemprop="dateCreated datePublished" datetime="2018-02-24T00:00:00-08:00">2018-02-24</time>
            

            
              

              
                
                <span class="post-meta-divider">|</span>
                

                <span class="post-meta-item-icon">
                  <i class="fa fa-calendar-check-o"></i>
                </span>
                
                  <span class="post-meta-item-text">Edited on</span>
                
                <time title="Modified: 2020-04-05 21:32:49" itemprop="dateModified" datetime="2020-04-05T21:32:49-07:00">2020-04-05</time>
              
            
          </span>

          
            <span class="post-category">
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">In</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing"><a href="/categories/Single-Board-Computers/" itemprop="url" rel="index"><span itemprop="name">Single Board Computers</span></a></span>

                
                
                  , 
                
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing"><a href="/categories/Single-Board-Computers/ARM/" itemprop="url" rel="index"><span itemprop="name">ARM</span></a></span>

                
                
              
            </span>
          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <p>Hi, all, I flied back and forth between ShenZhen China and Vancouver Canada in January 2018, and took a holiday break in California USA during Chinese Spring Festival in Febrary 2018. Now, I’m back to Vancouver and write this blog. Today, we are going to talk about how to flash the most recent <a href="https://www.kernel.org/" target="_blank" rel="noopener">Linux Kernel</a> onto an <a href="http://www.friendlyarm.net/products/nanopi-neo" target="_blank" rel="noopener">NanoPi NEO</a>. The board looks like (cited from <a href="http://wiki.friendlyarm.com/wiki/index.php/NanoPi_NEO" target="_blank" rel="noopener">NanoPi NEO</a> ):</p>
<p><img src="https://raw.githubusercontent.com/LongerVision/BSP/master/Embedded/AllWinner/nanopi/NEO_H3.jpg" alt="NanoPi NEO"></p>
<p>Different from <a href="../../../../../2018/01/10/SBC/beaglebone-black-uboot-kernel/">our previous blog</a> where <a href="http://www.denx.de/wiki/U-Boot/WebHome" target="_blank" rel="noopener">U-Boot</a> and <a href="https://www.kernel.org/" target="_blank" rel="noopener">Linux Kernel</a> are manually built, here, we download and install the <a href="https://www.armbian.com/nanopi-neo/" target="_blank" rel="noopener">built Ubuntu from Armbian</a> directly.</p>
<p>Before starting, the following paragraph is cited to explain the relationships among <a href="http://allwinnertech.com/" target="_blank" rel="noopener">AllWinner</a>, <a href="http://linux-sunxi.org/Allwinner" target="_blank" rel="noopener">Sunxi</a> and <a href="https://www.linaro.org/" target="_blank" rel="noopener">Linaro</a>.</p>
<blockquote>
<p>In march 2014, <a href="http://allwinnertech.com/" target="_blank" rel="noopener">Allwinner</a> joined Linaro as part of the new linaro digital home group. After this, <a href="http://allwinnertech.com/" target="_blank" rel="noopener">Allwinner</a> stopped communicating with the <a href="http://linux-sunxi.org/Allwinner" target="_blank" rel="noopener">sunxi community</a>, as linaro membership apparently satisfies the marketing need to be seen as an open source friendly company. Despite <a href="https://www.linaro.org/" target="_blank" rel="noopener">Linaro</a> membership, <a href="http://allwinnertech.com/" target="_blank" rel="noopener">Allwinner</a> still violates the <a href="http://www.gnu.org/licenses/gpl-3.0.en.html" target="_blank" rel="noopener">GPL</a> on many counts. (cited from <a href="http://linux-sunxi.org/Allwinner" target="_blank" rel="noopener">http://linux-sunxi.org/Allwinner</a> .)</p>
</blockquote>
<h1 id="part-a-install-debian-server-built-by-armbian-onto-nanopi-neo"><a class="markdownIt-Anchor" href="#part-a-install-debian-server-built-by-armbian-onto-nanopi-neo"></a> PART A: Install Debian Server Built By Armbian onto NanoPi NEO</h1>
<h2 id="1-download-armbian-debian-server-for-nanopi-neo"><a class="markdownIt-Anchor" href="#1-download-armbian-debian-server-for-nanopi-neo"></a> 1. Download Armbian Debian Server for NanoPi NEO</h2>
<p>We <strong>FIRST</strong> go visiting the website <a href="https://www.armbian.com/nanopi-neo/" target="_blank" rel="noopener">https://www.armbian.com/nanopi-neo/</a> and click <strong>Debian server – mainline kernel</strong> icon, a file named <strong>Armbian_5.38_Nanopineo_Debian_stretch_next_4.14.14.7z</strong> will be automatically downloaded.</p>
<p>Then, we extract this .<strong>7z</strong> file by</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line">$ 7za e Armbian_5.38_Nanopineo_Debian_stretch_next_4.14.14.7z</span><br><span class="line"></span><br><span class="line">7-Zip (A) [64] 9.20  Copyright (c) 1999-2010 Igor Pavlov  2010-11-18</span><br><span class="line">p7zip Version 9.20 (locale=en_CA.UTF-8,Utf16=on,HugeFiles=on,8 CPUs)</span><br><span class="line"></span><br><span class="line">Processing archive: Armbian_5.38_Nanopineo_Debian_stretch_next_4.14.14.7z</span><br><span class="line"></span><br><span class="line">Extracting  Armbian_5.38_Nanopineo_Debian_stretch_next_4.14.14.img</span><br><span class="line">Extracting  armbian.txt</span><br><span class="line">Extracting  armbian.txt.asc</span><br><span class="line">Extracting  Armbian_5.38_Nanopineo_Debian_stretch_next_4.14.14.img.asc</span><br><span class="line">Extracting  sha256sum.sha</span><br><span class="line"></span><br><span class="line">Everything is Ok</span><br><span class="line"></span><br><span class="line">Files: 5</span><br><span class="line">Size:       1396723567</span><br><span class="line">Compressed: 256174798</span><br></pre></td></tr></table></figure>
<h2 id="2-install-armbian-debian-server-for-nanopi-neo"><a class="markdownIt-Anchor" href="#2-install-armbian-debian-server-for-nanopi-neo"></a> 2. Install Armbian Debian Server for NanoPi NEO</h2>
<p>After the extracted image file is prepared, it’s the time to install the Armbian Debian Server onto our TF card. We <strong>FIRST</strong> format the TF card:</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">$ sudo mkfs.ext4 /dev/mmcblk0 </span><br><span class="line">[sudo] password <span class="keyword">for</span> jiapei: </span><br><span class="line">mke2fs 1.42.13 (17-May-2015)</span><br><span class="line">Found a dos partition table <span class="keyword">in</span> /dev/mmcblk0</span><br><span class="line">Proceed anyway? (y,n) y</span><br><span class="line">Discarding device blocks: <span class="keyword">done</span>                            </span><br><span class="line">Creating filesystem with 3942144 4k blocks and 987360 inodes</span><br><span class="line">Filesystem UUID: bf3f62c9-283d-48fe-a0f3-56ab357f7b94</span><br><span class="line">Superblock backups stored on blocks: </span><br><span class="line">        32768, 98304, 163840, 229376, 294912, 819200, 884736, 1605632, 2654208</span><br><span class="line"></span><br><span class="line">Allocating group tables: <span class="keyword">done</span>                            </span><br><span class="line">Writing inode tables: <span class="keyword">done</span>                            </span><br><span class="line">Creating journal (32768 blocks): <span class="keyword">done</span></span><br></pre></td></tr></table></figure>
<p>Afterwards, use <strong>dd</strong> to install the downloaded Armbian Ubuntu Desktop image.</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">$ sudo dd bs=4M <span class="keyword">if</span>=Armbian_5.38_Nanopineo_Debian_stretch_next_4.14.14.img of=/dev/mmcblk0 conv=fsync</span><br><span class="line">[sudo] password <span class="keyword">for</span> jiapei: </span><br><span class="line">333+0 records <span class="keyword">in</span></span><br><span class="line">333+0 records out</span><br><span class="line">1396703232 bytes (1.4 GB, 1.3 GiB) copied, 157.712 s, 8.9 MB/s</span><br></pre></td></tr></table></figure>
<h1 id="part-b-boot-into-armbian-network-configuration-and-armbian-upgrading"><a class="markdownIt-Anchor" href="#part-b-boot-into-armbian-network-configuration-and-armbian-upgrading"></a> PART B: Boot Into Armbian, Network Configuration and Armbian Upgrading</h1>
<p>As known, <a href="http://www.friendlyarm.net/products/nanopi-neo" target="_blank" rel="noopener">NanoPi NEO</a> comes with <strong>NEITHER</strong> a <strong>HDMI</strong> interface for display, <strong>NOR</strong> a <strong>Wifi</strong> interface for wireless network connection. Therefore, we may have to find a wired cable, and connect our <a href="http://www.friendlyarm.net/products/nanopi-neo" target="_blank" rel="noopener">NanoPi NEO</a> to a router, which also connects with our host computer. Afterwards, we’ll have to find our <a href="http://www.friendlyarm.net/products/nanopi-neo" target="_blank" rel="noopener">NanoPi NEO</a> connection via router settings. Here in my case, I’m using a <a href="https://www.cogeco.ca/web/resources/pdf/support/user_guides/internet/cisco_wireless_residential_gateway_model_DPC3848_DPC3848V_DPC3848VM_DOCSIS_3_0.pdf" target="_blank" rel="noopener">Cisco DPC3848V DOCSIS 3.0 Gateway</a>, with the <strong>gateway IP: 192.168.0.1</strong>. By visiting <strong><a href="http://192.168.0.1" target="_blank" rel="noopener">http://192.168.0.1</a> -&gt; Setup -&gt; LAN Setup -&gt; Connected Devices Summary</strong>, you should be able to find out which is the newly connected network device, namely <a href="http://www.friendlyarm.net/products/nanopi-neo" target="_blank" rel="noopener">NanoPi NEO</a>.</p>
<h2 id="1-ssh-into-nanopi-neo"><a class="markdownIt-Anchor" href="#1-ssh-into-nanopi-neo"></a> 1. SSH Into NanoPi NEO</h2>
<p>Through our host computer, <strong>SSH</strong> into <a href="http://www.friendlyarm.net/products/nanopi-neo" target="_blank" rel="noopener">NanoPi NEO</a>:</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">$ ssh root@192.168.0.76</span><br><span class="line">The authenticity of host <span class="string">'192.168.0.76 (192.168.0.76)'</span> can<span class="string">'t be established.</span></span><br><span class="line"><span class="string">ECDSA key fingerprint is SHA256:L0qZCYEGGallJo9jSpM63TWAYJ4vU/JzIbMJS80Lx8I.</span></span><br><span class="line"><span class="string">Are you sure you want to continue connecting (yes/no)? yes</span></span><br><span class="line"><span class="string">Warning: Permanently added '</span>192.168.0.76<span class="string">' (ECDSA) to the list of known hosts.</span></span><br><span class="line"><span class="string">root@192.168.0.76'</span>s password:</span><br></pre></td></tr></table></figure>
<p>Then you input <strong>1234</strong> as the password, you’ll be asked to change your password right away.</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line">You are required to change your password immediately (root enforced)</span><br><span class="line"> _   _                   ____  _   _   _            </span><br><span class="line">| \ | | __ _ _ __   ___ |  _ \(_) | \ | | ___  ___  </span><br><span class="line">|  \| |/ _` | <span class="string">'_ \ / _ \| |_) | | |  \| |/ _ \/ _ \ </span></span><br><span class="line"><span class="string">| |\  | (_| | | | | (_) |  __/| | | |\  |  __/ (_) |</span></span><br><span class="line"><span class="string">|_| \_|\__,_|_| |_|\___/|_|   |_| |_| \_|\___|\___/ </span></span><br><span class="line"><span class="string">                                                    </span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">Welcome to ARMBIAN 5.38 stable Debian GNU/Linux 9 (stretch) 4.14.14-sunxi   </span></span><br><span class="line"><span class="string">System load:   0.07 0.04 0.07   Up time:       15 min</span></span><br><span class="line"><span class="string">Memory usage:  16 % of 240MB    IP:            192.168.0.76</span></span><br><span class="line"><span class="string">CPU temp:      37°C           </span></span><br><span class="line"><span class="string">Usage of /:    7% of 15G    </span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">[ General system configuration (beta): armbian-config ]</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">New to Armbian? Check the documentation first: https://docs.armbian.com</span></span><br><span class="line"><span class="string">Changing password for root.</span></span><br><span class="line"><span class="string">(current) UNIX password: </span></span><br><span class="line"><span class="string">Enter new UNIX password: </span></span><br><span class="line"><span class="string">Retype new UNIX password: </span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">Thank you for choosing Armbian! Support: www.armbian.com</span></span><br></pre></td></tr></table></figure>
<p>And then you will be asked to create a new user account.</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br></pre></td><td class="code"><pre><span class="line">Creating a new user account. Press &lt;Ctrl-C&gt; to abort</span><br><span class="line"></span><br><span class="line">Please provide a username (eg. your forename): nanopineo</span><br><span class="line">Trying to add user nanopineo</span><br><span class="line">perl: warning: Setting locale failed.</span><br><span class="line">perl: warning: Please check that your locale settings:</span><br><span class="line">        LANGUAGE = <span class="string">"en_US.UTF-8"</span>,</span><br><span class="line">        LC_ALL = (<span class="built_in">unset</span>),</span><br><span class="line">        LC_MEASUREMENT = <span class="string">"en_CA.UTF-8"</span>,</span><br><span class="line">        LC_PAPER = <span class="string">"en_CA.UTF-8"</span>,</span><br><span class="line">        LC_MONETARY = <span class="string">"en_CA.UTF-8"</span>,</span><br><span class="line">        LC_NAME = <span class="string">"en_CA.UTF-8"</span>,</span><br><span class="line">        LC_ADDRESS = <span class="string">"en_CA.UTF-8"</span>,</span><br><span class="line">        LC_NUMERIC = <span class="string">"en_CA.UTF-8"</span>,</span><br><span class="line">        LC_MESSAGES = <span class="string">"en_US.UTF-8"</span>,</span><br><span class="line">        LC_TELEPHONE = <span class="string">"en_CA.UTF-8"</span>,</span><br><span class="line">        LC_IDENTIFICATION = <span class="string">"en_CA.UTF-8"</span>,</span><br><span class="line">        LC_TIME = <span class="string">"en_CA.UTF-8"</span>,</span><br><span class="line">        LANG = <span class="string">"en_US.UTF-8"</span></span><br><span class="line">    are supported and installed on your system.</span><br><span class="line">perl: warning: Falling back to a fallback locale (<span class="string">"en_US.UTF-8"</span>).</span><br><span class="line">Adding user `nanopineo<span class="string">' ...</span></span><br><span class="line"><span class="string">Adding new group `nanopineo'</span> (1000) ...</span><br><span class="line">Adding new user `nanopineo<span class="string">' (1000) with group `nanopineo'</span> ...</span><br><span class="line">Creating home directory `/home/nanopineo<span class="string">' ...</span></span><br><span class="line"><span class="string">Copying files from `/etc/skel'</span> ...</span><br><span class="line">Enter new UNIX password: </span><br><span class="line">Retype new UNIX password: </span><br><span class="line">passwd: password updated successfully</span><br><span class="line">Changing the user information <span class="keyword">for</span> nanopineo</span><br><span class="line">Enter the new value, or press ENTER <span class="keyword">for</span> the default</span><br><span class="line">        Full Name []: </span><br><span class="line">        Room Number []: </span><br><span class="line">        Work Phone []: </span><br><span class="line">        Home Phone []: </span><br><span class="line">        Other []: </span><br><span class="line">Is the information correct? [Y/n] Y</span><br><span class="line"></span><br><span class="line">Dear nanopineo, your account nanopineo has been created and is sudo enabled.</span><br><span class="line">Please use this account <span class="keyword">for</span> your daily work from now on.</span><br><span class="line"></span><br><span class="line">root@nanopineo:~<span class="comment">#</span></span><br></pre></td></tr></table></figure>
<h2 id="2-network-configuration"><a class="markdownIt-Anchor" href="#2-network-configuration"></a> 2. Network Configuration</h2>
<h3 id="1-doublecheck-ip-address"><a class="markdownIt-Anchor" href="#1-doublecheck-ip-address"></a> 1) Doublecheck IP address</h3>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line">root@nanopineo:~<span class="comment"># ifconfig</span></span><br><span class="line">eth0: flags=4163&lt;UP,BROADCAST,RUNNING,MULTICAST&gt;  mtu 1500</span><br><span class="line">        inet 192.168.0.76  netmask 255.255.255.0  broadcast 192.168.0.255</span><br><span class="line">        inet6 fe80::dc0b:3cff:fe76:8606  prefixlen 64  scopeid 0x20&lt;link&gt;</span><br><span class="line">        ether de:0b:3c:76:86:06  txqueuelen 1000  (Ethernet)</span><br><span class="line">        RX packets 1544  bytes 145676 (142.2 KiB)</span><br><span class="line">        RX errors 0  dropped 0  overruns 0  frame 0</span><br><span class="line">        TX packets 667  bytes 63483 (61.9 KiB)</span><br><span class="line">        TX errors 0  dropped 0 overruns 0  carrier 0  collisions 0</span><br><span class="line">        device interrupt 33  </span><br><span class="line"></span><br><span class="line">lo: flags=73&lt;UP,LOOPBACK,RUNNING&gt;  mtu 65536</span><br><span class="line">        inet 127.0.0.1  netmask 255.0.0.0</span><br><span class="line">        inet6 ::1  prefixlen 128  scopeid 0x10&lt;host&gt;</span><br><span class="line">        loop  txqueuelen 1000  (Local Loopback)</span><br><span class="line">        RX packets 0  bytes 0 (0.0 B)</span><br><span class="line">        RX errors 0  dropped 0  overruns 0  frame 0</span><br><span class="line">        TX packets 0  bytes 0 (0.0 B)</span><br><span class="line">        TX errors 0  dropped 0 overruns 0  carrier 0  collisions 0</span><br></pre></td></tr></table></figure>
<h3 id="2-modify-etcnetworkinterfaces"><a class="markdownIt-Anchor" href="#2-modify-etcnetworkinterfaces"></a> 2) Modify /etc/network/interfaces</h3>
<p>I noticed that when you reboot <a href="http://www.friendlyarm.net/products/nanopi-neo" target="_blank" rel="noopener">NanoPi NEO</a>, the IP address changed from time to time. The reason why it is so is because the MAC address of <a href="http://www.friendlyarm.net/products/nanopi-neo" target="_blank" rel="noopener">NanoPi NEO</a> change randomly after Armbian reboot. Therefore, it’s recommended to manually set a static MAC address for <a href="http://www.friendlyarm.net/products/nanopi-neo" target="_blank" rel="noopener">NanoPi NEO</a> in file /<strong>etc/network/interfaces</strong>.</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">root@nanopineo:~<span class="comment"># vim /etc/network/interfaces</span></span><br></pre></td></tr></table></figure>
<p>Just make sure to uncomment this line <strong>hwaddress ether # if you want to set MAC manually</strong> and write in a fixed MAC address. The final /<strong>etc/network/interfaces</strong> for my <a href="http://www.friendlyarm.net/products/nanopi-neo" target="_blank" rel="noopener">NanoPi NEO</a> is as follows:</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br></pre></td><td class="code"><pre><span class="line">root@nanopineo:~<span class="comment"># cat /etc/network/interfaces</span></span><br><span class="line"><span class="built_in">source</span> /etc/network/interfaces.d/*</span><br><span class="line"></span><br><span class="line"><span class="comment"># Wired adapter #1</span></span><br><span class="line">allow-hotplug eth0</span><br><span class="line">no-auto-down eth0</span><br><span class="line">iface eth0 inet dhcp</span><br><span class="line"><span class="comment">#address 192.168.0.100</span></span><br><span class="line"><span class="comment">#netmask 255.255.255.0</span></span><br><span class="line"><span class="comment">#gateway 192.168.0.1</span></span><br><span class="line"><span class="comment">#dns-nameservers 8.8.8.8 8.8.4.4</span></span><br><span class="line">        hwaddress ether  d2:d0:78:47:06:b3 <span class="comment"># if you want to set MAC manually</span></span><br><span class="line"><span class="comment">#       pre-up /sbin/ifconfig eth0 mtu 3838 # setting MTU for DHCP, static just: mtu 3838</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment"># Wireless adapter #1</span></span><br><span class="line"><span class="comment"># Armbian ships with network-manager installed by default. To save you time</span></span><br><span class="line"><span class="comment"># and hassles consider using 'sudo nmtui' instead of configuring Wi-Fi settings</span></span><br><span class="line"><span class="comment"># manually. The below lines are only meant as an example how configuration could</span></span><br><span class="line"><span class="comment"># be done in an anachronistic way:</span></span><br><span class="line"><span class="comment"># </span></span><br><span class="line"><span class="comment">#allow-hotplug wlan0</span></span><br><span class="line"><span class="comment">#iface wlan0 inet dhcp</span></span><br><span class="line"><span class="comment">#address 192.168.0.100</span></span><br><span class="line"><span class="comment">#netmask 255.255.255.0</span></span><br><span class="line"><span class="comment">#gateway 192.168.0.1</span></span><br><span class="line"><span class="comment">#dns-nameservers 8.8.8.8 8.8.4.4</span></span><br><span class="line"><span class="comment">#   wpa-conf /etc/wpa_supplicant/wpa_supplicant.conf</span></span><br><span class="line"><span class="comment"># Disable power saving on compatible chipsets (prevents SSH/connection dropouts over WiFi)</span></span><br><span class="line"><span class="comment">#wireless-mode Managed</span></span><br><span class="line"><span class="comment">#wireless-power off</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># Local loopback</span></span><br><span class="line">auto lo</span><br><span class="line">iface lo inet loopback</span><br><span class="line"></span><br><span class="line">And before reboot Armbian, we also need to <span class="built_in">set</span> a **FIXED** IP address (Here <span class="keyword">in</span> my <span class="keyword">case</span>: 192.168.0.36) <span class="keyword">for</span> the device with the static MAC address you just specified (Here <span class="keyword">in</span> my <span class="keyword">case</span>: **d2:d0:78:47:06:b3**).</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">## 3. Reboot Armbian</span></span><br><span class="line"></span><br><span class="line">Now, reboot Armbian.</span><br><span class="line"></span><br><span class="line">```console</span><br><span class="line">root@nanopineo:~<span class="comment"># sudo reboot</span></span><br></pre></td></tr></table></figure>
<p>After a while, ssh into Armbian with created user <strong>nanopineo</strong>:</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line">$ ssh nanopineo@192.168.0.36</span><br><span class="line">The authenticity of host <span class="string">'192.168.0.36 (192.168.0.36)'</span> can<span class="string">'t be established.</span></span><br><span class="line"><span class="string">ECDSA key fingerprint is SHA256:L0qZCYEGGallJo9jSpM63TWAYJ4vU/JzIbMJS80Lx8I.</span></span><br><span class="line"><span class="string">Are you sure you want to continue connecting (yes/no)? yes</span></span><br><span class="line"><span class="string">Warning: Permanently added '</span>192.168.0.36<span class="string">' (ECDSA) to the list of known hosts.</span></span><br><span class="line"><span class="string">nanopineo@192.168.0.36'</span>s password: </span><br><span class="line"> _   _                   ____  _   _   _            </span><br><span class="line">| \ | | __ _ _ __   ___ |  _ \(_) | \ | | ___  ___  </span><br><span class="line">|  \| |/ _` | <span class="string">'_ \ / _ \| |_) | | |  \| |/ _ \/ _ \ </span></span><br><span class="line"><span class="string">| |\  | (_| | | | | (_) |  __/| | | |\  |  __/ (_) |</span></span><br><span class="line"><span class="string">|_| \_|\__,_|_| |_|\___/|_|   |_| |_| \_|\___|\___/ </span></span><br><span class="line"><span class="string">                                                    </span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">Welcome to ARMBIAN 5.38 stable Debian GNU/Linux 9 (stretch) 4.14.14-sunxi   </span></span><br><span class="line"><span class="string">System load:   0.99 0.30 0.10   Up time:       0 min</span></span><br><span class="line"><span class="string">Memory usage:  16 % of 240MB    IP:            192.168.0.36</span></span><br><span class="line"><span class="string">CPU temp:      43°C           </span></span><br><span class="line"><span class="string">Usage of /:    8% of 15G    </span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">[ 0 security updates available, 3 updates total: apt upgrade ]</span></span><br><span class="line"><span class="string">Last check: 2018-03-01 06:30</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">[ General system configuration (beta): armbian-config ]</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">nanopineo@nanopineo:~$</span></span><br></pre></td></tr></table></figure>
<h2 id="4-armbian-upgrading"><a class="markdownIt-Anchor" href="#4-armbian-upgrading"></a> 4. Armbian Upgrading</h2>
<p>Then we simply <strong>upgrade</strong> Armbian.</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br></pre></td><td class="code"><pre><span class="line">nanopineo@nanopineo:~$ sudo apt update</span><br><span class="line"></span><br><span class="line">We trust you have received the usual lecture from the <span class="built_in">local</span> System</span><br><span class="line">Administrator. It usually boils down to these three things:</span><br><span class="line"></span><br><span class="line">    <span class="comment">#1) Respect the privacy of others.</span></span><br><span class="line">    <span class="comment">#2) Think before you type.</span></span><br><span class="line">    <span class="comment">#3) With great power comes great responsibility.</span></span><br><span class="line"></span><br><span class="line">[sudo] password <span class="keyword">for</span> nanopineo: </span><br><span class="line">Hit:1 http://security.debian.org stretch/updates InRelease</span><br><span class="line">Hit:4 http://apt.armbian.com stretch InRelease                                                                                    </span><br><span class="line">Ign:2 http://cdn-fastly.deb.debian.org/debian stretch InRelease                              </span><br><span class="line">Hit:3 http://cdn-fastly.deb.debian.org/debian stretch-updates InRelease</span><br><span class="line">Hit:5 http://cdn-fastly.deb.debian.org/debian stretch-backports InRelease</span><br><span class="line">Hit:6 http://cdn-fastly.deb.debian.org/debian stretch Release</span><br><span class="line">Reading package lists... Done</span><br><span class="line">Building dependency tree       </span><br><span class="line">Reading state information... Done</span><br><span class="line">3 packages can be upgraded. Run <span class="string">'apt list --upgradable'</span> to see them.</span><br><span class="line">nanopineo@nanopineo:~$ apt list --upgradable</span><br><span class="line">Listing... Done</span><br><span class="line">linux-dtb-next-sunxi/stretch 5.41 armhf [upgradable from: 5.38]</span><br><span class="line">linux-image-next-sunxi/stretch 5.41 armhf [upgradable from: 5.38]</span><br><span class="line">tzdata/stable-updates 2018c-0+deb9u1 all [upgradable from: 2017c-0+deb9u1]</span><br><span class="line">nanopineo@nanopineo:~$ sudo apt upgrade</span><br><span class="line">Reading package lists... Done</span><br><span class="line">Building dependency tree       </span><br><span class="line">Reading state information... Done</span><br><span class="line">Calculating upgrade... Done</span><br><span class="line">The following packages will be upgraded:</span><br><span class="line">  linux-dtb-next-sunxi linux-image-next-sunxi tzdata</span><br><span class="line">3 upgraded, 0 newly installed, 0 to remove and 0 not upgraded.</span><br><span class="line">Need to get 20.2 MB of archives.</span><br><span class="line">After this operation, 240 kB of additional disk space will be used.</span><br><span class="line">Do you want to <span class="built_in">continue</span>? [Y/n] Y</span><br><span class="line">Get:1 http://cdn-fastly.deb.debian.org/debian stretch-updates/main armhf tzdata all 2018c-0+deb9u1 [264 kB]</span><br><span class="line">Get:2 http://apt.armbian.com stretch/main armhf linux-dtb-next-sunxi armhf 5.41 [175 kB]</span><br><span class="line">Get:3 http://apt.armbian.com stretch/main armhf linux-image-next-sunxi armhf 5.41 [19.7 MB]</span><br><span class="line">Fetched 20.2 MB <span class="keyword">in</span> 14s (1387 kB/s)</span><br><span class="line">perl: warning: Setting locale failed.</span><br><span class="line">perl: warning: Please check that your locale settings:</span><br><span class="line">        LANGUAGE = <span class="string">"en_US.UTF-8"</span>,</span><br><span class="line">        LC_ALL = (<span class="built_in">unset</span>),</span><br><span class="line">        LC_TIME = <span class="string">"en_CA.UTF-8"</span>,</span><br><span class="line">        LC_MONETARY = <span class="string">"en_CA.UTF-8"</span>,</span><br><span class="line">        LC_ADDRESS = <span class="string">"en_CA.UTF-8"</span>,</span><br><span class="line">        LC_TELEPHONE = <span class="string">"en_CA.UTF-8"</span>,</span><br><span class="line">        LC_MESSAGES = <span class="string">"en_US.UTF-8"</span>,</span><br><span class="line">        LC_NAME = <span class="string">"en_CA.UTF-8"</span>,</span><br><span class="line">        LC_MEASUREMENT = <span class="string">"en_CA.UTF-8"</span>,</span><br><span class="line">        LC_IDENTIFICATION = <span class="string">"en_CA.UTF-8"</span>,</span><br><span class="line">        LC_NUMERIC = <span class="string">"en_CA.UTF-8"</span>,</span><br><span class="line">        LC_PAPER = <span class="string">"en_CA.UTF-8"</span>,</span><br><span class="line">        LANG = <span class="string">"en_US.UTF-8"</span></span><br><span class="line">    are supported and installed on your system.</span><br><span class="line">perl: warning: Falling back to a fallback locale (<span class="string">"en_US.UTF-8"</span>).</span><br><span class="line">locale: Cannot <span class="built_in">set</span> LC_ALL to default locale: No such file or directory</span><br><span class="line">Preconfiguring packages ...</span><br><span class="line">(Reading database ... 32833 files and directories currently installed.)</span><br><span class="line">Preparing to unpack .../tzdata_2018c-0+deb9u1_all.deb ...</span><br><span class="line">Unpacking tzdata (2018c-0+deb9u1) over (2017c-0+deb9u1) ...</span><br><span class="line">Preparing to unpack .../linux-dtb-next-sunxi_5.41_armhf.deb ...</span><br><span class="line">Unpacking linux-dtb-next-sunxi (5.41) over (5.38) ...</span><br><span class="line">Preparing to unpack .../linux-image-next-sunxi_5.41_armhf.deb ...</span><br><span class="line">update-initramfs: Deleting /boot/initrd.img-4.14.14-sunxi</span><br><span class="line">Removing obsolete file uInitrd-4.14.14-sunxi</span><br><span class="line">Unpacking linux-image-next-sunxi (5.41) over (5.38) ...</span><br><span class="line">Setting up linux-dtb-next-sunxi (5.41) ...</span><br><span class="line">Setting up tzdata (2018c-0+deb9u1) ...</span><br><span class="line">locale: Cannot <span class="built_in">set</span> LC_ALL to default locale: No such file or directory</span><br><span class="line"></span><br><span class="line">Current default time zone: <span class="string">'Etc/UTC'</span></span><br><span class="line">Local time is now:      Thu Mar  1 06:34:05 UTC 2018.</span><br><span class="line">Universal Time is now:  Thu Mar  1 06:34:05 UTC 2018.</span><br><span class="line">Run <span class="string">'dpkg-reconfigure tzdata'</span> <span class="keyword">if</span> you wish to change it.</span><br><span class="line"></span><br><span class="line">Setting up linux-image-next-sunxi (5.41) ...</span><br><span class="line">update-initramfs: Generating /boot/initrd.img-4.14.18-sunxi</span><br><span class="line">update-initramfs: Converting to u-boot format</span><br><span class="line">nanopineo@nanopineo:~$</span><br></pre></td></tr></table></figure>
<h2 id="5-kernel-doublechecking"><a class="markdownIt-Anchor" href="#5-kernel-doublechecking"></a> 5. Kernel Doublechecking</h2>
<p>Finally, we have the system and kernel doublechecked.</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">nanopineo@nanopineo:~$ uname -r</span><br><span class="line">4.14.14-sunxi</span><br><span class="line">nanopineo@nanopineo:~$ uname -a</span><br><span class="line">Linux nanopineo 4.14.14-sunxi <span class="comment">#1 SMP Thu Jan 25 12:20:57 CET 2018 armv7l GNU/Linux</span></span><br><span class="line">nanopineo@nanopineo:~$ lsb_release -a</span><br><span class="line">No LSB modules are available.</span><br><span class="line">Distributor ID: Debian</span><br><span class="line">Description:    Debian GNU/Linux 9.3 (stretch)</span><br><span class="line">Release:        9.3</span><br><span class="line">Codename:       stretch</span><br><span class="line">nanopineo@nanopineo:~$</span><br></pre></td></tr></table></figure>

          
        
      
    </div>

    

    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://longervision.ca/2018/01/10/SBCs/ARM/beaglebone-black-uboot-kernel/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="Nobody">
      <meta itemprop="description" content="Longer Vision Technology Github Blog">
      <meta itemprop="image" content="/images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Longer Vision Technology">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2018/01/10/SBCs/ARM/beaglebone-black-uboot-kernel/" itemprop="url">
                  Build U-Boot and Linux Kernel for Beaglebone and Beaglebone Black
                </a>
              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">

            
            
            

            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">Posted on</span>
              

              
                
              

              <time title="Created: 2018-01-10 00:00:00" itemprop="dateCreated datePublished" datetime="2018-01-10T00:00:00-08:00">2018-01-10</time>
            

            
              

              
                
                <span class="post-meta-divider">|</span>
                

                <span class="post-meta-item-icon">
                  <i class="fa fa-calendar-check-o"></i>
                </span>
                
                  <span class="post-meta-item-text">Edited on</span>
                
                <time title="Modified: 2019-08-18 14:58:22" itemprop="dateModified" datetime="2019-08-18T14:58:22-07:00">2019-08-18</time>
              
            
          </span>

          
            <span class="post-category">
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">In</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing"><a href="/categories/Single-Board-Computers/" itemprop="url" rel="index"><span itemprop="name">Single Board Computers</span></a></span>

                
                
                  , 
                
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing"><a href="/categories/Single-Board-Computers/ARM/" itemprop="url" rel="index"><span itemprop="name">ARM</span></a></span>

                
                
              
            </span>
          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <p>Happy new year everybody. How time flies. It is already 2018. <a href="http://www.longervision.com/" target="_blank" rel="noopener">Longer Vision</a> has been struggling on this tough road towards a successful enterprise. Algorithms <strong>ONLY</strong> are <strong>NOT</strong> enough for nowadays business. <a href="https://en.wikipedia.org/wiki/Board_support_package" target="_blank" rel="noopener">BSP (board support package)</a> and <a href="https://en.wikipedia.org/wiki/Integrated_circuit_design" target="_blank" rel="noopener">IC design</a> are a must for a successful business nowadays. Thus, ever since 2018, <a href="http://www.longervision.com/" target="_blank" rel="noopener">Longer Vision</a> is going to balance <strong>both</strong> hardware <strong>and</strong> software, particularly, <a href="http://www.arm.com/" target="_blank" rel="noopener">ARM</a> based open source embedded development board and computer vision algorithms.</p>
<p>In this blog, we are going to talk about how to build and flash <a href="http://www.denx.de/wiki/U-Boot/WebHome" target="_blank" rel="noopener">U-Boot</a> and <a href="https://www.kernel.org/" target="_blank" rel="noopener">Linux Kernel</a> onto a <a href="https://beagleboard.org/bone-original" target="_blank" rel="noopener">Beaglebone</a> and <a href="https://beagleboard.org/black" target="_blank" rel="noopener">Beaglebone Black</a>, which adopts <a href="http://www.ti.com/processors/sitara/arm-cortex-a8/am335x/overview.html" target="_blank" rel="noopener">TI AM335x</a> as its CPU. The board looks like (cited from <a href="https://beagleboard.org/black" target="_blank" rel="noopener">Beaglebone Black</a> ):</p>
<p><img src="https://raw.githubusercontent.com/LongerVision/Resource/master/Embedded/ti/omap/beaglebone/black/images/BBB.jpg" alt="Beaglebone Black"></p>
<h1 id="part-a-cross-compile-u-boot-and-linux-kernel"><a class="markdownIt-Anchor" href="#part-a-cross-compile-u-boot-and-linux-kernel"></a> PART A: Cross Compile U-Boot and Linux Kernel</h1>
<h2 id="1-linaro-gcc"><a class="markdownIt-Anchor" href="#1-linaro-gcc"></a> 1. Linaro GCC</h2>
<p><a href="https://www.linaro.org/" target="_blank" rel="noopener">Linaro</a> is a popular platform providing high-quality code for both <a href="https://www.kernel.org/" target="_blank" rel="noopener">Linux kernel</a> and <a href="https://developer.arm.com/open-source/gnu-toolchain/gnu-rm" target="_blank" rel="noopener">GCC tool chain</a>. Linaro’s GCC toolchain of varoius versions can be directly found <a href="https://releases.linaro.org/components/toolchain/binaries/" target="_blank" rel="noopener">here</a>.</p>
<p>Here, we download GCC latest-6 binary under <a href="https://releases.linaro.org/components/toolchain/binaries/latest-6/arm-linux-gnueabihf/" target="_blank" rel="noopener">arm-linux-gnueabihf</a>.</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">$ wget -c </span><br><span class="line">https://releases.linaro.org/components/toolchain/binaries/latest-6/arm-linux-gnueabihf/gcc-linaro-6.4.1-2017.11-x86_64_arm-linux-gnueabihf.tar.xz</span><br><span class="line">$ tar xf gcc-linaro-6.4.1-2017.11-x86_64_arm-linux-gnueabihf.tar.xz</span><br><span class="line">$ <span class="built_in">export</span> CC=`<span class="built_in">pwd</span>`/gcc-linaro-6.4.1-2017.11-x86_64_arm-linux-gnueabihf/bin/arm-linux-gnueabihf-</span><br></pre></td></tr></table></figure>
<p>Test the cross compiler:</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">$ <span class="variable">$&#123;CC&#125;</span>gcc --version</span><br><span class="line">arm-linux-gnueabihf-gcc (Linaro GCC 6.4-2017.11) 6.4.1 20171012</span><br><span class="line">Copyright (C) 2017 Free Software Foundation, Inc.</span><br><span class="line">This is free software; see the <span class="built_in">source</span> <span class="keyword">for</span> copying conditions.  There is NO</span><br><span class="line">warranty; not even <span class="keyword">for</span> MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.</span><br></pre></td></tr></table></figure>
<h2 id="2-u-boot"><a class="markdownIt-Anchor" href="#2-u-boot"></a> 2. U-Boot</h2>
<p><a href="http://www.denx.de/wiki/U-Boot" target="_blank" rel="noopener">U-Boot</a> is a universal boot loader. For <a href="https://beagleboard.org/bone-original" target="_blank" rel="noopener">Beaglebone</a> and <a href="https://beagleboard.org/black" target="_blank" rel="noopener">Beaglebone Black</a>, there are two patches which has been maintained by <a href="http://eewiki.net/display/linuxonarm" target="_blank" rel="noopener">eewiki Linux on ARM</a> on <a href="https://github.com/eewiki/u-boot-patches" target="_blank" rel="noopener">github</a>. We first download U-Boot and check out the latest release as follows:</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">$ git <span class="built_in">clone</span> https://github.com/u-boot/u-boot</span><br><span class="line">$ <span class="built_in">cd</span> u-boot/</span><br><span class="line">$ git checkout v2018.01</span><br></pre></td></tr></table></figure>
<p>Then check out the latest <a href="https://github.com/eewiki/u-boot-patches" target="_blank" rel="noopener">u-boot-patches</a> and patch two files under the latest release <a href="https://github.com/eewiki/u-boot-patches/tree/master/v2018.01" target="_blank" rel="noopener">v2018.01</a>:</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">$ <span class="built_in">cd</span> ../</span><br><span class="line">$ git <span class="built_in">clone</span> https://github.com/eewiki/u-boot-patches.git</span><br><span class="line">$ <span class="built_in">cd</span> ./u-boot-patches/v2018.01</span><br><span class="line">$ cp 0001-am335x_evm-uEnv.txt-bootz-n-fixes.patch ../../u-boot/</span><br><span class="line">$ cp 0002-U-Boot-BeagleBone-Cape-Manager.patch ../../u-boot/</span><br><span class="line">$ <span class="built_in">cd</span> ../../u-boot</span><br><span class="line">$ patch -p1 &lt; 0001-am335x_evm-uEnv.txt-bootz-n-fixes.patch</span><br><span class="line">$ patch -p1 &lt; 0002-U-Boot-BeagleBone-Cape-Manager.patch</span><br></pre></td></tr></table></figure>
<p>Finally, we configure and build U-Boot for <a href="https://beagleboard.org/bone-original" target="_blank" rel="noopener">Beaglebone</a> and <a href="https://beagleboard.org/black" target="_blank" rel="noopener">Beaglebone Black</a> as follows:</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">$ make ARCH=arm CROSS_COMPILE=<span class="variable">$&#123;CC&#125;</span> distclean</span><br><span class="line">$ make ARCH=arm CROSS_COMPILE=<span class="variable">$&#123;CC&#125;</span> am335x_evm_defconfig</span><br><span class="line">$ make ARCH=arm CROSS_COMPILE=<span class="variable">$&#123;CC&#125;</span></span><br></pre></td></tr></table></figure>
<h2 id="3-linux-kernel"><a class="markdownIt-Anchor" href="#3-linux-kernel"></a> 3. Linux Kernel</h2>
<p>Due to Robert Nelson’s summary at <a href="http://eewiki.net/display/linuxonarm/BeagleBone+Black" target="_blank" rel="noopener">eewiki</a>, there are two ways to build <a href="https://beagleboard.org/bone-original" target="_blank" rel="noopener">Beaglebone</a> and <a href="https://beagleboard.org/black" target="_blank" rel="noopener">Beaglebone Black</a>: - <a href="https://github.com/RobertCNelson/bb-kernel" target="_blank" rel="noopener">Mainline</a> - <a href="https://github.com/RobertCNelson/ti-linux-kernel-dev" target="_blank" rel="noopener">TI BSP</a></p>
<p>Their differences are: - bb-kernel: based on <a href="https://github.com/RobertCNelson/bb-kernel" target="_blank" rel="noopener">mainline</a>, no-smp, optimized for AM335x devices. - ti-linux-kernel-dev: based on <a href="https://github.com/RobertCNelson/ti-linux-kernel-dev" target="_blank" rel="noopener">TI’s git tree</a>, smp, optimized for AM335x/AM43xx/AM57x devices.</p>
<p>Here, we are going to use <a href="https://github.com/RobertCNelson/bb-kernel" target="_blank" rel="noopener">Mainline</a> to build our own Linux Kernel. We FIRST check out <a href="https://github.com/RobertCNelson/bb-kernel" target="_blank" rel="noopener">Robert Nelson’s bb-kernel</a>.</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">$ git <span class="built_in">clone</span> https://github.com/RobertCNelson/bb-kernel</span><br><span class="line">$ <span class="built_in">cd</span> bb-kernel/</span><br><span class="line">$ git checkout origin/am33x-v4.14 -b am33x-v4.14</span><br></pre></td></tr></table></figure>
<p>We then check out <a href="https://git.kernel.org/pub/scm/linux/kernel/git/stable/linux-stable.git" target="_blank" rel="noopener">Linus Torvalds’ stable Linux Kernel</a>, which can be also tracked on <a href="https://github.com/torvalds/linux" target="_blank" rel="noopener">github Torvalds Linux</a>. This will take you quite a while.</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ git <span class="built_in">clone</span> https://git.kernel.org/pub/scm/linux/kernel/git/stable/linux-stable.git</span><br></pre></td></tr></table></figure>
<p>Now, it’s the time to modify some of the configurations in .sh files under the checked out branch <strong>am33x-v4.14</strong>.</p>
<h3 id="1-versionsh"><a class="markdownIt-Anchor" href="#1-versionsh"></a> 1) <a href="http://version.sh" target="_blank" rel="noopener">version.sh</a></h3>
<p>Here, I’m using <strong>gcc_linaro_gnueabihf_6</strong> instead of <strong>gcc_linaro_gnueabihf_7</strong>.</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">toolchain=<span class="string">"gcc_linaro_gnueabihf_6"</span></span><br><span class="line"><span class="comment">#toolchain="gcc_linaro_gnueabihf_7"</span></span><br></pre></td></tr></table></figure>
<h3 id="2-systemsh"><a class="markdownIt-Anchor" href="#2-systemsh"></a> 2) <a href="http://system.sh" target="_blank" rel="noopener">system.sh</a></h3>
<p>A file named <strong>system.sh.sample</strong> has been provided for us to configure accordingly. We FIRST do a copy.</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ cp system.sh.sample system.sh</span><br></pre></td></tr></table></figure>
<p>Then, we manually re-specifying two MACROs: <strong>CC</strong> and <strong>LINUX_GIT</strong>, respectively to two directories containing the above downloaded Linaro GCC compiler and the current Torvalds’ Linux Kernel. We also specify <strong>MMC</strong> for TF/SD Card as follows:</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">CC=.../gcc-linaro-6.4.1-2017.11-x86_64_arm-linux-gnueabihf/bin/arm-linux-gnueabihf-</span><br><span class="line">LINUX_GIT=.../linux-stable</span><br><span class="line">MMC=/dev/mmcblk0</span><br></pre></td></tr></table></figure>
<p>After the above configurations, we start building the Linux Kernel using the following command line. This will probably take you one hour.</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ ./build_kernel.sh</span><br></pre></td></tr></table></figure>
<p>When you see this <strong>Kernel Configuration</strong> page,</p>
<p><img src="https://raw.githubusercontent.com/LongerVision/Resource/master/Embedded/ti/omap/beaglebone/black/images/kernelconfiguration.jpg" alt="Kernel Configuration"></p>
<p><strong>Exit</strong> right away without any modification. And you will see:</p>
<p><img src="https://raw.githubusercontent.com/LongerVision/Resource/master/Embedded/ti/omap/beaglebone/black/images/afterkernelconfiguration.jpg" alt="After Kernel Configuration"></p>
<p>After a while, you will see <strong>Linux Kernel</strong> has been successfully built:</p>
<p><img src="https://raw.githubusercontent.com/LongerVision/Resource/master/Embedded/ti/omap/beaglebone/black/images/kernelbuilt.jpg" alt="The Built Kernel"></p>
<h2 id="4-root-file-system"><a class="markdownIt-Anchor" href="#4-root-file-system"></a> 4. Root File System</h2>
<p>We then install the latest Debian (for now, Debian 9.3) according to Robert Nelson’s minimal operating system. Three commands are to be executed in a row for downloading, verifying, and extraction.</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">$ wget -c https://rcn-ee.com/rootfs/eewiki/minfs/debian-9.3-minimal-armhf-2017-12-09.tar.xz</span><br><span class="line">$ sha256sum debian-9.3-minimal-armhf-2017-12-09.tar.xz</span><br><span class="line">5120fcfb8ff8af013737fae52dc0a7ecc2f52563a9aa8f5aa288aff0f3943d61  debian-9.3-minimal-armhf-2017-12-09.tar.xz</span><br><span class="line">$ tar xf debian-9.3-minimal-armhf-2017-12-09.tar.xz</span><br></pre></td></tr></table></figure>
<p>Until now, most components for booting have been downloaded and built. It is the time for us to flash our own OS onto a SD card.</p>
<h1 id="part-b-install-the-linux-os-onto-sd-card"><a class="markdownIt-Anchor" href="#part-b-install-the-linux-os-onto-sd-card"></a> PART B: Install the Linux OS onto SD Card</h1>
<h2 id="5-setup-microsd-card"><a class="markdownIt-Anchor" href="#5-setup-microsd-card"></a> 5. Setup microSD card</h2>
<h3 id="1-tf-card-preparation"><a class="markdownIt-Anchor" href="#1-tf-card-preparation"></a> 1) TF Card Preparation</h3>
<p>We first check which block device that we are going to install our built system onto by command <strong>lsblk</strong>.</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">$ lsblk</span><br><span class="line">NAME    MAJ:MIN RM   SIZE RO TYPE MOUNTPOINT</span><br><span class="line">sdd       8:48   0 931.5G  0 disk </span><br><span class="line">└─sdd1    8:49   0 931.5G  0 part /media/jiapei/Data</span><br><span class="line">sdb       8:16   0 238.5G  0 disk </span><br><span class="line">├─sdb4    8:20   0   900M  0 part </span><br><span class="line">├─sdb2    8:18   0   128M  0 part </span><br><span class="line">├─sdb3    8:19   0 237.2G  0 part /media/jiapei/Win10</span><br><span class="line">└─sdb1    8:17   0   300M  0 part /boot/efi</span><br><span class="line">sr0      11:0    1  1024M  0 rom  </span><br><span class="line">sdc       8:32   0 238.5G  0 disk </span><br><span class="line">├─sdc2    8:34   0  30.5G  0 part [SWAP]</span><br><span class="line">├─sdc3    8:35   0 207.5G  0 part /</span><br><span class="line">└─sdc1    8:33   0   512M  0 part </span><br><span class="line">mmcblk0 179:0    0    15G  0 disk</span><br></pre></td></tr></table></figure>
<p>We then define a MACRO <strong>DISK</strong> to specify the TF card device.</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ <span class="built_in">export</span> DISK=/dev/mmcblk0</span><br></pre></td></tr></table></figure>
<p>Afterwards, erase partition table/labels on TF card by:</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ sudo dd <span class="keyword">if</span>=/dev/zero of=<span class="variable">$&#123;DISK&#125;</span> bs=1M count=10</span><br></pre></td></tr></table></figure>
<h3 id="2-bootloader-installation"><a class="markdownIt-Anchor" href="#2-bootloader-installation"></a> 2) Bootloader installation</h3>
<p>Now, we install the built U-Boot onto the SD card:</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">$ sudo dd <span class="keyword">if</span>=./u-boot/MLO of=<span class="variable">$&#123;DISK&#125;</span> count=1 seek=1 bs=128k</span><br><span class="line">$ sudo dd <span class="keyword">if</span>=./u-boot/u-boot.img of=<span class="variable">$&#123;DISK&#125;</span> count=2 seek=1 bs=384k</span><br></pre></td></tr></table></figure>
<h3 id="3-partition-preparation"><a class="markdownIt-Anchor" href="#3-partition-preparation"></a> 3) Partition Preparation</h3>
<p>We FIRST make sure which version of <strong>sfdisk</strong> is. In my case, it is of version 2.27.1</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">$ sudo sfdisk --version</span><br><span class="line">sfdisk from util-linux 2.27.1</span><br></pre></td></tr></table></figure>
<p>Then we create the partition layout by:</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">$ sudo sfdisk <span class="variable">$&#123;DISK&#125;</span> &lt;&lt;-__EOF__</span><br><span class="line">4M,,L,*</span><br><span class="line">__EOF__</span><br></pre></td></tr></table></figure>
<p>Afterwards, we need to format the created partition by <strong>mkfs.ext4</strong>. We also need to make sure which version of <strong>mkfs.ext4</strong> is. In my case, it is of version 1.42.13.</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">$ mkfs.ext4 -V</span><br><span class="line">mke2fs 1.42.13 (17-May-2015)</span><br><span class="line">        Using EXT2FS Library version 1.42.13</span><br></pre></td></tr></table></figure>
<p>Then, we format the partition by:</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ sudo mkfs.ext4 -L rootfs <span class="variable">$&#123;DISK&#125;</span>p1</span><br></pre></td></tr></table></figure>
<p>After formatting, the TF card should be able to be either automatically mounted or manually mounted by the following command:</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">$ sudo mkdir -p /media/rootfs/</span><br><span class="line">$ sudo mount <span class="variable">$&#123;DISK&#125;</span>p1 /media/rootfs/</span><br></pre></td></tr></table></figure>
<h3 id="4-backup-bootloader"><a class="markdownIt-Anchor" href="#4-backup-bootloader"></a> 4) Backup Bootloader</h3>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">$ sudo mkdir -p /media/rootfs/opt/backup/uboot/</span><br><span class="line">$ sudo cp -v ./u-boot/MLO /media/rootfs/opt/backup/uboot/</span><br><span class="line">$ sudo cp -v ./u-boot/u-boot.img /media/rootfs/opt/backup/uboot/</span><br></pre></td></tr></table></figure>
<h3 id="5-dealing-with-old-bootloader-in-emmc-optional"><a class="markdownIt-Anchor" href="#5-dealing-with-old-bootloader-in-emmc-optional"></a> 5) Dealing with old Bootloader in eMMC (Optional)</h3>
<p>If the old bootloader in eMMC is to be kept, please copy the following file <strong>uEnv.txt</strong> to /<strong>media/rootfs/</strong>.</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">##This will work with: Angstrom's 2013.06.20 u-boot.</span></span><br><span class="line"> </span><br><span class="line">loadaddr=0x82000000</span><br><span class="line">fdtaddr=0x88000000</span><br><span class="line">rdaddr=0x88080000</span><br><span class="line"> </span><br><span class="line">initrd_high=0xffffffff</span><br><span class="line">fdt_high=0xffffffff</span><br><span class="line"> </span><br><span class="line"><span class="comment">#for single partitions:</span></span><br><span class="line">mmcroot=/dev/mmcblk0p1</span><br><span class="line"> </span><br><span class="line">loadximage=load mmc 0:1 <span class="variable">$&#123;loadaddr&#125;</span> /boot/vmlinuz-<span class="variable">$&#123;uname_r&#125;</span></span><br><span class="line">loadxfdt=load mmc 0:1 <span class="variable">$&#123;fdtaddr&#125;</span> /boot/dtbs/<span class="variable">$&#123;uname_r&#125;</span>/<span class="variable">$&#123;fdtfile&#125;</span></span><br><span class="line">loadxrd=load mmc 0:1 <span class="variable">$&#123;rdaddr&#125;</span> /boot/initrd.img-<span class="variable">$&#123;uname_r&#125;</span>; setenv rdsize <span class="variable">$&#123;filesize&#125;</span></span><br><span class="line">loaduEnvtxt=load mmc 0:1 <span class="variable">$&#123;loadaddr&#125;</span> /boot/uEnv.txt ; env import -t <span class="variable">$&#123;loadaddr&#125;</span> <span class="variable">$&#123;filesize&#125;</span>;</span><br><span class="line">loadall=run loaduEnvtxt; run loadximage; run loadxfdt;</span><br><span class="line"> </span><br><span class="line">mmcargs=setenv bootargs console=tty0 console=<span class="variable">$&#123;console&#125;</span> <span class="variable">$&#123;optargs&#125;</span> <span class="variable">$&#123;cape_disable&#125;</span> <span class="variable">$&#123;cape_enable&#125;</span> root=<span class="variable">$&#123;mmcroot&#125;</span> rootfstype=<span class="variable">$&#123;mmcrootfstype&#125;</span> <span class="variable">$&#123;cmdline&#125;</span></span><br><span class="line"> </span><br><span class="line">uenvcmd=run loadall; run mmcargs; bootz <span class="variable">$&#123;loadaddr&#125;</span> - <span class="variable">$&#123;fdtaddr&#125;</span>;</span><br></pre></td></tr></table></figure>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sudo cp -v ./uEnv.txt /media/rootfs/</span><br></pre></td></tr></table></figure>
<h2 id="6-kernel-installation"><a class="markdownIt-Anchor" href="#6-kernel-installation"></a> 6. Kernel Installation</h2>
<h3 id="1-export-macro-kernel_version"><a class="markdownIt-Anchor" href="#1-export-macro-kernel_version"></a> 1) Export MACRO kernel_version</h3>
<p>Under the folder <strong>bb-kernel</strong>, a file named <strong>kernel_version</strong> was generated while building <a href="https://www.kernel.org/" target="_blank" rel="noopener">Linux kernel</a>. In my case, I was building the NEWEST kernel <strong>4.14.13-bone12</strong>. For convenience, we export a new MACRO <strong>kernel_version</strong>.</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">$ cat kernel_version </span><br><span class="line">4.14.13-bone12</span><br><span class="line">$ <span class="built_in">export</span> kernel_version=4.14.13-bone12</span><br></pre></td></tr></table></figure>
<h3 id="2-extract-debian-root-file-system-onto-tf-card"><a class="markdownIt-Anchor" href="#2-extract-debian-root-file-system-onto-tf-card"></a> 2) Extract Debian Root File System onto TF Card</h3>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">$ sudo tar xfvp ./debian-9.3-minimal-armhf-2017-12-09/armhf-rootfs-debian-stretch.tar -C /media/rootfs/</span><br><span class="line">$ sync</span><br><span class="line">$ sudo chown root:root /media/rootfs/</span><br><span class="line">$ sudo chmod 755 /media/rootfs/</span><br></pre></td></tr></table></figure>
<h3 id="3-set-uname_r-in-bootuenvtxt"><a class="markdownIt-Anchor" href="#3-set-uname_r-in-bootuenvtxt"></a> 3) Set uname_r in /boot/uEnv.txt</h3>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ sudo sh -c <span class="string">"echo 'uname_r=<span class="variable">$&#123;kernel_version&#125;</span>' &gt;&gt; /media/rootfs/boot/uEnv.txt"</span></span><br></pre></td></tr></table></figure>
<h3 id="4-copy-kernel-image"><a class="markdownIt-Anchor" href="#4-copy-kernel-image"></a> 4) Copy Kernel Image</h3>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ sudo cp -v ./bb-kernel/deploy/<span class="variable">$&#123;kernel_version&#125;</span>.zImage /media/rootfs/boot/vmlinuz-<span class="variable">$&#123;kernel_version&#125;</span></span><br></pre></td></tr></table></figure>
<h3 id="5-copy-kernel-device-tree-binaries"><a class="markdownIt-Anchor" href="#5-copy-kernel-device-tree-binaries"></a> 5) Copy Kernel Device Tree Binaries</h3>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">$ sudo mkdir -p /media/rootfs/boot/dtbs/<span class="variable">$&#123;kernel_version&#125;</span>/</span><br><span class="line">$ sudo tar xfv ./bb-kernel/deploy/<span class="variable">$&#123;kernel_version&#125;</span>-dtbs.tar.gz -C /media/rootfs/boot/dtbs/<span class="variable">$&#123;kernel_version&#125;</span>/</span><br></pre></td></tr></table></figure>
<h3 id="6-copy-kernel-modules"><a class="markdownIt-Anchor" href="#6-copy-kernel-modules"></a> 6) Copy Kernel Modules</h3>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ sudo tar xfv ./bb-kernel/deploy/<span class="variable">$&#123;kernel_version&#125;</span>-modules.tar.gz -C /media/rootfs/</span><br></pre></td></tr></table></figure>
<h3 id="7-set-file-systems-table-etcfstab"><a class="markdownIt-Anchor" href="#7-set-file-systems-table-etcfstab"></a> 7) Set File Systems Table (/etc/fstab)</h3>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ sudo sh -c <span class="string">"echo '/dev/mmcblk0p1  /  auto  errors=remount-ro  0  1' &gt;&gt; /media/rootfs/etc/fstab"</span></span><br></pre></td></tr></table></figure>
<h3 id="8-networking"><a class="markdownIt-Anchor" href="#8-networking"></a> 8) Networking</h3>
<p>To enable the Internet for the FIRST booting, we need to do the network configuration:</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ sudo nano /media/rootfs/etc/network/interfaces</span><br></pre></td></tr></table></figure>
<p>Add the following content:</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">auto lo</span><br><span class="line">iface lo inet loopback</span><br><span class="line"> </span><br><span class="line">auto eth0</span><br><span class="line">iface eth0 inet dhcp</span><br></pre></td></tr></table></figure>
<p>In order to use a shared SD card with multiple BeagleBones, and always enable the Ethernet interface as <strong>eth0</strong>, we need to add a particular <strong>udev rule</strong> as:</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ sudo nano /media/rootfs/etc/udev/rules.d/70-persistent-net.rules</span><br></pre></td></tr></table></figure>
<p>Add the following content:</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># BeagleBone: net device ()</span></span><br><span class="line">SUBSYSTEM==<span class="string">"net"</span>, ACTION==<span class="string">"add"</span>, DRIVERS==<span class="string">"?*"</span>, ATTR&#123;dev_id&#125;==<span class="string">"0x0"</span>, ATTR&#123;<span class="built_in">type</span>&#125;==<span class="string">"1"</span>, KERNEL==<span class="string">"eth*"</span>, NAME=<span class="string">"eth0"</span></span><br></pre></td></tr></table></figure>
<h3 id="9-remove-tf-card"><a class="markdownIt-Anchor" href="#9-remove-tf-card"></a> 9) Remove TF Card</h3>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">$ sync</span><br><span class="line">$ sudo umount /media/rootfs</span><br></pre></td></tr></table></figure>
<h1 id="part-c-configurations-after-booting-from-the-sd-card"><a class="markdownIt-Anchor" href="#part-c-configurations-after-booting-from-the-sd-card"></a> PART C: Configurations after Booting from the SD Card</h1>
<p>Insert TF card into a <a href="https://beagleboard.org/black" target="_blank" rel="noopener">Beaglebone Black</a>, connect BBB with an Internet cable, and connect a Micro HDMI cable on demand. After the flashing of on-board LEDs, you should be able to find the IP address of BBB via your router. All our future jobs are to be done via ssh command through this IP address. My personal preference is to set a static IP address for this particularly BBB in the router settings.</p>

          
        
      
    </div>

    

    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://longervision.ca/2017/03/18/ComputerVision/OpenCV/opencv-internal-calibration-circle-grid/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="Nobody">
      <meta itemprop="description" content="Longer Vision Technology Github Blog">
      <meta itemprop="image" content="/images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Longer Vision Technology">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2017/03/18/ComputerVision/OpenCV/opencv-internal-calibration-circle-grid/" itemprop="url">
                  Camera Calibration Using a Circle Grid
                </a>
              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">

            
            
            

            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">Posted on</span>
              

              
                
              

              <time title="Created: 2017-03-18 00:00:00" itemprop="dateCreated datePublished" datetime="2017-03-18T00:00:00-07:00">2017-03-18</time>
            

            
              

              
                
                <span class="post-meta-divider">|</span>
                

                <span class="post-meta-item-icon">
                  <i class="fa fa-calendar-check-o"></i>
                </span>
                
                  <span class="post-meta-item-text">Edited on</span>
                
                <time title="Modified: 2019-08-18 14:35:12" itemprop="dateModified" datetime="2019-08-18T14:35:12-07:00">2019-08-18</time>
              
            
          </span>

          
            <span class="post-category">
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">In</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing"><a href="/categories/Computer-Vision/" itemprop="url" rel="index"><span itemprop="name">Computer Vision</span></a></span>

                
                
                  , 
                
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing"><a href="/categories/Computer-Vision/OpenCV/" itemprop="url" rel="index"><span itemprop="name">OpenCV</span></a></span>

                
                
              
            </span>
          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h1 id="preparation"><a class="markdownIt-Anchor" href="#preparation"></a> Preparation</h1>
<p>By reading two of our previous blogs <a href="https://longervision.github.io/2017/03/19/opencv-internal-calibration-chessboard/" target="_blank" rel="noopener">Camera Calibration Using a Chessboard</a> and <a href="https://longervision.github.io/2017/03/13/opencv-external-posture-estimation-circle-grid/" target="_blank" rel="noopener">Camera Posture Estimation Using Circle Grid Pattern</a>, it wouldn’t be hard to replace the chessboard by a circle grid to calculate camera calibration parameters.</p>
<h1 id="coding"><a class="markdownIt-Anchor" href="#coding"></a> Coding</h1>
<p>Our code can be found at <a href="https://github.com/LongerVision/OpenCV_Examples/blob/master/01_internal_camera_calibration/circle_grid.py" target="_blank" rel="noopener">OpenCV Examples</a>.</p>
<h2 id="first-of-all"><a class="markdownIt-Anchor" href="#first-of-all"></a> First of all</h2>
<p>As mentioned in <a href="https://longervision.github.io/2017/03/19/opencv-internal-calibration-chessboard/" target="_blank" rel="noopener">Camera Calibration Using a Chessboard</a>, for intrinsic parameters estimation, namely, camera calibration, there is <strong>NO</strong> need to measure the circle unit size. And the circle gird is to be adopted is exactly the same one as used in <a href="https://longervision.github.io/2017/03/13/opencv-external-posture-estimation-circle-grid/" target="_blank" rel="noopener">Camera Posture Estimation Using Circle Grid Pattern</a>:</p>
<p><img src="https://raw.githubusercontent.com/LongerVision/OpenCV_Examples/master/markers/pattern_acircles.png" alt="asymmetric_circle_grid"></p>
<h2 id="secondly"><a class="markdownIt-Anchor" href="#secondly"></a> Secondly</h2>
<p>Required packages need to be imported.</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> numpy <span class="keyword">as</span> np</span><br><span class="line"><span class="keyword">import</span> cv2</span><br><span class="line"><span class="keyword">import</span> yam</span><br></pre></td></tr></table></figure>
<h2 id="thirdly"><a class="markdownIt-Anchor" href="#thirdly"></a> Thirdly</h2>
<p>Some initialization work need to be done, including: 1) define the termination criteria when refine the corner sub-pixel later on; 2) blob detection parameters; 3) object points coordinators initialization.</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># termination criteria</span></span><br><span class="line">criteria = (cv2.TERM_CRITERIA_EPS + cv2.TERM_CRITERIA_MAX_ITER, <span class="number">30</span>, <span class="number">0.001</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment">########################################Blob Detector##############################################</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># Setup SimpleBlobDetector parameters.</span></span><br><span class="line">blobParams = cv2.SimpleBlobDetector_Params()</span><br><span class="line"></span><br><span class="line"><span class="comment"># Change thresholds</span></span><br><span class="line">blobParams.minThreshold = <span class="number">8</span></span><br><span class="line">blobParams.maxThreshold = <span class="number">255</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># Filter by Area.</span></span><br><span class="line">blobParams.filterByArea = <span class="keyword">True</span></span><br><span class="line">blobParams.minArea = <span class="number">64</span>     <span class="comment"># minArea may be adjusted to suit for your experiment</span></span><br><span class="line">blobParams.maxArea = <span class="number">2500</span>   <span class="comment"># maxArea may be adjusted to suit for your experiment</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># Filter by Circularity</span></span><br><span class="line">blobParams.filterByCircularity = <span class="keyword">True</span></span><br><span class="line">blobParams.minCircularity = <span class="number">0.1</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># Filter by Convexity</span></span><br><span class="line">blobParams.filterByConvexity = <span class="keyword">True</span></span><br><span class="line">blobParams.minConvexity = <span class="number">0.87</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># Filter by Inertia</span></span><br><span class="line">blobParams.filterByInertia = <span class="keyword">True</span></span><br><span class="line">blobParams.minInertiaRatio = <span class="number">0.01</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># Create a detector with the parameters</span></span><br><span class="line">blobDetector = cv2.SimpleBlobDetector_create(blobParams)</span><br><span class="line"></span><br><span class="line"><span class="comment">###################################################################################################</span></span><br><span class="line"></span><br><span class="line"><span class="comment">###################################################################################################</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># Original blob coordinates, supposing all blobs are of z-coordinates 0</span></span><br><span class="line"><span class="comment"># And, the distance between every two neighbour blob circle centers is 72 centimetres</span></span><br><span class="line"><span class="comment"># In fact, any number can be used to replace 72.</span></span><br><span class="line"><span class="comment"># Namely, the real size of the circle is pointless while calculating camera calibration parameters.</span></span><br><span class="line">objp = np.zeros((<span class="number">44</span>, <span class="number">3</span>), np.float32)</span><br><span class="line">objp[<span class="number">0</span>]  = (<span class="number">0</span>  , <span class="number">0</span>  , <span class="number">0</span>)</span><br><span class="line">objp[<span class="number">1</span>]  = (<span class="number">0</span>  , <span class="number">72</span> , <span class="number">0</span>)</span><br><span class="line">objp[<span class="number">2</span>]  = (<span class="number">0</span>  , <span class="number">144</span>, <span class="number">0</span>)</span><br><span class="line">objp[<span class="number">3</span>]  = (<span class="number">0</span>  , <span class="number">216</span>, <span class="number">0</span>)</span><br><span class="line">objp[<span class="number">4</span>]  = (<span class="number">36</span> , <span class="number">36</span> , <span class="number">0</span>)</span><br><span class="line">objp[<span class="number">5</span>]  = (<span class="number">36</span> , <span class="number">108</span>, <span class="number">0</span>)</span><br><span class="line">objp[<span class="number">6</span>]  = (<span class="number">36</span> , <span class="number">180</span>, <span class="number">0</span>)</span><br><span class="line">objp[<span class="number">7</span>]  = (<span class="number">36</span> , <span class="number">252</span>, <span class="number">0</span>)</span><br><span class="line">objp[<span class="number">8</span>]  = (<span class="number">72</span> , <span class="number">0</span>  , <span class="number">0</span>)</span><br><span class="line">objp[<span class="number">9</span>]  = (<span class="number">72</span> , <span class="number">72</span> , <span class="number">0</span>)</span><br><span class="line">objp[<span class="number">10</span>] = (<span class="number">72</span> , <span class="number">144</span>, <span class="number">0</span>)</span><br><span class="line">objp[<span class="number">11</span>] = (<span class="number">72</span> , <span class="number">216</span>, <span class="number">0</span>)</span><br><span class="line">objp[<span class="number">12</span>] = (<span class="number">108</span>, <span class="number">36</span>,  <span class="number">0</span>)</span><br><span class="line">objp[<span class="number">13</span>] = (<span class="number">108</span>, <span class="number">108</span>, <span class="number">0</span>)</span><br><span class="line">objp[<span class="number">14</span>] = (<span class="number">108</span>, <span class="number">180</span>, <span class="number">0</span>)</span><br><span class="line">objp[<span class="number">15</span>] = (<span class="number">108</span>, <span class="number">252</span>, <span class="number">0</span>)</span><br><span class="line">objp[<span class="number">16</span>] = (<span class="number">144</span>, <span class="number">0</span>  , <span class="number">0</span>)</span><br><span class="line">objp[<span class="number">17</span>] = (<span class="number">144</span>, <span class="number">72</span> , <span class="number">0</span>)</span><br><span class="line">objp[<span class="number">18</span>] = (<span class="number">144</span>, <span class="number">144</span>, <span class="number">0</span>)</span><br><span class="line">objp[<span class="number">19</span>] = (<span class="number">144</span>, <span class="number">216</span>, <span class="number">0</span>)</span><br><span class="line">objp[<span class="number">20</span>] = (<span class="number">180</span>, <span class="number">36</span> , <span class="number">0</span>)</span><br><span class="line">objp[<span class="number">21</span>] = (<span class="number">180</span>, <span class="number">108</span>, <span class="number">0</span>)</span><br><span class="line">objp[<span class="number">22</span>] = (<span class="number">180</span>, <span class="number">180</span>, <span class="number">0</span>)</span><br><span class="line">objp[<span class="number">23</span>] = (<span class="number">180</span>, <span class="number">252</span>, <span class="number">0</span>)</span><br><span class="line">objp[<span class="number">24</span>] = (<span class="number">216</span>, <span class="number">0</span>  , <span class="number">0</span>)</span><br><span class="line">objp[<span class="number">25</span>] = (<span class="number">216</span>, <span class="number">72</span> , <span class="number">0</span>)</span><br><span class="line">objp[<span class="number">26</span>] = (<span class="number">216</span>, <span class="number">144</span>, <span class="number">0</span>)</span><br><span class="line">objp[<span class="number">27</span>] = (<span class="number">216</span>, <span class="number">216</span>, <span class="number">0</span>)</span><br><span class="line">objp[<span class="number">28</span>] = (<span class="number">252</span>, <span class="number">36</span> , <span class="number">0</span>)</span><br><span class="line">objp[<span class="number">29</span>] = (<span class="number">252</span>, <span class="number">108</span>, <span class="number">0</span>)</span><br><span class="line">objp[<span class="number">30</span>] = (<span class="number">252</span>, <span class="number">180</span>, <span class="number">0</span>)</span><br><span class="line">objp[<span class="number">31</span>] = (<span class="number">252</span>, <span class="number">252</span>, <span class="number">0</span>)</span><br><span class="line">objp[<span class="number">32</span>] = (<span class="number">288</span>, <span class="number">0</span>  , <span class="number">0</span>)</span><br><span class="line">objp[<span class="number">33</span>] = (<span class="number">288</span>, <span class="number">72</span> , <span class="number">0</span>)</span><br><span class="line">objp[<span class="number">34</span>] = (<span class="number">288</span>, <span class="number">144</span>, <span class="number">0</span>)</span><br><span class="line">objp[<span class="number">35</span>] = (<span class="number">288</span>, <span class="number">216</span>, <span class="number">0</span>)</span><br><span class="line">objp[<span class="number">36</span>] = (<span class="number">324</span>, <span class="number">36</span> , <span class="number">0</span>)</span><br><span class="line">objp[<span class="number">37</span>] = (<span class="number">324</span>, <span class="number">108</span>, <span class="number">0</span>)</span><br><span class="line">objp[<span class="number">38</span>] = (<span class="number">324</span>, <span class="number">180</span>, <span class="number">0</span>)</span><br><span class="line">objp[<span class="number">39</span>] = (<span class="number">324</span>, <span class="number">252</span>, <span class="number">0</span>)</span><br><span class="line">objp[<span class="number">40</span>] = (<span class="number">360</span>, <span class="number">0</span>  , <span class="number">0</span>)</span><br><span class="line">objp[<span class="number">41</span>] = (<span class="number">360</span>, <span class="number">72</span> , <span class="number">0</span>)</span><br><span class="line">objp[<span class="number">42</span>] = (<span class="number">360</span>, <span class="number">144</span>, <span class="number">0</span>)</span><br><span class="line">objp[<span class="number">43</span>] = (<span class="number">360</span>, <span class="number">216</span>, <span class="number">0</span>)</span><br><span class="line"><span class="comment">###################################################################################################</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># Arrays to store object points and image points from all the images.</span></span><br><span class="line">objpoints = [] <span class="comment"># 3d point in real world space</span></span><br><span class="line">imgpoints = [] <span class="comment"># 2d points in image plane.</span></span><br></pre></td></tr></table></figure>
<h2 id="fourthly"><a class="markdownIt-Anchor" href="#fourthly"></a> Fourthly</h2>
<p>After localizing 10 frames (<strong>10</strong> can be changed to any positive integer as you wish) of a grid of 2D circles, camera matrix and distortion coefficients can be calculated by invoking the function <strong>calibrateCamera</strong>. Here, we are testing on a real-time camera stream. Similar to Camera Posture Estimation Using Circle Grid Pattern, the trick is to do <strong>blobDetector.detect()</strong> and draw the detected blobs using <strong>cv2.drawKeypoints()</strong> before invoking <strong>cv2.findCirclesGrid()</strong>, so that the entire grid is easier to be found.</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><span class="line">cap = cv2.VideoCapture(<span class="number">0</span>)</span><br><span class="line">found = <span class="number">0</span></span><br><span class="line"><span class="keyword">while</span>(found &lt; <span class="number">10</span>):  <span class="comment"># Here, 10 can be changed to whatever number you like to choose</span></span><br><span class="line">    ret, img = cap.read() <span class="comment"># Capture frame-by-frame</span></span><br><span class="line">    gray = cv2.cvtColor(img, cv2.COLOR_BGR2GRAY)</span><br><span class="line"></span><br><span class="line">    keypoints = blobDetector.detect(gray) <span class="comment"># Detect blobs.</span></span><br><span class="line"></span><br><span class="line">    <span class="comment"># Draw detected blobs as red circles. This helps cv2.findCirclesGrid() .</span></span><br><span class="line">    im_with_keypoints = cv2.drawKeypoints(img, keypoints, np.array([]), (<span class="number">0</span>,<span class="number">255</span>,<span class="number">0</span>), cv2.DRAW_MATCHES_FLAGS_DRAW_RICH_KEYPOINTS)</span><br><span class="line">    im_with_keypoints_gray = cv2.cvtColor(im_with_keypoints, cv2.COLOR_BGR2GRAY)</span><br><span class="line">    ret, corners = cv2.findCirclesGrid(im_with_keypoints, (<span class="number">4</span>,<span class="number">11</span>), <span class="keyword">None</span>, flags = cv2.CALIB_CB_ASYMMETRIC_GRID)   <span class="comment"># Find the circle grid</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> ret == <span class="keyword">True</span>:</span><br><span class="line">        objpoints.append(objp)  <span class="comment"># Certainly, every loop objp is the same, in 3D.</span></span><br><span class="line"></span><br><span class="line">        corners2 = cv2.cornerSubPix(im_with_keypoints_gray, corners, (<span class="number">11</span>,<span class="number">11</span>), (<span class="number">-1</span>,<span class="number">-1</span>), criteria)    <span class="comment"># Refines the corner locations.</span></span><br><span class="line">        imgpoints.append(corners2)</span><br><span class="line"></span><br><span class="line">        <span class="comment"># Draw and display the corners.</span></span><br><span class="line">        im_with_keypoints = cv2.drawChessboardCorners(img, (<span class="number">4</span>,<span class="number">11</span>), corners2, ret)</span><br><span class="line">        found += <span class="number">1</span></span><br><span class="line"></span><br><span class="line">    cv2.imshow(<span class="string">"img"</span>, im_with_keypoints) <span class="comment"># display</span></span><br><span class="line">    cv2.waitKey(<span class="number">2</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment"># When everything done, release the capture</span></span><br><span class="line">cap.release()</span><br><span class="line">cv2.destroyAllWindows()</span><br><span class="line"></span><br><span class="line">ret, mtx, dist, rvecs, tvecs = cv2.calibrateCamera(objpoints, imgpoints, gray.shape[::<span class="number">-1</span>], <span class="keyword">None</span>, <span class="keyword">None</span>)</span><br></pre></td></tr></table></figure>
<h2 id="finally"><a class="markdownIt-Anchor" href="#finally"></a> Finally</h2>
<p>Write the calculated calibration parameters into a yaml file. Here, it is a bit tricky. Please bear in mind that you <strong>MUST</strong> call function tolist() to transform a numpy array to a list.</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># It's very important to transform the matrix to list.</span></span><br><span class="line">data = &#123;<span class="string">'camera_matrix'</span>: np.asarray(mtx).tolist(), <span class="string">'dist_coeff'</span>: np.asarray(dist).tolist()&#125;</span><br><span class="line"><span class="keyword">with</span> open(<span class="string">"calibration.yaml"</span>, <span class="string">"w"</span>) <span class="keyword">as</span> f:</span><br><span class="line">    yaml.dump(data, f)</span><br></pre></td></tr></table></figure>
<h2 id="additionally"><a class="markdownIt-Anchor" href="#additionally"></a> Additionally</h2>
<p>You may use the following piece of code to load the calibration parameters from file “calibration.yaml”.</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">with</span> open(<span class="string">'calibration.yaml'</span>) <span class="keyword">as</span> f:</span><br><span class="line">    loadeddict = yaml.load(f)</span><br><span class="line">mtxloaded = loadeddict.get(<span class="string">'camera_matrix'</span>)</span><br><span class="line">distloaded = loadeddict.get(<span class="string">'dist_coeff'</span>)</span><br></pre></td></tr></table></figure>

          
        
      
    </div>

    

    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://longervision.ca/2017/03/16/ComputerVision/OpenCV/opencv-internal-calibration-chessboard/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="Nobody">
      <meta itemprop="description" content="Longer Vision Technology Github Blog">
      <meta itemprop="image" content="/images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Longer Vision Technology">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2017/03/16/ComputerVision/OpenCV/opencv-internal-calibration-chessboard/" itemprop="url">
                  Camera Calibration Using a Chessboard
                </a>
              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">

            
            
            

            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">Posted on</span>
              

              
                
              

              <time title="Created: 2017-03-16 00:00:00" itemprop="dateCreated datePublished" datetime="2017-03-16T00:00:00-07:00">2017-03-16</time>
            

            
              

              
                
                <span class="post-meta-divider">|</span>
                

                <span class="post-meta-item-icon">
                  <i class="fa fa-calendar-check-o"></i>
                </span>
                
                  <span class="post-meta-item-text">Edited on</span>
                
                <time title="Modified: 2019-08-18 14:35:09" itemprop="dateModified" datetime="2019-08-18T14:35:09-07:00">2019-08-18</time>
              
            
          </span>

          
            <span class="post-category">
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">In</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing"><a href="/categories/Computer-Vision/" itemprop="url" rel="index"><span itemprop="name">Computer Vision</span></a></span>

                
                
                  , 
                
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing"><a href="/categories/Computer-Vision/OpenCV/" itemprop="url" rel="index"><span itemprop="name">OpenCV</span></a></span>

                
                
              
            </span>
          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h1 id="preparation"><a class="markdownIt-Anchor" href="#preparation"></a> Preparation</h1>
<p>Traditionally, a camera is calibrated using a chessboard. Existing documentations are already out there and have discussed camera calibration in detail, for example, <a href="http://opencv-python-tutroals.readthedocs.io/en/latest/py_tutorials/py_calib3d/py_calibration/py_calibration.html" target="_blank" rel="noopener">OpenCV-Python Tutorials</a>.</p>
<h1 id="coding"><a class="markdownIt-Anchor" href="#coding"></a> Coding</h1>
<p>Our code can be found at <a href="https://github.com/LongerVision/OpenCV_Examples/blob/master/01_internal_camera_calibration/chessboard.py" target="_blank" rel="noopener">OpenCV Examples</a>.</p>
<h2 id="first-of-all"><a class="markdownIt-Anchor" href="#first-of-all"></a> First of all</h2>
<p>Unlike estimating camera postures which is dealing with the extrinsic parameters, camera calibration is to calculate the intrinsic parameters. In such a case, there is <strong>NO</strong> need for us to measure the cell size of the chessboard. Anyway, the adopted chessboard is just an ordinary chessboard as:</p>
<p><img src="https://raw.githubusercontent.com/LongerVision/OpenCV_Examples/master/markers/pattern_chessboard.png" alt="pattern_chessboard"></p>
<h2 id="secondly"><a class="markdownIt-Anchor" href="#secondly"></a> Secondly</h2>
<p>Required packages need to be imported.</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> numpy <span class="keyword">as</span> np</span><br><span class="line"><span class="keyword">import</span> cv2</span><br><span class="line"><span class="keyword">import</span> yaml</span><br></pre></td></tr></table></figure>
<h2 id="thirdly"><a class="markdownIt-Anchor" href="#thirdly"></a> Thirdly</h2>
<p>Some initialization work need to be done, including: 1) define the termination criteria when refine the corner sub-pixel later on; 2) object points coordinators initialization.</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># termination criteria</span></span><br><span class="line">criteria = (cv2.TERM_CRITERIA_EPS + cv2.TERM_CRITERIA_MAX_ITER, <span class="number">30</span>, <span class="number">0.001</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment"># prepare object points, like (0,0,0), (1,0,0), (2,0,0) ....,(6,5,0)</span></span><br><span class="line">objp = np.zeros((<span class="number">6</span>*<span class="number">7</span>,<span class="number">3</span>), np.float32)</span><br><span class="line">objp[:,:<span class="number">2</span>] = np.mgrid[<span class="number">0</span>:<span class="number">7</span>,<span class="number">0</span>:<span class="number">6</span>].T.reshape(<span class="number">-1</span>,<span class="number">2</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment"># Arrays to store object points and image points from all the images.</span></span><br><span class="line">objpoints = [] <span class="comment"># 3d point in real world space</span></span><br><span class="line">imgpoints = [] <span class="comment"># 2d points in image plane.</span></span><br></pre></td></tr></table></figure>
<h2 id="fourthly"><a class="markdownIt-Anchor" href="#fourthly"></a> Fourthly</h2>
<p>After localizing 10 frames (<strong>10</strong> can be changed to any positive integer as you wish) of a grid of 2D chessboard cell corners, camera matrix and distortion coefficients can be calculated by invoking the function <strong>calibrateCamera</strong>. Here, we are testing on a real-time camera stream.</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line">cap = cv2.VideoCapture(<span class="number">0</span>)</span><br><span class="line">found = <span class="number">0</span></span><br><span class="line"><span class="keyword">while</span>(found &lt; <span class="number">10</span>):  <span class="comment"># Here, 10 can be changed to whatever number you like to choose</span></span><br><span class="line">    ret, img = cap.read() <span class="comment"># Capture frame-by-frame</span></span><br><span class="line">    gray = cv2.cvtColor(img, cv2.COLOR_BGR2GRAY)</span><br><span class="line"></span><br><span class="line">    <span class="comment"># Find the chess board corners</span></span><br><span class="line">    ret, corners = cv2.findChessboardCorners(gray, (<span class="number">7</span>,<span class="number">6</span>),<span class="keyword">None</span>)</span><br><span class="line"></span><br><span class="line">    <span class="comment"># If found, add object points, image points (after refining them)</span></span><br><span class="line">    <span class="keyword">if</span> ret == <span class="keyword">True</span>:</span><br><span class="line">        objpoints.append(objp)   <span class="comment"># Certainly, every loop objp is the same, in 3D.</span></span><br><span class="line">        corners2 = cv2.cornerSubPix(gray,corners,(<span class="number">11</span>,<span class="number">11</span>),(<span class="number">-1</span>,<span class="number">-1</span>),criteria)</span><br><span class="line">        imgpoints.append(corners2)</span><br><span class="line"></span><br><span class="line">        <span class="comment"># Draw and display the corners</span></span><br><span class="line">        img = cv2.drawChessboardCorners(img, (<span class="number">7</span>,<span class="number">6</span>), corners2, ret)</span><br><span class="line">        found += <span class="number">1</span></span><br><span class="line"></span><br><span class="line">    cv2.imshow(<span class="string">'img'</span>, img)</span><br><span class="line">    cv2.waitKey(<span class="number">10</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment"># When everything done, release the capture</span></span><br><span class="line">cap.release()</span><br><span class="line">cv2.destroyAllWindows()</span><br><span class="line"></span><br><span class="line">ret, mtx, dist, rvecs, tvecs = cv2.calibrateCamera(objpoints, imgpoints, gray.shape[::<span class="number">-1</span>], <span class="keyword">None</span>, <span class="keyword">None</span>)</span><br></pre></td></tr></table></figure>
<h2 id="finally"><a class="markdownIt-Anchor" href="#finally"></a> Finally</h2>
<p>Write the calculated calibration parameters into a yaml file. Here, it is a bit tricky. Please bear in mind that you <strong>MUST</strong> call function <strong>tolist()</strong> to transform a numpy array to a list.</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># It's very important to transform the matrix to list.</span></span><br><span class="line"></span><br><span class="line">data = &#123;<span class="string">'camera_matrix'</span>: np.asarray(mtx).tolist(), <span class="string">'dist_coeff'</span>: np.asarray(dist).tolist()&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">with</span> open(<span class="string">"calibration.yaml"</span>, <span class="string">"w"</span>) <span class="keyword">as</span> f:</span><br><span class="line">    yaml.dump(data, f)</span><br></pre></td></tr></table></figure>
<h2 id="additionally"><a class="markdownIt-Anchor" href="#additionally"></a> Additionally</h2>
<p>You may use the following piece of code to load the calibration parameters from file “calibration.yaml”.</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">with</span> open(<span class="string">'calibration.yaml'</span>) <span class="keyword">as</span> f:</span><br><span class="line">    loadeddict = yaml.load(f)</span><br><span class="line"></span><br><span class="line">mtxloaded = loadeddict.get(<span class="string">'camera_matrix'</span>)</span><br><span class="line">distloaded = loadeddict.get(<span class="string">'dist_coeff'</span>)</span><br></pre></td></tr></table></figure>

          
        
      
    </div>

    

    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://longervision.ca/2017/03/15/ComputerVision/OpenCV/OpenCV Python ArUco Documentation/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="Nobody">
      <meta itemprop="description" content="Longer Vision Technology Github Blog">
      <meta itemprop="image" content="/images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Longer Vision Technology">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2017/03/15/ComputerVision/OpenCV/OpenCV Python ArUco Documentation/" itemprop="url">
                  OpenCV Python ArUco Documentation
                </a>
              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">

            
            
            

            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">Posted on</span>
              

              
                
              

              <time title="Created: 2017-03-15 00:00:00" itemprop="dateCreated datePublished" datetime="2017-03-15T00:00:00-07:00">2017-03-15</time>
            

            
              

              
                
                <span class="post-meta-divider">|</span>
                

                <span class="post-meta-item-icon">
                  <i class="fa fa-calendar-check-o"></i>
                </span>
                
                  <span class="post-meta-item-text">Edited on</span>
                
                <time title="Modified: 2019-08-18 14:31:57" itemprop="dateModified" datetime="2019-08-18T14:31:57-07:00">2019-08-18</time>
              
            
          </span>

          
            <span class="post-category">
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">In</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing"><a href="/categories/Computer-Vision/" itemprop="url" rel="index"><span itemprop="name">Computer Vision</span></a></span>

                
                
                  , 
                
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing"><a href="/categories/Computer-Vision/OpenCV/" itemprop="url" rel="index"><span itemprop="name">OpenCV</span></a></span>

                
                
              
            </span>
          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h1 id="preparation"><a class="markdownIt-Anchor" href="#preparation"></a> Preparation</h1>
<p>Open a bash terminal, and type in the following commands:</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">$ python</span><br><span class="line">Python 3.5.2 (default, Nov 17 2016, 17:05:23)</span><br><span class="line">[GCC 5.4.0 20160609] on linux</span><br><span class="line">Type <span class="string">"help"</span>, <span class="string">"copyright"</span>, <span class="string">"credits"</span> or <span class="string">"license"</span> <span class="keyword">for</span> more information.</span><br><span class="line">&gt;&gt;&gt; import cv2</span><br><span class="line">&gt;&gt;&gt; <span class="built_in">help</span> (cv2.aruco)</span><br></pre></td></tr></table></figure>
<p>Then, you will be able to see all the doc contents for <strong>cv2.aruco</strong>:</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br></pre></td><td class="code"><pre><span class="line">Help on module cv2.aruco <span class="keyword">in</span> cv2:</span><br><span class="line"></span><br><span class="line">NAME</span><br><span class="line">    cv2.aruco</span><br><span class="line"></span><br><span class="line">FUNCTIONS</span><br><span class="line">    Board_create(...)</span><br><span class="line"></span><br><span class="line">        Board_create(objPoints, dictionary, ids) -&gt; retval</span><br><span class="line"></span><br><span class="line">    CharucoBoard_create(...)</span><br><span class="line"></span><br><span class="line">        CharucoBoard_create(squaresX, squaresY, squareLength, markerLength, dictionary) -&gt; retval</span><br><span class="line"></span><br><span class="line">    DetectorParameters_create(...)</span><br><span class="line"></span><br><span class="line">        DetectorParameters_create() -&gt; retval</span><br><span class="line"></span><br><span class="line">    Dictionary_create(...)</span><br><span class="line"></span><br><span class="line">        Dictionary_create(nMarkers, markerSize) -&gt; retval</span><br><span class="line"></span><br><span class="line">    Dictionary_create_from(...)</span><br><span class="line"></span><br><span class="line">        Dictionary_create_from(nMarkers, markerSize, baseDictionary) -&gt; retval</span><br><span class="line"></span><br><span class="line">    Dictionary_get(...)</span><br><span class="line"></span><br><span class="line">        Dictionary_get(dict) -&gt; retval</span><br><span class="line"></span><br><span class="line">    GridBoard_create(...)</span><br><span class="line"></span><br><span class="line">        GridBoard_create(markersX, markersY, markerLength, markerSeparation, dictionary[, firstMarker]) -&gt; retval</span><br><span class="line"></span><br><span class="line">    calibrateCameraAruco(...)</span><br><span class="line"></span><br><span class="line">        calibrateCameraAruco(corners, ids, counter, board, imageSize, cameraMatrix, distCoeffs[, rvecs[, tvecs[, flags[, criteria]]]]) -&gt; retval, cameraMatrix, distCoeffs, rvecs, tvecs</span><br><span class="line"></span><br><span class="line">    calibrateCameraArucoExtended(...)</span><br><span class="line"></span><br><span class="line">        calibrateCameraArucoExtended(corners, ids, counter, board, imageSize, cameraMatrix, distCoeffs[, rvecs[, tvecs[, stdDeviationsIntrinsics[, stdDeviationsExtrinsics[, perViewErrors[, flags[, criteria]</span><br><span class="line"></span><br><span class="line">]]]]]]) -&gt; retval, cameraMatrix, distCoeffs, rvecs, tvecs, stdDeviationsIntrinsics, stdDeviationsExtrinsics, perViewErrors</span><br><span class="line"></span><br><span class="line">    calibrateCameraCharuco(...)</span><br><span class="line"></span><br><span class="line">        calibrateCameraCharuco(charucoCorners, charucoIds, board, imageSize, cameraMatrix, distCoeffs[, rvecs[, tvecs[, flags[, criteria]]]]) -&gt; retval, cameraMatrix, distCoeffs, rvecs, tvecs</span><br><span class="line"></span><br><span class="line">    calibrateCameraCharucoExtended(...)</span><br><span class="line"></span><br><span class="line">        calibrateCameraCharucoExtended(charucoCorners, charucoIds, board, imageSize, cameraMatrix, distCoeffs[, rvecs[, tvecs[, stdDeviationsIntrinsics[, stdDeviationsExtrinsics[, perViewErrors[, flags[, cr</span><br><span class="line"></span><br><span class="line">iteria]]]]]]]) -&gt; retval, cameraMatrix, distCoeffs, rvecs, tvecs, stdDeviationsIntrinsics, stdDeviationsExtrinsics, perViewErrors</span><br><span class="line"></span><br><span class="line">    custom_dictionary(...)</span><br><span class="line"></span><br><span class="line">        custom_dictionary(nMarkers, markerSize) -&gt; retval</span><br><span class="line"></span><br><span class="line">    custom_dictionary_from(...)</span><br><span class="line"></span><br><span class="line">        custom_dictionary_from(nMarkers, markerSize, baseDictionary) -&gt; retval</span><br><span class="line"></span><br><span class="line">    detectCharucoDiamond(...)</span><br><span class="line"></span><br><span class="line">        detectCharucoDiamond(image, markerCorners, markerIds, squareMarkerLengthRate[, diamondCorners[, diamondIds[, cameraMatrix[, distCoeffs]]]]) -&gt; diamondCorners, diamondIds</span><br><span class="line"></span><br><span class="line">    detectMarkers(...)</span><br><span class="line"></span><br><span class="line">        detectMarkers(image, dictionary[, corners[, ids[, parameters[, rejectedImgPoints]]]]) -&gt; corners, ids, rejectedImgPoints</span><br><span class="line"></span><br><span class="line">    drawAxis(...)</span><br><span class="line"></span><br><span class="line">        drawAxis(image, cameraMatrix, distCoeffs, rvec, tvec, length) -&gt; image</span><br><span class="line"></span><br><span class="line">    drawDetectedCornersCharuco(...)</span><br><span class="line"></span><br><span class="line">        drawDetectedCornersCharuco(image, charucoCorners[, charucoIds[, cornerColor]]) -&gt; image</span><br><span class="line"></span><br><span class="line">    drawDetectedDiamonds(...)</span><br><span class="line"></span><br><span class="line">        drawDetectedDiamonds(image, diamondCorners[, diamondIds[, borderColor]]) -&gt; image</span><br><span class="line"></span><br><span class="line">    drawDetectedMarkers(...)</span><br><span class="line"></span><br><span class="line">        drawDetectedMarkers(image, corners[, ids[, borderColor]]) -&gt; image</span><br><span class="line"></span><br><span class="line">    drawMarker(...)</span><br><span class="line"></span><br><span class="line">        drawMarker(dictionary, id, sidePixels[, img[, borderBits]]) -&gt; img</span><br><span class="line"></span><br><span class="line">    drawPlanarBoard(...)</span><br><span class="line"></span><br><span class="line">        drawPlanarBoard(board, outSize[, img[, marginSize[, borderBits]]]) -&gt; img</span><br><span class="line"></span><br><span class="line">    estimatePoseBoard(...)</span><br><span class="line"></span><br><span class="line">        estimatePoseBoard(corners, ids, board, cameraMatrix, distCoeffs[, rvec[, tvec[, useExtrinsicGuess]]]) -&gt; retval, rvec, tvec</span><br><span class="line"></span><br><span class="line">    estimatePoseCharucoBoard(...)</span><br><span class="line"></span><br><span class="line">        estimatePoseCharucoBoard(charucoCorners, charucoIds, board, cameraMatrix, distCoeffs[, rvec[, tvec[, useExtrinsicGuess]]]) -&gt; retval, rvec, tvec</span><br><span class="line"></span><br><span class="line">    estimatePoseSingleMarkers(...)</span><br><span class="line"></span><br><span class="line">        estimatePoseSingleMarkers(corners, markerLength, cameraMatrix, distCoeffs[, rvecs[, tvecs]]) -&gt; rvecs, tvecs</span><br><span class="line"></span><br><span class="line">    getPredefinedDictionary(...)</span><br><span class="line"></span><br><span class="line">        getPredefinedDictionary(dict) -&gt; retval</span><br><span class="line"></span><br><span class="line">    interpolateCornersCharuco(...)</span><br><span class="line"></span><br><span class="line">        interpolateCornersCharuco(markerCorners, markerIds, image, board[, charucoCorners[, charucoIds[, cameraMatrix[, distCoeffs[, minMarkers]]]]]) -&gt; retval, charucoCorners, charucoIds</span><br><span class="line"></span><br><span class="line">    refineDetectedMarkers(...)</span><br><span class="line"></span><br><span class="line">        refineDetectedMarkers(image, board, detectedCorners, detectedIds, rejectedCorners[, cameraMatrix[, distCoeffs[, minRepDistance[, errorCorrectionRate[, checkAllOrders[, recoveredIdxs[, parameters]]]]]]]) -&gt; detectedCorners, detectedIds, rejectedCorners, recoveredIdxs</span><br><span class="line"></span><br><span class="line">DATA</span><br><span class="line">    DICT_4X4_100 = <span class="number">1</span></span><br><span class="line">    DICT_4X4_1000 = <span class="number">3</span></span><br><span class="line">    DICT_4X4_250 = <span class="number">2</span></span><br><span class="line">    DICT_4X4_50 = <span class="number">0</span></span><br><span class="line">    DICT_5X5_100 = <span class="number">5</span></span><br><span class="line">    DICT_5X5_1000 = <span class="number">7</span></span><br><span class="line">    DICT_5X5_250 = <span class="number">6</span></span><br><span class="line">    DICT_5X5_50 = <span class="number">4</span></span><br><span class="line">    DICT_6X6_100 = <span class="number">9</span></span><br><span class="line">    DICT_6X6_1000 = <span class="number">11</span></span><br><span class="line">    DICT_6X6_250 = <span class="number">10</span></span><br><span class="line">    DICT_6X6_50 = <span class="number">8</span></span><br><span class="line">    DICT_7X7_100 = <span class="number">13</span></span><br><span class="line">    DICT_7X7_1000 = <span class="number">15</span></span><br><span class="line">    DICT_7X7_250 = <span class="number">14</span></span><br><span class="line">    DICT_7X7_50 = <span class="number">12</span></span><br><span class="line">    DICT_ARUCO_ORIGINAL = <span class="number">16</span></span><br><span class="line"></span><br><span class="line">FILE</span><br><span class="line">    (built-<span class="keyword">in</span>)</span><br></pre></td></tr></table></figure>

          
        
      
    </div>

    

    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://longervision.ca/2017/03/14/ComputerVision/OpenCV/opencv-external-posture-estimation-circle-grid/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="Nobody">
      <meta itemprop="description" content="Longer Vision Technology Github Blog">
      <meta itemprop="image" content="/images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Longer Vision Technology">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2017/03/14/ComputerVision/OpenCV/opencv-external-posture-estimation-circle-grid/" itemprop="url">
                  Camera Posture Estimation Using Circle Grid Pattern
                </a>
              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">

            
            
            

            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">Posted on</span>
              

              
                
              

              <time title="Created: 2017-03-14 00:00:00" itemprop="dateCreated datePublished" datetime="2017-03-14T00:00:00-07:00">2017-03-14</time>
            

            
              

              
                
                <span class="post-meta-divider">|</span>
                

                <span class="post-meta-item-icon">
                  <i class="fa fa-calendar-check-o"></i>
                </span>
                
                  <span class="post-meta-item-text">Edited on</span>
                
                <time title="Modified: 2019-08-18 14:35:06" itemprop="dateModified" datetime="2019-08-18T14:35:06-07:00">2019-08-18</time>
              
            
          </span>

          
            <span class="post-category">
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">In</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing"><a href="/categories/Computer-Vision/" itemprop="url" rel="index"><span itemprop="name">Computer Vision</span></a></span>

                
                
                  , 
                
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing"><a href="/categories/Computer-Vision/OpenCV/" itemprop="url" rel="index"><span itemprop="name">OpenCV</span></a></span>

                
                
              
            </span>
          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h1 id="preparation"><a class="markdownIt-Anchor" href="#preparation"></a> Preparation</h1>
<p>A widely used asymmetric circle grid pattern can be found in <a href="http://docs.opencv.org/2.4/_downloads/acircles_pattern.png" target="_blank" rel="noopener">doc of OpenCV 2.4</a>. Same as previous blogs, the camera needs to be calibrated beforehand. For this asymmetric circle grid example, a sequence of images (instead of a video stream) is tested.</p>
<h1 id="coding"><a class="markdownIt-Anchor" href="#coding"></a> Coding</h1>
<p>The code can be found at <a href="https://github.com/LongerVision/OpenCV_Examples/blob/master/02_external_camera_posture_estimation/circle_grid.py" target="_blank" rel="noopener">OpenCV Examples</a>.</p>
<h2 id="first-of-all"><a class="markdownIt-Anchor" href="#first-of-all"></a> First of all</h2>
<p>We need to ensure <strong><a href="http://cv2.so" target="_blank" rel="noopener">cv2.so</a></strong> is under our system path. <strong><a href="http://cv2.so" target="_blank" rel="noopener">cv2.so</a></strong> is specifically for OpenCV Python.</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> sys</span><br><span class="line">sys.path.append(<span class="string">'/usr/local/python/3.5'</span>)</span><br></pre></td></tr></table></figure>
<p>Then, we import some packages to be used (<strong>NO ArUco</strong>).</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> os</span><br><span class="line"><span class="keyword">import</span> cv2</span><br><span class="line"><span class="keyword">import</span> numpy <span class="keyword">as</span> np</span><br></pre></td></tr></table></figure>
<h2 id="secondly"><a class="markdownIt-Anchor" href="#secondly"></a> Secondly</h2>
<p>We now load all camera calibration parameters, including: <strong>cameraMatrix</strong>, <strong>distCoeffs</strong>, etc. For example, your code might look like the following:</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">calibrationFile = <span class="string">"calibrationFileName.xml"</span></span><br><span class="line">calibrationParams = cv2.FileStorage(calibrationFile, cv2.FILE_STORAGE_READ)</span><br><span class="line">camera_matrix = calibrationParams.getNode(<span class="string">"cameraMatrix"</span>).mat()</span><br><span class="line">dist_coeffs = calibrationParams.getNode(<span class="string">"distCoeffs"</span>).mat()</span><br></pre></td></tr></table></figure>
<p>Since we are testing a calibrated fisheye camera, two extra parameters are to be loaded from the calibration file.</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">r = calibrationParams.getNode(<span class="string">"R"</span>).mat()</span><br><span class="line">new_camera_matrix = calibrationParams.getNode(<span class="string">"newCameraMatrix"</span>).mat()</span><br></pre></td></tr></table></figure>
<p>Afterwards, two mapping matrices are pre-calculated by calling function <a href="http://docs.opencv.org/trunk/da/d54/group__imgproc__transform.html#ga7dfb72c9cf9780a347fbe3d1c47e5d5a" target="_blank" rel="noopener">cv2.fisheye.initUndistortRectifyMap()</a> as (supposing the images to be processed are of 1080P):</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">image_size = (<span class="number">1920</span>, <span class="number">1080</span>)</span><br><span class="line">map1, map2 = cv2.fisheye.initUndistortRectifyMap(camera_matrix, dist_coeffs, r, new_camera_matrix, image_size, cv2.CV_16SC2)</span><br></pre></td></tr></table></figure>
<h2 id="thirdly"><a class="markdownIt-Anchor" href="#thirdly"></a> Thirdly</h2>
<p>The circle pattern is to be loaded.</p>
<p><img src="https://raw.githubusercontent.com/LongerVision/OpenCV_Examples/master/markers/pattern_acircles.png" alt="asymmetric_circle_grid"></p>
<p>Here in our case, this asymmetric circle grid pattern is manually loaded as follows:</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># Original blob coordinates</span></span><br><span class="line">objectPoints = np.zeros((<span class="number">44</span>, <span class="number">3</span>))  <span class="comment"># In this asymmetric circle grid, 44 circles are adopted.</span></span><br><span class="line">objectPoints[<span class="number">0</span>]  = (<span class="number">0</span>  , <span class="number">0</span>  , <span class="number">0</span>)</span><br><span class="line">objectPoints[<span class="number">1</span>]  = (<span class="number">0</span>  , <span class="number">72</span> , <span class="number">0</span>)</span><br><span class="line">objectPoints[<span class="number">2</span>]  = (<span class="number">0</span>  , <span class="number">144</span>, <span class="number">0</span>)</span><br><span class="line">objectPoints[<span class="number">3</span>]  = (<span class="number">0</span>  , <span class="number">216</span>, <span class="number">0</span>)</span><br><span class="line">objectPoints[<span class="number">4</span>]  = (<span class="number">36</span> , <span class="number">36</span> , <span class="number">0</span>)</span><br><span class="line">objectPoints[<span class="number">5</span>]  = (<span class="number">36</span> , <span class="number">108</span>, <span class="number">0</span>)</span><br><span class="line">objectPoints[<span class="number">6</span>]  = (<span class="number">36</span> , <span class="number">180</span>, <span class="number">0</span>)</span><br><span class="line">objectPoints[<span class="number">7</span>]  = (<span class="number">36</span> , <span class="number">252</span>, <span class="number">0</span>)</span><br><span class="line">objectPoints[<span class="number">8</span>]  = (<span class="number">72</span> , <span class="number">0</span>  , <span class="number">0</span>)</span><br><span class="line">objectPoints[<span class="number">9</span>]  = (<span class="number">72</span> , <span class="number">72</span> , <span class="number">0</span>)</span><br><span class="line">objectPoints[<span class="number">10</span>] = (<span class="number">72</span> , <span class="number">144</span>, <span class="number">0</span>)</span><br><span class="line">objectPoints[<span class="number">11</span>] = (<span class="number">72</span> , <span class="number">216</span>, <span class="number">0</span>)</span><br><span class="line">objectPoints[<span class="number">12</span>] = (<span class="number">108</span>, <span class="number">36</span>,  <span class="number">0</span>)</span><br><span class="line">objectPoints[<span class="number">13</span>] = (<span class="number">108</span>, <span class="number">108</span>, <span class="number">0</span>)</span><br><span class="line">objectPoints[<span class="number">14</span>] = (<span class="number">108</span>, <span class="number">180</span>, <span class="number">0</span>)</span><br><span class="line">objectPoints[<span class="number">15</span>] = (<span class="number">108</span>, <span class="number">252</span>, <span class="number">0</span>)</span><br><span class="line">objectPoints[<span class="number">16</span>] = (<span class="number">144</span>, <span class="number">0</span>  , <span class="number">0</span>)</span><br><span class="line">objectPoints[<span class="number">17</span>] = (<span class="number">144</span>, <span class="number">72</span> , <span class="number">0</span>)</span><br><span class="line">objectPoints[<span class="number">18</span>] = (<span class="number">144</span>, <span class="number">144</span>, <span class="number">0</span>)</span><br><span class="line">objectPoints[<span class="number">19</span>] = (<span class="number">144</span>, <span class="number">216</span>, <span class="number">0</span>)</span><br><span class="line">objectPoints[<span class="number">20</span>] = (<span class="number">180</span>, <span class="number">36</span> , <span class="number">0</span>)</span><br><span class="line">objectPoints[<span class="number">21</span>] = (<span class="number">180</span>, <span class="number">108</span>, <span class="number">0</span>)</span><br><span class="line">objectPoints[<span class="number">22</span>] = (<span class="number">180</span>, <span class="number">180</span>, <span class="number">0</span>)</span><br><span class="line">objectPoints[<span class="number">23</span>] = (<span class="number">180</span>, <span class="number">252</span>, <span class="number">0</span>)</span><br><span class="line">objectPoints[<span class="number">24</span>] = (<span class="number">216</span>, <span class="number">0</span>  , <span class="number">0</span>)</span><br><span class="line">objectPoints[<span class="number">25</span>] = (<span class="number">216</span>, <span class="number">72</span> , <span class="number">0</span>)</span><br><span class="line">objectPoints[<span class="number">26</span>] = (<span class="number">216</span>, <span class="number">144</span>, <span class="number">0</span>)</span><br><span class="line">objectPoints[<span class="number">27</span>] = (<span class="number">216</span>, <span class="number">216</span>, <span class="number">0</span>)</span><br><span class="line">objectPoints[<span class="number">28</span>] = (<span class="number">252</span>, <span class="number">36</span> , <span class="number">0</span>)</span><br><span class="line">objectPoints[<span class="number">29</span>] = (<span class="number">252</span>, <span class="number">108</span>, <span class="number">0</span>)</span><br><span class="line">objectPoints[<span class="number">30</span>] = (<span class="number">252</span>, <span class="number">180</span>, <span class="number">0</span>)</span><br><span class="line">objectPoints[<span class="number">31</span>] = (<span class="number">252</span>, <span class="number">252</span>, <span class="number">0</span>)</span><br><span class="line">objectPoints[<span class="number">32</span>] = (<span class="number">288</span>, <span class="number">0</span>  , <span class="number">0</span>)</span><br><span class="line">objectPoints[<span class="number">33</span>] = (<span class="number">288</span>, <span class="number">72</span> , <span class="number">0</span>)</span><br><span class="line">objectPoints[<span class="number">34</span>] = (<span class="number">288</span>, <span class="number">144</span>, <span class="number">0</span>)</span><br><span class="line">objectPoints[<span class="number">35</span>] = (<span class="number">288</span>, <span class="number">216</span>, <span class="number">0</span>)</span><br><span class="line">objectPoints[<span class="number">36</span>] = (<span class="number">324</span>, <span class="number">36</span> , <span class="number">0</span>)</span><br><span class="line">objectPoints[<span class="number">37</span>] = (<span class="number">324</span>, <span class="number">108</span>, <span class="number">0</span>)</span><br><span class="line">objectPoints[<span class="number">38</span>] = (<span class="number">324</span>, <span class="number">180</span>, <span class="number">0</span>)</span><br><span class="line">objectPoints[<span class="number">39</span>] = (<span class="number">324</span>, <span class="number">252</span>, <span class="number">0</span>)</span><br><span class="line">objectPoints[<span class="number">40</span>] = (<span class="number">360</span>, <span class="number">0</span>  , <span class="number">0</span>)</span><br><span class="line">objectPoints[<span class="number">41</span>] = (<span class="number">360</span>, <span class="number">72</span> , <span class="number">0</span>)</span><br><span class="line">objectPoints[<span class="number">42</span>] = (<span class="number">360</span>, <span class="number">144</span>, <span class="number">0</span>)</span><br><span class="line">objectPoints[<span class="number">43</span>] = (<span class="number">360</span>, <span class="number">216</span>, <span class="number">0</span>)</span><br></pre></td></tr></table></figure>
<p>In our case, the distance between two neighbour circle centres (in the same column) is measured as 72 centimetres. Meanwhile, the axis at the origin is loaded as well, with respective length 300, 200, 100 centimetres.</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">axis = np.float32([[<span class="number">360</span>,<span class="number">0</span>,<span class="number">0</span>], [<span class="number">0</span>,<span class="number">240</span>,<span class="number">0</span>], [<span class="number">0</span>,<span class="number">0</span>,<span class="number">-120</span>]]).reshape(<span class="number">-1</span>,<span class="number">3</span>)</span><br></pre></td></tr></table></figure>
<h2 id="fourthly"><a class="markdownIt-Anchor" href="#fourthly"></a> Fourthly</h2>
<p>Since we are going to use OpenCV’s SimpleBlobDetector for the blob detection, the SimpleBlobDetector’s parameters are to be created beforehand. The parameter values can be adjusted according to your own testing environments. The iteration <strong>criteria</strong> for the simple blob detection is also created at the same time.</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># Setup SimpleBlobDetector parameters.</span></span><br><span class="line">blobParams = cv2.SimpleBlobDetector_Params()</span><br><span class="line"></span><br><span class="line"><span class="comment"># Change thresholds</span></span><br><span class="line">blobParams.minThreshold = <span class="number">8</span></span><br><span class="line">blobParams.maxThreshold = <span class="number">255</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># Filter by Area.</span></span><br><span class="line">blobParams.filterByArea = <span class="keyword">True</span></span><br><span class="line">blobParams.minArea = <span class="number">64</span>     <span class="comment"># minArea may be adjusted to suit for your experiment</span></span><br><span class="line">blobParams.maxArea = <span class="number">2500</span>   <span class="comment"># maxArea may be adjusted to suit for your experiment</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># Filter by Circularity</span></span><br><span class="line">blobParams.filterByCircularity = <span class="keyword">True</span></span><br><span class="line">blobParams.minCircularity = <span class="number">0.1</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># Filter by Convexity</span></span><br><span class="line">blobParams.filterByConvexity = <span class="keyword">True</span></span><br><span class="line">blobParams.minConvexity = <span class="number">0.87</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># Filter by Inertia</span></span><br><span class="line">blobParams.filterByInertia = <span class="keyword">True</span></span><br><span class="line">blobParams.minInertiaRatio = <span class="number">0.01</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># Create a detector with the parameters</span></span><br><span class="line">blobDetector = cv2.SimpleBlobDetector_create(blobParams)</span><br><span class="line"></span><br><span class="line"><span class="comment"># Create the iteration criteria</span></span><br><span class="line">criteria = (cv2.TERM_CRITERIA_EPS + cv2.TERM_CRITERIA_MAX_ITER, <span class="number">30</span>, <span class="number">0.001</span>)</span><br><span class="line"><span class="comment">###################################################################################################</span></span><br></pre></td></tr></table></figure>
<h2 id="finally"><a class="markdownIt-Anchor" href="#finally"></a> Finally</h2>
<p>Estimate camera postures. Here, we are testing a sequence of images, rather than video streams. We first list all file names in sequence.</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">imgDir = <span class="string">"imgSequence"</span>  <span class="comment"># Specify the image directory</span></span><br><span class="line">imgFileNames = [os.path.join(imgDir, fn) <span class="keyword">for</span> fn <span class="keyword">in</span> next(os.walk(imgDir))[<span class="number">2</span>]]</span><br><span class="line">nbOfImgs = len(imgFileNames)</span><br></pre></td></tr></table></figure>
<p>Then, we calculate the camera posture frame by frame:</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> range(<span class="number">0</span>, nbOfImgs<span class="number">-1</span>):</span><br><span class="line">    img = cv2.imread(imgFileNames[i], cv2.IMREAD_COLOR)</span><br><span class="line">    imgRemapped = cv2.remap(img, map1, map2, cv2.INTER_LINEAR, cv2.BORDER_CONSTANT) <span class="comment"># for fisheye remapping</span></span><br><span class="line">    imgRemapped_gray = cv2.cvtColor(imgRemapped, cv2.COLOR_BGR2GRAY)    <span class="comment"># blobDetector.detect() requires gray image</span></span><br><span class="line"></span><br><span class="line">    keypoints = blobDetector.detect(imgRemapped_gray) <span class="comment"># Detect blobs.</span></span><br><span class="line"></span><br><span class="line">    <span class="comment"># Draw detected blobs as red circles. This helps cv2.findCirclesGrid() .</span></span><br><span class="line">    im_with_keypoints = cv2.drawKeypoints(imgRemapped, keypoints, np.array([]), (<span class="number">0</span>,<span class="number">255</span>,<span class="number">0</span>), cv2.DRAW_MATCHES_FLAGS_DRAW_RICH_KEYPOINTS)</span><br><span class="line">    im_with_keypoints_gray = cv2.cvtColor(im_with_keypoints, cv2.COLOR_BGR2GRAY)</span><br><span class="line">    ret, corners = cv2.findCirclesGrid(im_with_keypoints, (<span class="number">4</span>,<span class="number">11</span>), <span class="keyword">None</span>, flags = cv2.CALIB_CB_ASYMMETRIC_GRID)   <span class="comment"># Find the circle grid</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> ret == <span class="keyword">True</span>:</span><br><span class="line">        corners2 = cv2.cornerSubPix(im_with_keypoints_gray, corners, (<span class="number">11</span>,<span class="number">11</span>), (<span class="number">-1</span>,<span class="number">-1</span>), criteria)    <span class="comment"># Refines the corner locations.</span></span><br><span class="line"></span><br><span class="line">        <span class="comment"># Draw and display the corners.</span></span><br><span class="line">        im_with_keypoints = cv2.drawChessboardCorners(imLeftRemapped, (<span class="number">4</span>,<span class="number">11</span>), corners2, ret)</span><br><span class="line"></span><br><span class="line">        <span class="comment"># 3D posture</span></span><br><span class="line">        <span class="keyword">if</span> len(corners2) == len(objectPoints):</span><br><span class="line">            retval, rvec, tvec = cv2.solvePnP(objectPoints, corners2, camera_matrix, dist_coeffs)</span><br><span class="line"></span><br><span class="line">        <span class="keyword">if</span> retval:</span><br><span class="line">            projectedPoints, jac = cv2.projectPoints(objectPoints, rvec, tvec, camera_matrix, dist_coeffs)  <span class="comment"># project 3D points to image plane</span></span><br><span class="line">            projectedAxis, jacAsix = cv2.projectPoints(axis, rvec, tvec, camera_matrix, dist_coeffs)    <span class="comment"># project axis to image plane</span></span><br><span class="line">            <span class="keyword">for</span> p <span class="keyword">in</span> projectedPoints:</span><br><span class="line">                p = np.int32(p).reshape(<span class="number">-1</span>,<span class="number">2</span>)</span><br><span class="line">                cv2.circle(im_with_keypoints, (p[<span class="number">0</span>][<span class="number">0</span>], p[<span class="number">0</span>][<span class="number">1</span>]), <span class="number">3</span>, (<span class="number">0</span>,<span class="number">0</span>,<span class="number">255</span>))</span><br><span class="line">            origin = tuple(corners2[<span class="number">0</span>].ravel())</span><br><span class="line">            im_with_keypoints = cv2.line(im_with_keypoints, origin, tuple(projectedAxis[<span class="number">0</span>].ravel()), (<span class="number">255</span>,<span class="number">0</span>,<span class="number">0</span>), <span class="number">2</span>)</span><br><span class="line">            im_with_keypoints = cv2.line(im_with_keypoints, origin, tuple(projectedAxis[<span class="number">1</span>].ravel()), (<span class="number">0</span>,<span class="number">255</span>,<span class="number">0</span>), <span class="number">2</span>)</span><br><span class="line">            im_with_keypoints = cv2.line(im_with_keypoints, origin, tuple(projectedAxis[<span class="number">2</span>].ravel()), (<span class="number">0</span>,<span class="number">0</span>,<span class="number">255</span>), <span class="number">2</span>)</span><br><span class="line"></span><br><span class="line">    cv2.imshow(<span class="string">"circlegrid"</span>, im_with_keypoints) <span class="comment"># display</span></span><br><span class="line"></span><br><span class="line">    cv2.waitKey(<span class="number">2</span>)</span><br></pre></td></tr></table></figure>
<p>The drawn axis is just the world coordinators and orientations estimated from the images taken by the testing camera.</p>

          
        
      
    </div>

    

    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://longervision.ca/2017/03/13/ComputerVision/OpenCV/opencv-external-posture-estimation-ChArUco-board/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="Nobody">
      <meta itemprop="description" content="Longer Vision Technology Github Blog">
      <meta itemprop="image" content="/images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Longer Vision Technology">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2017/03/13/ComputerVision/OpenCV/opencv-external-posture-estimation-ChArUco-board/" itemprop="url">
                  Camera Posture Estimation Using A ChArUco Board
                </a>
              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">

            
            
            

            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">Posted on</span>
              

              
                
              

              <time title="Created: 2017-03-13 00:00:00" itemprop="dateCreated datePublished" datetime="2017-03-13T00:00:00-07:00">2017-03-13</time>
            

            
              

              
                
                <span class="post-meta-divider">|</span>
                

                <span class="post-meta-item-icon">
                  <i class="fa fa-calendar-check-o"></i>
                </span>
                
                  <span class="post-meta-item-text">Edited on</span>
                
                <time title="Modified: 2019-08-18 14:35:03" itemprop="dateModified" datetime="2019-08-18T14:35:03-07:00">2019-08-18</time>
              
            
          </span>

          
            <span class="post-category">
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">In</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing"><a href="/categories/Computer-Vision/" itemprop="url" rel="index"><span itemprop="name">Computer Vision</span></a></span>

                
                
                  , 
                
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing"><a href="/categories/Computer-Vision/OpenCV/" itemprop="url" rel="index"><span itemprop="name">OpenCV</span></a></span>

                
                
              
            </span>
          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h1 id="preparation"><a class="markdownIt-Anchor" href="#preparation"></a> Preparation</h1>
<p>ChAruco is an integrated marker, which combines a chessboard with an aruco marker. The code is also very similar to the code in our previous blog <a href="https://longervision.github.io/2017/03/12/opencv-external-posture-estimation-ArUco-board/" target="_blank" rel="noopener">aruco board</a>.</p>
<h1 id="coding"><a class="markdownIt-Anchor" href="#coding"></a> Coding</h1>
<p>The code can be found at <a href="https://github.com/LongerVision/OpenCV_Examples/blob/master/02_external_camera_posture_estimation/ChArUco_board.py" target="_blank" rel="noopener">OpenCV Examples</a>. And the code in the first two subsections are exactly the same as what’s written in our previous blogs. We’ll neglect the first two subsections ever since.</p>
<h2 id="first-of-all"><a class="markdownIt-Anchor" href="#first-of-all"></a> First of all</h2>
<p>Exactly the same as in previous blogs.</p>
<h2 id="secondly"><a class="markdownIt-Anchor" href="#secondly"></a> Secondly</h2>
<p>Exactly the same as in previous blogs.</p>
<h2 id="thirdly"><a class="markdownIt-Anchor" href="#thirdly"></a> Thirdly</h2>
<p>Dictionary <strong>aruco.DICT_6X6_1000</strong> is integrated with a chessboard to construct a grid charuco board. The experimenting board is of size <strong>5X7</strong>, which looks like:</p>
<p><img src="https://raw.githubusercontent.com/LongerVision/OpenCV_Examples/master/markers/board_charuco_57.png" alt="charuco.DICT_6X6_1000.board57"></p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">aruco_dict = aruco.Dictionary_get( aruco.DICT_6X6_1000 )</span><br></pre></td></tr></table></figure>
<p>After having this aruco board marker printed, the edge lengths of this chessboard and aruco marker (displayed in the white cell of the chessboard) are to be measured and stored in two variables <strong>squareLength</strong> and <strong>markerLength</strong>, which are used to create the <strong>5X7</strong> grid board.</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">squareLength = <span class="number">40</span>   <span class="comment"># Here, our measurement unit is centimetre.</span></span><br><span class="line">markerLength = <span class="number">30</span>   <span class="comment"># Here, our measurement unit is centimetre.</span></span><br><span class="line">board = aruco.CharucoBoard_create(<span class="number">5</span>, <span class="number">7</span>, squareLength, markerLength, aruco_dict)</span><br></pre></td></tr></table></figure>
<p>Meanwhile, create aruco detector with default parameters.</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">arucoParams = aruco.DetectorParameters_create()</span><br></pre></td></tr></table></figure>
<h2 id="finally"><a class="markdownIt-Anchor" href="#finally"></a> Finally</h2>
<p>Now, let’s test on a video stream, a .mp4 file.</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">videoFile = <span class="string">"charuco_board_57.mp4"</span></span><br><span class="line">cap = cv2.VideoCapture(videoFile)</span><br></pre></td></tr></table></figure>
<p>Then, we calculate the camera posture frame by frame:</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">while</span>(<span class="keyword">True</span>):</span><br><span class="line">    ret, frame = cap.read() <span class="comment"># Capture frame-by-frame</span></span><br><span class="line">    <span class="keyword">if</span> ret == <span class="keyword">True</span>:</span><br><span class="line">        frame_remapped = cv2.remap(frame, map1, map2, cv2.INTER_LINEAR, cv2.BORDER_CONSTANT)    <span class="comment"># for fisheye remapping</span></span><br><span class="line">        frame_remapped_gray = cv2.cvtColor(frame_remapped, cv2.COLOR_BGR2GRAY)</span><br><span class="line"></span><br><span class="line">        corners, ids, rejectedImgPoints = aruco.detectMarkers(frame_remapped_gray, aruco_dict, parameters=arucoParams)  <span class="comment"># First, detect markers</span></span><br><span class="line">        aruco.refineDetectedMarkers(frame_remapped_gray, board, corners, ids, rejectedImgPoints)</span><br><span class="line"></span><br><span class="line">        <span class="keyword">if</span> ids != <span class="keyword">None</span>: <span class="comment"># if there is at least one marker detected</span></span><br><span class="line">            charucoretval, charucoCorners, charucoIds = aruco.interpolateCornersCharuco(corners, ids, frame_remapped_gray, board)</span><br><span class="line">            im_with_charuco_board = aruco.drawDetectedCornersCharuco(frame_remapped, charucoCorners, charucoIds, (<span class="number">0</span>,<span class="number">255</span>,<span class="number">0</span>))</span><br><span class="line">            retval, rvec, tvec = aruco.estimatePoseCharucoBoard(charucoCorners, charucoIds, board, camera_matrix, dist_coeffs)  <span class="comment"># posture estimation from a charuco board</span></span><br><span class="line">            <span class="keyword">if</span> retval == <span class="keyword">True</span>:</span><br><span class="line">                im_with_charuco_board = aruco.drawAxis(im_with_charuco_board, camera_matrix, dist_coeffs, rvec, tvec, <span class="number">100</span>)  <span class="comment"># axis length 100 can be changed according to your requirement</span></span><br><span class="line">        <span class="keyword">else</span>:</span><br><span class="line">            im_with_charuco_left = frame_remapped</span><br><span class="line"></span><br><span class="line">        cv2.imshow(<span class="string">"charucoboard"</span>, im_with_charuco_board)</span><br><span class="line"></span><br><span class="line">        <span class="keyword">if</span> cv2.waitKey(<span class="number">2</span>) &amp; <span class="number">0xFF</span> == ord(<span class="string">'q'</span>):</span><br><span class="line">            <span class="keyword">break</span></span><br><span class="line">    <span class="keyword">else</span>:</span><br><span class="line">        <span class="keyword">break</span></span><br></pre></td></tr></table></figure>
<p>The drawn axis is just the world coordinators and orientations estimated from the images taken by the testing camera.<br>
At the end of the code, we release the video capture handle and destroy all opening windows.</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">cap.release()   <span class="comment"># When everything done, release the capture</span></span><br><span class="line">cv2.destroyAllWindows()</span><br></pre></td></tr></table></figure>

          
        
      
    </div>

    

    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://longervision.ca/2017/03/12/ComputerVision/OpenCV/opencv-external-posture-estimation-ArUco-board/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="Nobody">
      <meta itemprop="description" content="Longer Vision Technology Github Blog">
      <meta itemprop="image" content="/images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Longer Vision Technology">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2017/03/12/ComputerVision/OpenCV/opencv-external-posture-estimation-ArUco-board/" itemprop="url">
                  Camera Posture Estimation Using An ArUco Board
                </a>
              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">

            
            
            

            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">Posted on</span>
              

              
                
              

              <time title="Created: 2017-03-12 00:00:00" itemprop="dateCreated datePublished" datetime="2017-03-12T00:00:00-08:00">2017-03-12</time>
            

            
              

              
                
                <span class="post-meta-divider">|</span>
                

                <span class="post-meta-item-icon">
                  <i class="fa fa-calendar-check-o"></i>
                </span>
                
                  <span class="post-meta-item-text">Edited on</span>
                
                <time title="Modified: 2019-08-18 14:34:53" itemprop="dateModified" datetime="2019-08-18T14:34:53-07:00">2019-08-18</time>
              
            
          </span>

          
            <span class="post-category">
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">In</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing"><a href="/categories/Computer-Vision/" itemprop="url" rel="index"><span itemprop="name">Computer Vision</span></a></span>

                
                
                  , 
                
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing"><a href="/categories/Computer-Vision/OpenCV/" itemprop="url" rel="index"><span itemprop="name">OpenCV</span></a></span>

                
                
              
            </span>
          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h1 id="preparation"><a class="markdownIt-Anchor" href="#preparation"></a> Preparation</h1>
<p>Today, let’s test on an aruco board, instead of a <a href="https://longervision.github.io/2017/03/10/opencv-external-posture-estimation-ArUco-single-marker/" target="_blank" rel="noopener">single marker</a> or a <a href="https://longervision.github.io/2017/03/11/opencv-external-posture-estimation-ArUco-diamond/" target="_blank" rel="noopener">diamond marker</a>. Again, you need to make sure your camera has already been calibrated. In the coding section, it’s assumed that you can successfully load the camera calibration parameters.</p>
<h1 id="coding"><a class="markdownIt-Anchor" href="#coding"></a> Coding</h1>
<p>The code can be found at <a href="https://github.com/LongerVision/OpenCV_Examples/blob/master/02_external_camera_posture_estimation/ArUco_single_marker.py" target="_blank" rel="noopener">OpenCV Examples</a>.</p>
<h2 id="first-of-all"><a class="markdownIt-Anchor" href="#first-of-all"></a> First of all</h2>
<p>We need to ensure <strong><a href="http://cv2.so" target="_blank" rel="noopener">cv2.so</a></strong> is under our system path. <strong><a href="http://cv2.so" target="_blank" rel="noopener">cv2.so</a></strong> is specifically for OpenCV Python.</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">import sys</span><br><span class="line">sys.path.append(<span class="string">'/usr/local/python/3.5'</span>)</span><br></pre></td></tr></table></figure>
<p>Then, we import some packages to be used.</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> os</span><br><span class="line"><span class="keyword">import</span> cv2</span><br><span class="line"><span class="keyword">from</span> cv2 <span class="keyword">import</span> aruco</span><br><span class="line"><span class="keyword">import</span> numpy <span class="keyword">as</span> np</span><br></pre></td></tr></table></figure>
<h2 id="secondly"><a class="markdownIt-Anchor" href="#secondly"></a> Secondly</h2>
<p>Again, we need to load all camera calibration parameters, including: <strong>cameraMatrix</strong>, <strong>distCoeffs</strong>, etc. :</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">calibrationFile = <span class="string">"calibrationFileName.xml"</span></span><br><span class="line">calibrationParams = cv2.FileStorage(calibrationFile, cv2.FILE_STORAGE_READ)</span><br><span class="line">camera_matrix = calibrationParams.getNode(<span class="string">"cameraMatrix"</span>).mat()</span><br><span class="line">dist_coeffs = calibrationParams.getNode(<span class="string">"distCoeffs"</span>).mat()</span><br></pre></td></tr></table></figure>
<p>If you are using a calibrated fisheye camera like us, two extra parameters are to be loaded from the calibration file.</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">r = calibrationParams.getNode(<span class="string">"R"</span>).mat()</span><br><span class="line">new_camera_matrix = calibrationParams.getNode(<span class="string">"newCameraMatrix"</span>).mat()</span><br></pre></td></tr></table></figure>
<p>Afterwards, two mapping matrices are pre-calculated by calling function <a href="http://docs.opencv.org/trunk/da/d54/group__imgproc__transform.html#ga7dfb72c9cf9780a347fbe3d1c47e5d5a" target="_blank" rel="noopener">cv2.fisheye.initUndistortRectifyMap()</a> as (supposing the images to be processed are of 1080P):</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">image_size = (<span class="number">1920</span>, <span class="number">1080</span>)</span><br><span class="line">map1, map2 = cv2.fisheye.initUndistortRectifyMap(camera_matrix, dist_coeffs, r, new_camera_matrix, image_size, cv2.CV_16SC2)</span><br></pre></td></tr></table></figure>
<h2 id="thirdly"><a class="markdownIt-Anchor" href="#thirdly"></a> Thirdly</h2>
<p>In our test, the dictionary <strong>aruco.DICT_6X6_1000</strong> is adopted as the unit pattern to construct a grid board. The board is of size <strong>5X7</strong>, which looks like:</p>
<p><img src="https://raw.githubusercontent.com/LongerVision/OpenCV_Examples/master/markers/board_aruco_57.png" alt="aruco.DICT_6X6_1000.board57"></p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">aruco_dict = aruco.Dictionary_get( aruco.DICT_6X6_1000 )</span><br></pre></td></tr></table></figure>
<p>After having this aruco board marker printed, the edge lengths of this particular aruco marker and the distance between two neighbour markers are to be measured and stored in two variables <strong>markerLength</strong> and <strong>markerSeparation</strong>, which are used to create the <strong>5X7</strong> grid board.</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">markerLength = <span class="number">40</span>   <span class="comment"># Here, our measurement unit is centimetre.</span></span><br><span class="line">markerSeparation = <span class="number">8</span>   <span class="comment"># Here, our measurement unit is centimetre.</span></span><br><span class="line">board = aruco.GridBoard_create(<span class="number">5</span>, <span class="number">7</span>, markerLength, markerSeparation, aruco_dict)</span><br></pre></td></tr></table></figure>
<p>Meanwhile, create aruco detector with default parameters.</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">arucoParams = aruco.DetectorParameters_create()</span><br></pre></td></tr></table></figure>
<h2 id="finally"><a class="markdownIt-Anchor" href="#finally"></a> Finally</h2>
<p>Now, let’s test on a video stream, a .mp4 file. We first load the video file and initialize a video capture handle.</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">videoFile = <span class="string">"aruco\_board\_57.mp4"</span></span><br><span class="line">cap = cv2.VideoCapture(videoFile)</span><br></pre></td></tr></table></figure>
<p>Then, we calculate the camera posture frame by frame:</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">while</span>(<span class="keyword">True</span>):</span><br><span class="line">    ret, frame = cap.read() <span class="comment"># Capture frame-by-frame</span></span><br><span class="line">    <span class="keyword">if</span> ret == <span class="keyword">True</span>:</span><br><span class="line">        frame_remapped = cv2.remap(frame, map1, map2, cv2.INTER_LINEAR, cv2.BORDER_CONSTANT)     <span class="comment"># for fisheye remapping</span></span><br><span class="line">        frame_remapped_gray = cv2.cvtColor(frame_remapped, cv2.COLOR_BGR2GRAY)</span><br><span class="line"></span><br><span class="line">        corners, ids, rejectedImgPoints = aruco.detectMarkers(frame_remapped_gray, aruco_dict, parameters=arucoParams)  <span class="comment"># First, detect markers</span></span><br><span class="line">        aruco.refineDetectedMarkers(frame_remapped_gray, board, corners, ids, rejectedImgPoints)</span><br><span class="line"></span><br><span class="line">        <span class="keyword">if</span> ids != <span class="keyword">None</span>: <span class="comment"># if there is at least one marker detected</span></span><br><span class="line">            im_with_aruco_board = aruco.drawDetectedMarkers(frame_remapped, corners, ids, (<span class="number">0</span>,<span class="number">255</span>,<span class="number">0</span>))</span><br><span class="line">            retval, rvec, tvec = aruco.estimatePoseBoard(corners, ids, board, camera_matrix, dist_coeffs)  <span class="comment"># posture estimation from a diamond</span></span><br><span class="line">            <span class="keyword">if</span> retval != <span class="number">0</span>:</span><br><span class="line">                im_with_aruco_board = aruco.drawAxis(im_with_aruco_board, camera_matrix, dist_coeffs, rvec, tvec, <span class="number">100</span>)  <span class="comment"># axis length 100 can be changed according to your requirement</span></span><br><span class="line">        <span class="keyword">else</span>:</span><br><span class="line">            im_with_aruco_board = frame_remapped</span><br><span class="line"></span><br><span class="line">        cv2.imshow(<span class="string">"arucoboard"</span>, im_with_aruco_board)</span><br><span class="line"></span><br><span class="line">        <span class="keyword">if</span> cv2.waitKey(<span class="number">2</span>) &amp; <span class="number">0xFF</span> == ord(<span class="string">'q'</span>):</span><br><span class="line">            <span class="keyword">break</span></span><br><span class="line">    <span class="keyword">else</span>:</span><br><span class="line">        <span class="keyword">break</span></span><br></pre></td></tr></table></figure>
<p>The drawn axis is just the world coordinators and orientations estimated from the images taken by the testing camera.<br>
At the end of the code, we release the video capture handle and destroy all opening windows.</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">cap.release()   <span class="comment"># When everything done, release the capture</span></span><br><span class="line">cv2.destroyAllWindows()</span><br></pre></td></tr></table></figure>

          
        
      
    </div>

    

    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://longervision.ca/2017/03/11/ComputerVision/OpenCV/opencv-external-posture-estimation-ArUco-diamond/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="Nobody">
      <meta itemprop="description" content="Longer Vision Technology Github Blog">
      <meta itemprop="image" content="/images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Longer Vision Technology">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2017/03/11/ComputerVision/OpenCV/opencv-external-posture-estimation-ArUco-diamond/" itemprop="url">
                  Camera Posture Estimation Using An ArUco Diamond Marker
                </a>
              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">

            
            
            

            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">Posted on</span>
              

              
                
              

              <time title="Created: 2017-03-11 00:00:00" itemprop="dateCreated datePublished" datetime="2017-03-11T00:00:00-08:00">2017-03-11</time>
            

            
              

              
                
                <span class="post-meta-divider">|</span>
                

                <span class="post-meta-item-icon">
                  <i class="fa fa-calendar-check-o"></i>
                </span>
                
                  <span class="post-meta-item-text">Edited on</span>
                
                <time title="Modified: 2019-08-18 14:34:56" itemprop="dateModified" datetime="2019-08-18T14:34:56-07:00">2019-08-18</time>
              
            
          </span>

          
            <span class="post-category">
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">In</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing"><a href="/categories/Computer-Vision/" itemprop="url" rel="index"><span itemprop="name">Computer Vision</span></a></span>

                
                
                  , 
                
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing"><a href="/categories/Computer-Vision/OpenCV/" itemprop="url" rel="index"><span itemprop="name">OpenCV</span></a></span>

                
                
              
            </span>
          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h1 id="preparation"><a class="markdownIt-Anchor" href="#preparation"></a> Preparation</h1>
<p>Very similar to our previous post <a href="https://longervision.github.io/2017/03/10/opencv-external-posture-estimation-ArUco-single-marker/" target="_blank" rel="noopener">Camera Posture Estimation Using A Single aruco Marker</a>, you need to make sure your camera has already been calibrated. In the coding section, it’s assumed that you can successfully load the camera calibration parameters.</p>
<h1 id="coding"><a class="markdownIt-Anchor" href="#coding"></a> Coding</h1>
<p>The code can be found at <a href="https://github.com/LongerVision/OpenCV_Examples/blob/master/02_external_camera_posture_estimation/ArUco_diamond.py" target="_blank" rel="noopener">OpenCV Examples</a>.</p>
<h2 id="first-of-all"><a class="markdownIt-Anchor" href="#first-of-all"></a> First of all</h2>
<p>We need to ensure <strong><a href="http://cv2.so" target="_blank" rel="noopener">cv2.so</a></strong> is under our system path. <strong><a href="http://cv2.so" target="_blank" rel="noopener">cv2.so</a></strong> is specifically for OpenCV Python.</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> sys</span><br><span class="line">sys.path.append(<span class="string">'/usr/local/python/3.5'</span>)</span><br></pre></td></tr></table></figure>
<p>Then, we import some packages to be used.</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> os</span><br><span class="line"><span class="keyword">import</span> cv2</span><br><span class="line"><span class="keyword">from</span> cv2 <span class="keyword">import</span> aruco</span><br><span class="line"><span class="keyword">import</span> numpy <span class="keyword">as</span> np</span><br></pre></td></tr></table></figure>
<h2 id="secondly"><a class="markdownIt-Anchor" href="#secondly"></a> Secondly</h2>
<p>Again, we need to load all camera calibration parameters, including: <strong>cameraMatrix</strong>, <strong>distCoeffs</strong>, etc. :</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">calibrationFile = <span class="string">"calibrationFileName.xml"</span></span><br><span class="line">calibrationParams = cv2.FileStorage(calibrationFile, cv2.FILE_STORAGE_READ)</span><br><span class="line">camera_matrix = calibrationParams.getNode(<span class="string">"cameraMatrix"</span>).mat()</span><br><span class="line">dist_coeffs = calibrationParams.getNode(<span class="string">"distCoeffs"</span>).mat()</span><br></pre></td></tr></table></figure>
<p>If you are using a calibrated fisheye camera like us, two extra parameters are to be loaded from the calibration file.</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">r = calibrationParams.getNode(<span class="string">"R"</span>).mat()</span><br><span class="line">new_camera_matrix = calibrationParams.getNode(<span class="string">"newCameraMatrix"</span>).mat()</span><br></pre></td></tr></table></figure>
<p>Afterwards, two mapping matrices are pre-calculated by calling function <a href="http://docs.opencv.org/trunk/da/d54/group__imgproc__transform.html#ga7dfb72c9cf9780a347fbe3d1c47e5d5a" target="_blank" rel="noopener">cv2.fisheye.initUndistortRectifyMap()</a> as (supposing the images to be processed are of 1080P):</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">image_size = (<span class="number">1920</span>, <span class="number">1080</span>)</span><br><span class="line">map1, map2 = cv2.fisheye.initUndistortRectifyMap(camera_matrix, dist_coeffs, r, new_camera_matrix, image_size, cv2.CV_16SC2)</span><br></pre></td></tr></table></figure>
<h2 id="thirdly"><a class="markdownIt-Anchor" href="#thirdly"></a> Thirdly</h2>
<p>The dictionary <strong>aruco.DICT_6X6_250</strong> is to be loaded. Although current OpenCV provides four groups of <a href="http://docs.opencv.org/trunk/d9/d6a/group__aruco.html" target="_blank" rel="noopener">aruco</a> patterns, <strong>4X4</strong>, <strong>5X5</strong>, <strong>6X6</strong>, <strong>7X7</strong>, etc., it seems OpenCV Python does NOT provide a function named <a href="http://docs.opencv.org/trunk/d9/d6a/group__aruco.html#gaf71fb897d5f03f7424c0c84715aa6228" target="_blank" rel="noopener">drawCharucoDiamond()</a>. Therefore, we have to refer to the C++ tutorial <a href="http://docs.opencv.org/trunk/d5/d07/tutorial_charuco_diamond_detection.html" target="_blank" rel="noopener">Detection of Diamond Markers</a>. And, we directly use this particular diamond marker in the tutorial:</p>
<p><img src="https://raw.githubusercontent.com/LongerVision/OpenCV_Examples/master/markers/board_charuco_diamond.png" alt="aruco.DICT_6X6_250.diamond"></p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">aruco_dict = aruco.Dictionary_get( aruco.DICT_6X6_250 )</span><br></pre></td></tr></table></figure>
<p>After having this aruco diamond marker printed, the edge lengths of this particular diamond marker are to be measured and stored in two variables <strong>squareLength</strong> and <strong>markerLength</strong>.</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">squareLength = <span class="number">40</span>   <span class="comment"># Here, our measurement unit is centimetre.</span></span><br><span class="line">markerLength = <span class="number">25</span>   <span class="comment"># Here, our measurement unit is centimetre.</span></span><br></pre></td></tr></table></figure>
<p>Meanwhile, create aruco detector with default parameters.</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">arucoParams = aruco.DetectorParameters_create()</span><br></pre></td></tr></table></figure>
<h2 id="finally"><a class="markdownIt-Anchor" href="#finally"></a> Finally</h2>
<p>This time, let’s test on a video stream, a .mp4 file. We first load the video file and initialize a video capture handle.</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">videoFile = <span class="string">"aruco_diamond.mp4"</span></span><br><span class="line">cap = cv2.VideoCapture(videoFile)</span><br></pre></td></tr></table></figure>
<p>Then, we calculate the camera posture frame by frame:</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">while</span>(<span class="keyword">True</span>):</span><br><span class="line">    ret, frame = cap.read() <span class="comment"># Capture frame-by-frame</span></span><br><span class="line">    <span class="keyword">if</span> ret == <span class="keyword">True</span>:</span><br><span class="line">        frame_remapped = cv2.remap(frame, map1, map2, cv2.INTER_LINEAR, cv2.BORDER_CONSTANT)     <span class="comment"># for fisheye remapping</span></span><br><span class="line">        frame_remapped_gray = cv2.cvtColor(frame_remapped, cv2.COLOR_BGR2GRAY)</span><br><span class="line"></span><br><span class="line">        corners, ids, rejectedImgPoints = aruco.detectMarkers(frame_remapped_gray, aruco_dict, parameters=arucoParams)  <span class="comment"># First, detect markers</span></span><br><span class="line"></span><br><span class="line">        <span class="keyword">if</span> ids != <span class="keyword">None</span>: <span class="comment"># if there is at least one marker detected</span></span><br><span class="line">            diamondCorners, diamondIds = aruco.detectCharucoDiamond(frame_remapped_gray, corners, ids, squareLength/markerLength)   <span class="comment"># Second, detect diamond markers</span></span><br><span class="line">            <span class="keyword">if</span> len(diamondCorners) &gt;= <span class="number">1</span>:    <span class="comment"># if there is at least one diamond detected</span></span><br><span class="line">                im_with_diamond = aruco.drawDetectedDiamonds(frame_remapped, diamondCorners, diamondIds, (<span class="number">0</span>,<span class="number">255</span>,<span class="number">0</span>))</span><br><span class="line">                rvec, tvec = aruco.estimatePoseSingleMarkers(diamondCorners, squareLength, camera_matrix, dist_coeffs)  <span class="comment"># posture estimation from a diamond</span></span><br><span class="line">                im_with_diamond = aruco.drawAxis(im_with_diamond, camera_matrix, dist_coeffs, rvec, tvec, <span class="number">100</span>)  <span class="comment"># axis length 100 can be changed according to your requirement</span></span><br><span class="line">        <span class="keyword">else</span>:</span><br><span class="line">            im_with_diamond = frame_remapped</span><br><span class="line"></span><br><span class="line">        cv2.imshow(<span class="string">"diamondLeft"</span>, im_with_diamond)   <span class="comment"># display</span></span><br><span class="line"></span><br><span class="line">        <span class="keyword">if</span> cv2.waitKey(<span class="number">2</span>) &amp; <span class="number">0xFF</span> == ord(<span class="string">'q'</span>):   <span class="comment"># press 'q' to quit</span></span><br><span class="line">            <span class="keyword">break</span></span><br><span class="line">    <span class="keyword">else</span>:</span><br><span class="line">        <span class="keyword">break</span></span><br></pre></td></tr></table></figure>
<p>The drawn axis is just the world coordinators and orientations estimated from the images taken by the testing camera.<br>
At the end of the code, we release the video capture handle and destroy all opening windows.</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">cap.release()   <span class="comment"># When everything done, release the capture</span></span><br><span class="line">cv2.destroyAllWindows()</span><br></pre></td></tr></table></figure>

          
        
      
    </div>

    

    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://longervision.ca/2017/03/10/ComputerVision/OpenCV/opencv-external-posture-estimation-ArUco-single-marker/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="Nobody">
      <meta itemprop="description" content="Longer Vision Technology Github Blog">
      <meta itemprop="image" content="/images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Longer Vision Technology">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2017/03/10/ComputerVision/OpenCV/opencv-external-posture-estimation-ArUco-single-marker/" itemprop="url">
                  Camera Posture Estimation Using A Single ArUco Marker
                </a>
              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">

            
            
            

            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">Posted on</span>
              

              
                
              

              <time title="Created: 2017-03-10 00:00:00" itemprop="dateCreated datePublished" datetime="2017-03-10T00:00:00-08:00">2017-03-10</time>
            

            
              

              
                
                <span class="post-meta-divider">|</span>
                

                <span class="post-meta-item-icon">
                  <i class="fa fa-calendar-check-o"></i>
                </span>
                
                  <span class="post-meta-item-text">Edited on</span>
                
                <time title="Modified: 2019-08-18 14:35:00" itemprop="dateModified" datetime="2019-08-18T14:35:00-07:00">2019-08-18</time>
              
            
          </span>

          
            <span class="post-category">
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">In</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing"><a href="/categories/Computer-Vision/" itemprop="url" rel="index"><span itemprop="name">Computer Vision</span></a></span>

                
                
                  , 
                
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing"><a href="/categories/Computer-Vision/OpenCV/" itemprop="url" rel="index"><span itemprop="name">OpenCV</span></a></span>

                
                
              
            </span>
          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h1 id="preparation"><a class="markdownIt-Anchor" href="#preparation"></a> Preparation</h1>
<p>Before start coding, you need to ensure your camera has already been calibrated. (Camera calibration is covered in our blog as well.) In the coding section, it’s assumed that you can successfully load the camera calibration parameters.</p>
<h1 id="coding"><a class="markdownIt-Anchor" href="#coding"></a> Coding</h1>
<p>The code can be found at <a href="https://github.com/LongerVision/OpenCV_Examples/blob/master/02_external_camera_posture_estimation/ArUco_single_marker.py" target="_blank" rel="noopener">OpenCV Examples</a>.</p>
<h2 id="first-of-all"><a class="markdownIt-Anchor" href="#first-of-all"></a> First of all</h2>
<p>We need to ensure <strong><a href="http://cv2.so" target="_blank" rel="noopener">cv2.so</a></strong> is under our system path. <strong><a href="http://cv2.so" target="_blank" rel="noopener">cv2.so</a></strong> is specifically for OpenCV Python.</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> sys</span><br><span class="line">sys.path.append(<span class="string">'/usr/local/python/3.5'</span>)</span><br></pre></td></tr></table></figure>
<p>Then, we import some packages to be used.</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> os</span><br><span class="line"><span class="keyword">import</span> cv2</span><br><span class="line"><span class="keyword">from</span> cv2 <span class="keyword">import</span> aruco</span><br><span class="line"><span class="keyword">import</span> numpy <span class="keyword">as</span> np</span><br></pre></td></tr></table></figure>
<h2 id="secondly"><a class="markdownIt-Anchor" href="#secondly"></a> Secondly</h2>
<p>We now load all camera calibration parameters, including: <strong>cameraMatrix</strong>, <strong>distCoeffs</strong>, etc. For example, your code might look like the following:</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">calibrationFile = <span class="string">"calibrationFileName.xml"</span></span><br><span class="line">calibrationParams = cv2.FileStorage(calibrationFile, cv2.FILE_STORAGE_READ)</span><br><span class="line">camera_matrix = calibrationParams.getNode(<span class="string">"cameraMatrix"</span>).mat()</span><br><span class="line">dist_coeffs = calibrationParams.getNode(<span class="string">"distCoeffs"</span>).mat()</span><br></pre></td></tr></table></figure>
<p>Since we are testing a calibrated fisheye camera, two extra parameters are to be loaded from the calibration file.</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">r = calibrationParams.getNode(<span class="string">"R"</span>).mat()</span><br><span class="line">new_camera_matrix = calibrationParams.getNode(<span class="string">"newCameraMatrix"</span>).mat()</span><br></pre></td></tr></table></figure>
<p>Afterwards, two mapping matrices are pre-calculated by calling function <a href="http://docs.opencv.org/trunk/da/d54/group__imgproc__transform.html#ga7dfb72c9cf9780a347fbe3d1c47e5d5a" target="_blank" rel="noopener">cv2.fisheye.initUndistortRectifyMap()</a> as (supposing the images to be processed are of 1080P):</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">image_size = (<span class="number">1920</span>, <span class="number">1080</span>)</span><br><span class="line">map1, map2 = cv2.fisheye.initUndistortRectifyMap(camera_matrix, dist_coeffs, r, new_camera_matrix, image_size, cv2.CV_16SC2)</span><br></pre></td></tr></table></figure>
<h2 id="thirdly"><a class="markdownIt-Anchor" href="#thirdly"></a> Thirdly</h2>
<p>A dictionary is to be loaded. Current OpenCV provides four groups of <a href="http://docs.opencv.org/trunk/d9/d6a/group__aruco.html" target="_blank" rel="noopener">aruco</a> patterns, <strong>4X4</strong>, <strong>5X5</strong>, <strong>6X6</strong>, <strong>7X7</strong>, etc. Here, <strong>aruco.DICT_6X6_1000</strong> is randomly selected as our example, which looks like:</p>
<p><img src="https://raw.githubusercontent.com/LongerVision/OpenCV_Examples/master/markers/marker_66.jpg" alt="aruco.DICT_6X6_1000"></p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">aruco_dict = aruco.Dictionary_get( aruco.DICT_6X6_1000 )</span><br></pre></td></tr></table></figure>
<p>After having this aruco square marker printed, the edge length of this particular marker is to be measured and stored in a variable <strong>markerLength</strong>.</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">markerLength = <span class="number">20</span> <span class="comment"># Here, our measurement unit is centimetre.</span></span><br></pre></td></tr></table></figure>
<p>Meanwhile, create aruco detector with default parameters.</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">arucoParams = aruco.DetectorParameters_create()</span><br></pre></td></tr></table></figure>
<h2 id="finally"><a class="markdownIt-Anchor" href="#finally"></a> Finally</h2>
<p>Estimate camera postures. Here, we are testing a sequence of images, rather than video streams. We first list all file names in sequence.</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">imgDir = <span class="string">"imgSequence"</span>  <span class="comment"># Specify the image directory</span></span><br><span class="line">imgFileNames = [os.path.join(imgDir, fn) <span class="keyword">for</span> fn <span class="keyword">in</span> next(os.walk(imgDir))[<span class="number">2</span>]]</span><br><span class="line">nbOfImgs = len(imgFileNames)</span><br></pre></td></tr></table></figure>
<p>Then, we calculate the camera posture frame by frame:</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> range(<span class="number">0</span>, nbOfImgs):</span><br><span class="line">    img = cv2.imread(imgFileNames[i], cv2.IMREAD_COLOR)</span><br><span class="line">    imgRemapped = cv2.remap(img, map1, map2, cv2.INTER_LINEAR, cv2.BORDER_CONSTANT) <span class="comment"># for fisheye remapping</span></span><br><span class="line">    imgRemapped_gray = cv2.cvtColor(imgRemapped, cv2.COLOR_BGR2GRAY)    <span class="comment"># aruco.etectMarkers() requires gray image</span></span><br><span class="line">    corners, ids, rejectedImgPoints = aruco.detectMarkers(imgRemapped_gray, aruco_dict, parameters=arucoParams) <span class="comment"># Detect aruco</span></span><br><span class="line">    <span class="keyword">if</span> ids != <span class="keyword">None</span>: <span class="comment"># if aruco marker detected</span></span><br><span class="line">        rvec, tvec = aruco.estimatePoseSingleMarkers(corners, markerLength, camera_matrix, dist_coeffs) <span class="comment"># For a single marker</span></span><br><span class="line">        imgWithAruco = aruco.drawDetectedMarkers(imgRemapped, corners, ids, (<span class="number">0</span>,<span class="number">255</span>,<span class="number">0</span>))</span><br><span class="line">        imgWithAruco = aruco.drawAxis(imgWithAruco, camera_matrix, dist_coeffs, rvec, tvec, <span class="number">100</span>)    <span class="comment"># axis length 100 can be changed according to your requirement</span></span><br><span class="line">    <span class="keyword">else</span>:   <span class="comment"># if aruco marker is NOT detected</span></span><br><span class="line">        imgWithAruco = imgRemapped  <span class="comment"># assign imRemapped_color to imgWithAruco directly</span></span><br><span class="line"></span><br><span class="line">    cv2.imshow(<span class="string">"aruco"</span>, imgWithAruco)   <span class="comment"># display</span></span><br><span class="line">    </span><br><span class="line">    <span class="keyword">if</span> cv2.waitKey(<span class="number">2</span>) &amp; <span class="number">0xFF</span> == ord(<span class="string">'q'</span>):   <span class="comment"># if 'q' is pressed, quit.</span></span><br><span class="line">        <span class="keyword">break</span></span><br></pre></td></tr></table></figure>
<p>The drawn axis is just the world coordinators and orientations estimated from the images taken by the testing camera.</p>

          
        
      
    </div>

    

    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
  </section>

  
  <nav class="pagination">
    <a class="extend prev" rel="prev" href="/page/7/"><i class="fa fa-angle-left" aria-label="Previous page"></i></a><a class="page-number" href="/">1</a><span class="space">&hellip;</span><a class="page-number" href="/page/7/">7</a><span class="page-number current">8</span><a class="page-number" href="/page/9/">9</a><a class="extend next" rel="next" href="/page/9/"><i class="fa fa-angle-right" aria-label="Next page"></i></a>
  </nav>



          </div>
          

        </div>
        
          
  
  <div class="sidebar-toggle">
    <div class="sidebar-toggle-line-wrap">
      <span class="sidebar-toggle-line sidebar-toggle-line-first"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-middle"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-last"></span>
    </div>
  </div>

  <aside id="sidebar" class="sidebar">
    
    <div class="sidebar-inner">

      

      

      <section class="site-overview-wrap sidebar-panel sidebar-panel-active">
        <div class="site-overview">
          <div class="site-author motion-element" itemprop="author" itemscope itemtype="http://schema.org/Person">
            
              <p class="site-author-name" itemprop="name">Nobody</p>
              <p class="site-description motion-element" itemprop="description">Longer Vision Technology Github Blog</p>
          </div>

          
            <nav class="site-state motion-element">
              
                <div class="site-state-item site-state-posts">
                
                  <a href="/archives/">
                
                    <span class="site-state-item-count">81</span>
                    <span class="site-state-item-name">posts</span>
                  </a>
                </div>
              

              
                
                
                <div class="site-state-item site-state-categories">
                  <a href="/categories/index.html">
                    
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                    <span class="site-state-item-count">28</span>
                    <span class="site-state-item-name">categories</span>
                  </a>
                </div>
              

              
                
                
                <div class="site-state-item site-state-tags">
                  <a href="/tags/index.html">
                    
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                    <span class="site-state-item-count">76</span>
                    <span class="site-state-item-name">tags</span>
                  </a>
                </div>
              
            </nav>
          

          

          

          
          

          
          

          
            
          
          

        </div>
      </section>

      

      

    </div>
  </aside>


        
      </div>
    </main>

    <footer id="footer" class="footer">
      <div class="footer-inner">
        <div class="copyright">&copy; <span itemprop="copyrightYear">2020</span>
  <span class="with-love" id="animate">
    <i class="fa fa-user"></i>
  </span>
  <span class="author" itemprop="copyrightHolder">Nobody</span>

  

  
</div>




  <div class="powered-by">Powered by <a class="theme-link" target="_blank" href="https://hexo.io">Hexo</a> v3.9.0</div>



  <span class="post-meta-divider">|</span>



  <div class="theme-info">Theme &mdash; <a class="theme-link" target="_blank" href="https://github.com/theme-next/hexo-theme-next">NexT.Muse</a> v6.3.0</div>




        








        
      </div>
    </footer>

    
      <div class="back-to-top">
        <i class="fa fa-arrow-up"></i>
        
      </div>
    

    

  </div>

  

<script type="text/javascript">
  if (Object.prototype.toString.call(window.Promise) !== '[object Function]') {
    window.Promise = null;
  }
</script>


























  
  
    <script type="text/javascript" src="/lib/jquery/index.js?v=2.1.3"></script>
  

  
  
    <script type="text/javascript" src="/lib/velocity/velocity.min.js?v=1.2.1"></script>
  

  
  
    <script type="text/javascript" src="/lib/velocity/velocity.ui.min.js?v=1.2.1"></script>
  


  


  <script type="text/javascript" src="/js/src/utils.js?v=6.3.0"></script>

  <script type="text/javascript" src="/js/src/motion.js?v=6.3.0"></script>



  
  

  

  


  <script type="text/javascript" src="/js/src/bootstrap.js?v=6.3.0"></script>



  



	





  





  










  





  

  

  

  
  

  
  
    
      
    
      
    
      
    
      
    
      
    
      
    
      
    
      
    
      
    
      
    
  

  
    
      <link rel="stylesheet" href="//cdnjs.cloudflare.com/ajax/libs/KaTeX/0.10.0/katex.min.css" type="text/css"><!-- hexo-inject:begin --><!-- hexo-inject:end -->

   
  


  
  

  

  

  

  

  

</body>
</html>
