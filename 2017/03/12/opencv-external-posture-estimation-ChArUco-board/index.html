<!DOCTYPE HTML>
<html>
<head>
  <meta charset="utf-8">
  
  <title>Camera Posture Estimation Using A charuco Board | Longer Vision</title>
  <meta name="author" content="Nobody">
  
  <meta name="description" content="PreparationChAruco is an integrated marker, which combines a chessboard with an aruco marker. The code is also very similar to the code in our previou">
  
  
  <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">

  <meta property="og:title" content="Camera Posture Estimation Using A charuco Board"/>
  <meta property="og:site_name" content="Longer Vision"/>

  
    <meta property="og:image" content="undefined"/>
  

  <link href="/favicon.png" rel="icon">
  <link rel="alternate" href="/atom.xml" title="Longer Vision" type="application/atom+xml">
  <link rel="stylesheet" href="/css/style.css" media="screen" type="text/css">
  <!--[if lt IE 9]><script src="//html5shiv.googlecode.com/svn/trunk/html5.js"></script><![endif]-->
  

</head>


<body>
  <header id="header" class="inner"><div class="alignleft">
  <h1><a href="/">Longer Vision</a></h1>
  <h2><a href="/"></a></h2>
</div>
<nav id="main-nav" class="alignright">
  <ul>
    
      <li><a href="/">Home</a></li>
    
      <li><a href="/archives">Archives</a></li>
    
  </ul>
  <div class="clearfix"></div>
</nav>
<div class="clearfix"></div>
</header>
  <div id="content" class="inner">
    <div id="main-col" class="alignleft"><div id="wrapper"><article class="post">
  
  <div class="post-content">
    <header>
      
        <div class="icon"></div>
        <time datetime="2017-03-13T05:24:56.000Z"><a href="/2017/03/12/opencv-external-posture-estimation-ChArUco-board/">2017-03-12</a></time>
      
      
  
    <h1 class="title">Camera Posture Estimation Using A charuco Board</h1>
  

    </header>
    <div class="entry">
      
        <p></p><h2>Preparation</h2><br>ChAruco is an integrated marker, which combines a chessboard with an aruco marker. The code is also very similar to the code in our previous blog <a href="https://longervision.github.io/2017/03/12/opencv-external-posture-estimation-ArUco-board/">aruco board</a>.<p></p>
<p></p><h2>Coding</h2><br>The code can be found at <a href="https://github.com/LongerVision/OpenCV_Examples/blob/master/02_external_camera_posture_estimation/ChArUco_board.py" target="_blank" rel="external">OpenCV Examples</a>. And the code in the first two subsections are exactly the same as what’s written in our previous blogs. We’ll neglect the first two subsections ever since.<p></p>
<p></p><h3>First of all</h3><br>Exactly the same as in previous blogs.<p></p>
<p></p><h3>Secondly</h3><br>Exactly the same as in previous blogs.<p></p>
<p></p><h3>Thirdly</h3><br>Dictionary <strong>aruco.DICT_6X6_1000</strong> is integrated with a chessboard to construct a grid charuco board. The experimenting board is of size <strong>5*7</strong>, which looks like:<br><img src="https://raw.githubusercontent.com/LongerVision/OpenCV_Examples/master/markers/board_charuco_57.png" alt="charuco.DICT_6X6_1000.board57" title="charuco.DICT_6X6_1000.board57"><br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">aruco_dict = aruco.Dictionary_get( aruco.DICT_6X6_1000 )</div></pre></td></tr></table></figure><p></p>
<p>After having this aruco board marker printed, the edge lengths of this chessboard and aruco marker (displayed in the white cell of the chessboard) are to be measured and stored in two variables <strong>squareLength</strong> and <strong>markerLength</strong>, which are used to create the <strong>5*7</strong> grid board.<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line">squareLength = 40   # Here, our measurement unit is centimetre.</div><div class="line">markerLength = 30   # Here, our measurement unit is centimetre.</div><div class="line">board = aruco.CharucoBoard_create(5, 7, squareLength, markerLength, aruco_dict)</div></pre></td></tr></table></figure></p>
<p>Meanwhile, create aruco detector with default parameters.<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">arucoParams = aruco.DetectorParameters_create()</div></pre></td></tr></table></figure></p>
<p></p><h3>Finally</h3><br>Now, let’s test on a video stream, a .mp4 file.<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">videoFile = &quot;charuco_board_57.mp4&quot;</div><div class="line">cap = cv2.VideoCapture(videoFile)</div></pre></td></tr></table></figure><p></p>
<p>Then, we calculate the camera posture frame by frame:<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div></pre></td><td class="code"><pre><div class="line">while(True):</div><div class="line">    ret, frame = cap.read() # Capture frame-by-frame</div><div class="line">    if ret == True:</div><div class="line">        frame_remapped = cv2.remap(frame, map1, map2, cv2.INTER_LINEAR, cv2.BORDER_CONSTANT)    # for fisheye remapping</div><div class="line">        frame_remapped_gray = cv2.cvtColor(frame_remapped, cv2.COLOR_BGR2GRAY)</div><div class="line"></div><div class="line">        corners, ids, rejectedImgPoints = aruco.detectMarkers(frame_remapped_gray, aruco_dict, parameters=arucoParams)  # First, detect markers</div><div class="line">        aruco.refineDetectedMarkers(frame_remapped_gray, board, corners, ids, rejectedImgPoints)</div><div class="line"></div><div class="line">        if ids != None: # if there is at least one marker detected</div><div class="line">            charucoretval, charucoCorners, charucoIds = aruco.interpolateCornersCharuco(corners, ids, frame_remapped_gray, board)</div><div class="line">            im_with_charuco_board = aruco.drawDetectedCornersCharuco(frame_remapped, charucoCorners, charucoIds, (0,255,0))</div><div class="line">            retval, rvec, tvec = aruco.estimatePoseCharucoBoard(charucoCorners, charucoIds, board, camera_matrix, dist_coeffs)  # posture estimation from a charuco board</div><div class="line">            if retval == True:</div><div class="line">                im_with_charuco_board = aruco.drawAxis(im_with_charuco_board, camera_matrix, dist_coeffs, rvec, tvec, 100)  # axis length 100 can be changed according to your requirement</div><div class="line">        else:</div><div class="line">            im_with_charuco_left = frame_remapped</div><div class="line"></div><div class="line">        cv2.imshow(&quot;charucoboard&quot;, im_with_charuco_board)</div><div class="line"></div><div class="line">        if cv2.waitKey(2) &amp; 0xFF == ord(&apos;q&apos;):</div><div class="line">            break</div><div class="line">    else:</div><div class="line">        break</div></pre></td></tr></table></figure></p>
<p>The drawn axis is just the world coordinators and orientations estimated from the images taken by the testing camera.<br>At the end of the code, we release the video capture handle and destroy all opening windows.<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">cap.release()   # When everything done, release the capture</div><div class="line">cv2.destroyAllWindows()</div></pre></td></tr></table></figure></p>

      
    </div>
    <footer>
      
        
        
  
  <div class="tags">
    <a href="/tags/Camera-Posture-Estimation-charuco-Board-Pattern-OpenCV-Python/">Camera Posture Estimation, charuco Board, Pattern, OpenCV, Python</a>
  </div>

        
  <div class="addthis addthis_toolbox addthis_default_style">
    
      <a class="addthis_button_facebook_like" fb:like:layout="button_count"></a>
    
    
      <a class="addthis_button_tweet"></a>
    
    
      <a class="addthis_button_google_plusone" g:plusone:size="medium"></a>
    
    
      <a class="addthis_button_pinterest_pinit" pi:pinit:layout="horizontal"></a>
    
    <a class="addthis_counter addthis_pill_style"></a>
  </div>
  <script type="text/javascript" src="//s7.addthis.com/js/300/addthis_widget.js"></script>

      
      <div class="clearfix"></div>
    </footer>
  </div>
</article>


<section id="comment">
  <h1 class="title">Comentarios</h1>

  
      <div id="fb-root"></div>
<script>
  (function(d, s, id) {
    var js, fjs = d.getElementsByTagName(s)[0];
    if (d.getElementById(id)) return;
    js = d.createElement(s); js.id = id;
    js.src = "//connect.facebook.net/en_US/all.js#xfbml=1&appId=123456789012345";
    fjs.parentNode.insertBefore(js, fjs);
  }(document, 'script', 'facebook-jssdk'));
</script>

<div class="fb-comments" data-href="http://longervision.github.io/2017/03/12/opencv-external-posture-estimation-ChArUco-board/index.html" data-num-posts="5" data-width="840" data-colorscheme="light"></div>
      
  
</section>

</div></div>
    <aside id="sidebar" class="alignright">
  <div class="search">
  <form action="//google.com/search" method="get" accept-charset="utf-8">
    <input type="search" name="q" results="0" placeholder="Buscar">
    <input type="hidden" name="q" value="site:longervision.github.io">
  </form>
</div>

  

  
<div class="widget tag">
  <h3 class="title">Etiquetas</h3>
  <ul class="entry">
  
    <li><a href="/tags/ArUco-Marker-Pattern-OpenCV-Python/">ArUco, Marker, Pattern, OpenCV, Python</a><small>1</small></li>
  
    <li><a href="/tags/Camera-Calibration-Chessboard-Marker-Pattern-OpenCV-Python/">Camera Calibration, Chessboard, Marker, Pattern, OpenCV, Python</a><small>1</small></li>
  
    <li><a href="/tags/Camera-Posture-Estimation-Circle-Grid-Marker-Pattern-OpenCV-Python/">Camera Posture Estimation, Circle Grid, Marker, Pattern, OpenCV, Python</a><small>1</small></li>
  
    <li><a href="/tags/Camera-Posture-Estimation-aruco-Board-Pattern-OpenCV-Python/">Camera Posture Estimation, aruco Board, Pattern, OpenCV, Python</a><small>1</small></li>
  
    <li><a href="/tags/Camera-Posture-Estimation-aruco-Diamond-Marker-Pattern-OpenCV-Python/">Camera Posture Estimation, aruco, Diamond Marker, Pattern, OpenCV, Python</a><small>1</small></li>
  
    <li><a href="/tags/Camera-Posture-Estimation-aruco-Marker-Pattern-OpenCV-Python/">Camera Posture Estimation, aruco, Marker, Pattern, OpenCV, Python</a><small>1</small></li>
  
    <li><a href="/tags/Camera-Posture-Estimation-charuco-Board-Pattern-OpenCV-Python/">Camera Posture Estimation, charuco Board, Pattern, OpenCV, Python</a><small>1</small></li>
  
    <li><a href="/tags/Longer-Vision-Technology-Computer-Vision-Machine-Vision/">Longer Vision Technology, Computer Vision, Machine Vision</a><small>1</small></li>
  
  </ul>
</div>

</aside>
    <div class="clearfix"></div>
  </div>
  <footer id="footer" class="inner"><div class="alignleft">
  
  &copy; 2017 Nobody
  
</div>
<div class="clearfix"></div></footer>
  <script src="//ajax.googleapis.com/ajax/libs/jquery/2.0.3/jquery.min.js"></script>
<script src="/js/jquery.imagesloaded.min.js"></script>
<script src="/js/gallery.js"></script>




<link rel="stylesheet" href="/fancybox/jquery.fancybox.css" media="screen" type="text/css">
<script src="/fancybox/jquery.fancybox.pack.js"></script>
<script type="text/javascript">
(function($){
  $('.fancybox').fancybox();
})(jQuery);
</script>

</body>
</html>
