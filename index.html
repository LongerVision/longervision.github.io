<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8">
  

  
  <title>Longer Vision Blog</title>
  <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
  <meta property="og:type" content="website">
<meta property="og:title" content="Longer Vision Blog">
<meta property="og:url" content="https://longervision.github.io/index.html">
<meta property="og:site_name" content="Longer Vision Blog">
<meta property="og:locale" content="default">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="Longer Vision Blog">
  
    <link rel="alternate" href="/atom.xml" title="Longer Vision Blog" type="application/atom+xml">
  
  
    <link rel="icon" href="/favicon.png">
  
  
    <link href="//fonts.googleapis.com/css?family=Source+Code+Pro" rel="stylesheet" type="text/css">
  
  <link rel="stylesheet" href="/css/style.css">
</head>

<body>
  <div id="container">
    <div id="wrap">
      <header id="header">
  <div id="banner"></div>
  <div id="header-outer" class="outer">
    <div id="header-title" class="inner">
      <h1 id="logo-wrap">
        <a href="/" id="logo">Longer Vision Blog</a>
      </h1>
      
    </div>
    <div id="header-inner" class="inner">
      <nav id="main-nav">
        <a id="main-nav-toggle" class="nav-icon"></a>
        
          <a class="main-nav-link" href="/">Home</a>
        
          <a class="main-nav-link" href="/archives">Archives</a>
        
      </nav>
      <nav id="sub-nav">
        
          <a id="nav-rss-link" class="nav-icon" href="/atom.xml" title="RSS Feed"></a>
        
        <a id="nav-search-btn" class="nav-icon" title="Search"></a>
      </nav>
      <div id="search-form-wrap">
        <form action="//google.com/search" method="get" accept-charset="UTF-8" class="search-form"><input type="search" name="q" class="search-form-input" placeholder="Search"><button type="submit" class="search-form-submit">&#xF002;</button><input type="hidden" name="sitesearch" value="https://longervision.github.io"></form>
      </div>
    </div>
  </div>
</header>
      <div class="outer">
        <section id="main">
  
    <article id="post-nanopi-neo-armbian" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="/2018/02/24/nanopi-neo-armbian/" class="article-date">
  <time datetime="2018-02-25T01:41:24.000Z" itemprop="datePublished">2018-02-24</time>
</a>
    
  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2018/02/24/nanopi-neo-armbian/">Install Armbian Debian Server with the Newest Supported Mainline Linux Kernel onto NanoPi NEO</a>
    </h1>
  

      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <p>Hi, all, I flied back and forth between ShenZhen China and Vancouver Canada in January 2018, and took a holiday break in California USA during Chinese Spring Festival in Febrary 2018. Now, I’m back to Vancouver and write this blog. Today, we are going to talk about how to flash the most recent <a href="https://www.kernel.org/" target="_blank" rel="noopener">Linux Kernel</a> onto an <a href="http://www.friendlyarm.net/products/nanopi-neo" target="_blank" rel="noopener">NanoPi NEO</a>. The board looks like (cited from <a href="http://wiki.friendlyarm.com/wiki/index.php/NanoPi_NEO" target="_blank" rel="noopener">NanoPi NEO</a> ):</p>
<p><img src="https://raw.githubusercontent.com/LongerVision/BSP/master/AllWinner/H3/friendlyarm/nanopineo/images/NanoPi_NEO.jpg" alt="NanoPi NEO"></p>
<p>Similar to <a href="../../../01/11/orange-pi-plus-2-armbian/">our previous blog</a>, to build the Mainline Linux for <a href="http://www.friendlyarm.net/products/nanopi-neo" target="_blank" rel="noopener">NanoPi NEO</a>, we use the Embedded Linux management open source <a href="https://www.armbian.com/" target="_blank" rel="noopener">Armbian</a>. However, this time, we are <strong>NOT</strong> going to directly install anything built by Armbian from <a href="https://www.armbian.com/nanopi-neo/" target="_blank" rel="noopener">Armbian NanoPi NEO</a> but manually build everything from <a href="https://github.com/armbian/build" target="_blank" rel="noopener">Armbian source</a>.</p>
<h1 id="PART-A-Build-The-Newest-Armbian-U-Boot-and-Linux-Kernel-for-NanoPi-NEO"><a href="#PART-A-Build-The-Newest-Armbian-U-Boot-and-Linux-Kernel-for-NanoPi-NEO" class="headerlink" title="PART A: Build The Newest Armbian U-Boot and Linux Kernel for NanoPi NEO"></a>PART A: Build The Newest Armbian U-Boot and Linux Kernel for NanoPi NEO</h1><h2 id="1-Download-Armbian"><a href="#1-Download-Armbian" class="headerlink" title="1. Download Armbian"></a>1. Download Armbian</h2><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ git <span class="built_in">clone</span> git@github.com:armbian/build.git armbian</span><br></pre></td></tr></table></figure>
<h2 id="2-Prepare-Board-Configuration-Files"><a href="#2-Prepare-Board-Configuration-Files" class="headerlink" title="2. Prepare Board Configuration Files"></a>2. Prepare Board Configuration Files</h2><h3 id="1-Doublecheck-Armbian-Board-Configuration"><a href="#1-Doublecheck-Armbian-Board-Configuration" class="headerlink" title="1) Doublecheck Armbian Board Configuration"></a>1) Doublecheck Armbian Board Configuration</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">$ <span class="built_in">cd</span> ./config/boards</span><br><span class="line">$ ls -1 *nanopi*</span><br><span class="line">nanopiair.conf</span><br><span class="line">nanopiduo.conf</span><br><span class="line">nanopik2-s905.csc</span><br><span class="line">nanopim1.conf</span><br><span class="line">nanopim1plus2.conf</span><br><span class="line">nanopim1plus.conf</span><br><span class="line">nanopim3.wip</span><br><span class="line">nanopineo2.conf</span><br><span class="line">nanopineo.conf</span><br><span class="line">nanopineoplus2.conf</span><br><span class="line">$ <span class="built_in">cd</span> ../../</span><br></pre></td></tr></table></figure>
<p>Clearly, <a href="http://www.friendlyarm.net/products/nanopi-neo" target="_blank" rel="noopener">NanoPi NEO</a> is officially supported by Armbian. </p>
<h3 id="2-Doublecheck-Configuration-File-for-U-Boot"><a href="#2-Doublecheck-Configuration-File-for-U-Boot" class="headerlink" title="2) Doublecheck Configuration File for U-Boot"></a>2) Doublecheck Configuration File for U-Boot</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line">$ <span class="built_in">cd</span> ./cache/sources/u-boot/v2017.11/configs</span><br><span class="line">$ ls -1 *nanopi*</span><br><span class="line">nanopi_a64_defconfig</span><br><span class="line">nanopi_duo_defconfig</span><br><span class="line">nanopi_m1_defconfig</span><br><span class="line">nanopi_m1_plus2_defconfig</span><br><span class="line">nanopi_m1_plus_defconfig</span><br><span class="line">nanopi_neo2_defconfig</span><br><span class="line">nanopi_neo_air_defconfig</span><br><span class="line">nanopi_neo_defconfig</span><br><span class="line">nanopi_neo_plus2_defconfig</span><br><span class="line">$ <span class="built_in">cd</span> ../arch/arm/dts</span><br><span class="line">$ ls -1 *nanopi*</span><br><span class="line">sun50i-a64-nanopi-a64.dts</span><br><span class="line">sun50i-h5-nanopi-m1-plus2.dts</span><br><span class="line">sun50i-h5-nanopi-neo2.dts</span><br><span class="line">sun50i-h5-nanopi-neo-plus2.dts</span><br><span class="line">sun8i-h2-plus-nanopi-duo.dts</span><br><span class="line">sun8i-h3-nanopi.dtsi</span><br><span class="line">sun8i-h3-nanopi-m1.dts</span><br><span class="line">sun8i-h3-nanopi-m1-plus.dts</span><br><span class="line">sun8i-h3-nanopi-neo-air.dts</span><br><span class="line">sun8i-h3-nanopi-neo.dts</span><br><span class="line">$ <span class="built_in">cd</span> ../../../../../../../</span><br></pre></td></tr></table></figure>
<p>Clearly, <a href="http://www.friendlyarm.net/products/nanopi-neo" target="_blank" rel="noopener">NanoPi NEO</a> is also officially supported by <a href="http://www.denx.de/wiki/U-Boot/WebHome" target="_blank" rel="noopener">U-Boot</a>. </p>
<h2 id="3-Build-Full-OS-Image-with-Newest-Supported-Linux-Kernels"><a href="#3-Build-Full-OS-Image-with-Newest-Supported-Linux-Kernels" class="headerlink" title="3. Build Full OS Image with Newest Supported Linux Kernels"></a>3. Build Full OS Image with Newest Supported Linux Kernels</h2><p>Due to <a href="https://docs.armbian.com/Developer-Guide_Build-Options/" target="_blank" rel="noopener">Armbian Build Options</a>, by specifying <strong>KERNEL_ONLY=”no”</strong>, we can build a full Linux OS image:<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line">./compile.sh BOARD=<span class="string">"nanopineo"</span> BRANCH=<span class="string">"next"</span> KERNEL_ONLY=<span class="string">"no"</span> KERNEL_CONFIGURE=<span class="string">"no"</span></span><br><span class="line">[ o.k. ] Using config file [ config-default.conf ]</span><br><span class="line">[ warn ] This script requires root privileges, trying to use sudo </span><br><span class="line">[sudo] password <span class="keyword">for</span> jiapei: </span><br><span class="line">[ o.k. ] Using config file [ config-default.conf ]</span><br><span class="line">[ o.k. ] This script will try to update</span><br><span class="line">Permission denied (publickey).</span><br><span class="line">fatal: Could not <span class="built_in">read</span> from remote repository.</span><br><span class="line"></span><br><span class="line">Please make sure you have the correct access rights</span><br><span class="line">and the repository exists.</span><br><span class="line">Already on <span class="string">'master'</span></span><br><span class="line">Your branch is up-to-date with <span class="string">'origin/master'</span>.</span><br><span class="line">[ o.k. ] Command line: setting BOARD to [ nanopineo ]</span><br><span class="line">[ o.k. ] Command line: setting BRANCH to [ next ]</span><br><span class="line">[ o.k. ] Command line: setting KERNEL_ONLY to [ no ]</span><br><span class="line">[ o.k. ] Command line: setting KERNEL_CONFIGURE to [ no ]</span><br><span class="line">[ o.k. ] Preparing [ host ]</span><br><span class="line">[ o.k. ] Build host OS release [ xenial ]</span><br><span class="line">[ o.k. ] Syncing clock [ host ]</span><br></pre></td></tr></table></figure></p>
<p>Now, the following GUI jump out and we select <strong>Debian 9 Stretch</strong> this time:<br><img src="https://raw.githubusercontent.com/LongerVision/BSP/master/armbian/14_target_OS_release.jpg" alt="Target OS release"></p>
<p>We then click <strong>OK</strong>:<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br></pre></td><td class="code"><pre><span class="line">[ o.k. ] Downloading sources </span><br><span class="line">[ o.k. ] Checking git sources [ u-boot v2017.11 ]</span><br><span class="line">[ .... ] Checking out </span><br><span class="line">[ o.k. ] Checking git sources [ linux-mainline linux-4.14.y ]</span><br><span class="line">[ .... ] Checking out </span><br><span class="line">[ o.k. ] Checking git sources [ sunxi-tools master ]</span><br><span class="line">[ .... ] Up to date </span><br><span class="line">[ o.k. ] Checking git sources [ rkbin-tools master ]</span><br><span class="line">[ .... ] Up to date </span><br><span class="line">[ o.k. ] Checking git sources [ marvell-tools A3700_utils-armada-17.10 ]</span><br><span class="line">[ .... ] Up to date </span><br><span class="line">[ o.k. ] Checking git sources [ odroidc2-blobs master ]</span><br><span class="line">[ .... ] Up to date </span><br><span class="line">[ o.k. ] Cleaning output/debs <span class="keyword">for</span> [ nanopineo next ]</span><br><span class="line">[ o.k. ] Cleaning [ u-boot/v2017.11 ]</span><br><span class="line">[ o.k. ] Compiling u-boot [ 2017.11 ]</span><br><span class="line">[ o.k. ] Compiler version [ arm-linux-gnueabihf-gcc 7.2.1 ]</span><br><span class="line">[ .... ] Checking out sources </span><br><span class="line">[ o.k. ] Cleaning [ u-boot/v2017.11 ]</span><br><span class="line">[ o.k. ] Started patching process <span class="keyword">for</span> [ u-boot sunxi-nanopineo-next ]</span><br><span class="line">[ o.k. ] Looking <span class="keyword">for</span> user patches <span class="keyword">in</span> [ userpatches/u-boot/u-boot-sunxi ]</span><br><span class="line">[ o.k. ] * [l][c] 0020-sunxi-call-fdt_fixup_ethernet-again-to-set-macaddr-f.patch </span><br><span class="line">[ o.k. ] * [l][c] 4kfix-limit-screen-to-full-hd.patch </span><br><span class="line">[ o.k. ] * [l][c] Add-A20-Olimex-SOM204-EVB-board.patch </span><br><span class="line">[ o.k. ] * [l][c] add-a20-olinuxino-micro-emmc-support.patch </span><br><span class="line">[ o.k. ] * [l][c] add-a20-optional-eMMC.patch </span><br><span class="line">[ o.k. ] * [l][c] add-bananapi-bpi-m2-zero.patch </span><br><span class="line">[ o.k. ] * [l][c] add-beelink-x2.patch </span><br><span class="line">[ o.k. ] * [l][c] add-nanopi-air-emmc.patch </span><br><span class="line">[ o.k. ] * [l][c] add-nanopi-duo.patch </span><br><span class="line">[ o.k. ] * [l][c] add-nanopi-m1-plus2-emmc.patch </span><br><span class="line">[ o.k. ] * [l][c] add-nanopineoplus2.patch </span><br><span class="line">[ o.k. ] * [l][c] add-orangepi-plus2-emmc.patch </span><br><span class="line">[ o.k. ] * [l][c] add-orangepi-zeroplus.patch </span><br><span class="line">[ o.k. ] * [l][c] add-orangepi-zeroplus2_h3.patch </span><br><span class="line">[ o.k. ] * [l][c] add-sunvell-r69.patch </span><br><span class="line">[ o.k. ] * [l][c] add-tritium.patch </span><br><span class="line">[ o.k. ] * [l][c] add_emmc_olinuxino_a64.patch </span><br><span class="line">[ o.k. ] * [l][c] add_emmc_orangepiwin.patch </span><br><span class="line">[ o.k. ] * [l][c] adjust-default-dram-clockspeeds.patch </span><br><span class="line">[ o.k. ] * [l][c] adjust-small-boards-cpufreq.patch </span><br><span class="line">[ o.k. ] * [l][c] <span class="built_in">enable</span>-DT-overlays-support.patch </span><br><span class="line">[ o.k. ] * [l][c] <span class="built_in">enable</span>-autoboot-keyed.patch </span><br><span class="line">[ o.k. ] * [l][c] fdt-setprop-fix-unaligned-access.patch </span><br><span class="line">[ o.k. ] * [l][c] fix-sdcard-detect-bpi-m2z.patch </span><br><span class="line">[ o.k. ] * [l][c] fix-sunxi-gpio-driver.patch </span><br><span class="line">[ o.k. ] * [l][c] fix-usb1-vbus-opiwin.patch </span><br><span class="line">[ o.k. ] * [l][c] h3-Fix-PLL1-setup-to-never-use-dividers.patch </span><br><span class="line">[ o.k. ] * [l][c] h3-enable-power-led.patch </span><br><span class="line">[ o.k. ] * [l][c] h3-set-safe-axi_apb-clock-dividers.patch </span><br><span class="line">[ o.k. ] * [l][c] lower-default-DRAM-freq-A64-H5.patch </span><br><span class="line">[ o.k. ] * [l][c] lower-default-cpufreq-H5.patch </span><br><span class="line">[ o.k. ] * [l][c] sun8i-set-machid.patch </span><br><span class="line">[ o.k. ] * [l][c] video-fix-vsync-polarity-bits.patch </span><br><span class="line">[ o.k. ] * [l][b] workaround-reboot-is-poweroff-olimex-a20.patch </span><br><span class="line">  HOSTCC  scripts/basic/fixdep</span><br><span class="line">  HOSTCC  scripts/kconfig/conf.o</span><br><span class="line">  HOSTCC  scripts/kconfig/zconf.tab.o</span><br><span class="line">  HOSTLD  scripts/kconfig/conf</span><br><span class="line"><span class="comment">#</span></span><br><span class="line"><span class="comment"># configuration written to .config</span></span><br><span class="line"><span class="comment">#</span></span><br><span class="line">scripts/kconfig/conf  --silentoldconfig Kconfig</span><br><span class="line">.config:1104:warning: override: reassigning to symbol BOOTDELAY</span><br><span class="line"><span class="comment">#</span></span><br><span class="line"><span class="comment"># configuration written to .config</span></span><br><span class="line"><span class="comment">#</span></span><br><span class="line">  CHK     include/config.h</span><br><span class="line">  CFG     u-boot.cfg</span><br><span class="line">  GEN     include/autoconf.mk.dep</span><br><span class="line">  CFG     spl/u-boot.cfg</span><br><span class="line">  GEN     include/autoconf.mk</span><br><span class="line">  GEN     spl/include/autoconf.mk</span><br><span class="line">  CHK     include/config/uboot.release</span><br><span class="line">  CHK     include/generated/timestamp_autogenerated.h</span><br><span class="line">  UPD     include/generated/timestamp_autogenerated.h</span><br><span class="line">  CHK     include/generated/version_autogenerated.h</span><br><span class="line">  HOSTCC  scripts/dtc/dtc.o</span><br><span class="line">  ......</span><br></pre></td></tr></table></figure></p>
<p>And, it took me about 5 minutes to have everything built.</p>
<h1 id="PART-B-Install-the-Linux-OS-onto-SD-Card"><a href="#PART-B-Install-the-Linux-OS-onto-SD-Card" class="headerlink" title="PART B: Install the Linux OS onto SD Card"></a>PART B: Install the Linux OS onto SD Card</h1><h1 id="PART-C-Configurations-after-Booting-from-the-SD-Card"><a href="#PART-C-Configurations-after-Booting-from-the-SD-Card" class="headerlink" title="PART C: Configurations after Booting from the SD Card"></a>PART C: Configurations after Booting from the SD Card</h1>
      
    </div>
    <footer class="article-footer">
      <a data-url="https://longervision.github.io/2018/02/24/nanopi-neo-armbian/" data-id="cje6onrw10003ely71xnuatpp" class="article-share-link">Longer Vision</a>
      
      
  <ul class="article-tag-list"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/NanoPi-NEO-AllWinner-H3-Armbian-Debian-Mainline-Linux-Kernel-BSP/">NanoPi NEO, AllWinner H3, Armbian, Debian, Mainline Linux Kernel, BSP</a></li></ul>

    </footer>
  </div>
  
</article>


  
    <article id="post-orange-pi-plus-2-armbian" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="/2018/01/11/orange-pi-plus-2-armbian/" class="article-date">
  <time datetime="2018-01-12T06:47:54.000Z" itemprop="datePublished">2018-01-11</time>
</a>
    
  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2018/01/11/orange-pi-plus-2-armbian/">Install Armbian Ubuntu Desktop with the Newest Supported Mainline Linux Kernel onto Orange Pi Plus 2</a>
    </h1>
  

      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <p>Today, we are going to installed a runnable Linux OS <a href="https://www.armbian.com/" target="_blank" rel="noopener">Armbian</a> and then flash the most recent supported <a href="https://www.kernel.org/" target="_blank" rel="noopener">Linux Kernel</a> onto an <a href="http://www.orangepi.org/orangepiplus2/" target="_blank" rel="noopener">Orange Pi Plus 2</a>, which adopts <a href="http://www.allwinnertech.com/index.php?c=product&amp;a=index&amp;pid=6" target="_blank" rel="noopener">AllWinner H3</a> as its CPU. The board looks like (cited from <a href="http://www.orangepi.org/orangepiplus2/" target="_blank" rel="noopener">Orange Pi Plus 2</a> ):</p>
<p><img src="https://raw.githubusercontent.com/LongerVision/BSP/master/AllWinner/H3/orangepi/plus2/images/orangepiplus2_info.jpg" alt="Orange Pi Plus 2"></p>
<p>Different from <a href="../../10/beaglebone-black-uboot-kernel/">our previous blog</a> where we build <a href="http://www.denx.de/wiki/U-Boot/WebHome" target="_blank" rel="noopener">U-Boot</a> and <a href="https://www.kernel.org/" target="_blank" rel="noopener">Linux Kernel</a> manually, here, we download and install the <a href="https://www.armbian.com/orange-pi-plus-2/" target="_blank" rel="noopener">built Ubuntu from Armbian</a>, and have the most recently supported <a href="https://www.kernel.org/" target="_blank" rel="noopener">Linux Kernel</a> updated afterwards.</p>
<p>Before starting, the following paragraph is cited to explain the relationships among <a href="http://allwinnertech.com/" target="_blank" rel="noopener">AllWinner</a>, <a href="http://linux-sunxi.org/Allwinner" target="_blank" rel="noopener">Sunxi</a> and <a href="https://www.linaro.org/" target="_blank" rel="noopener">Linaro</a>.<br><cite><br>In march 2014, <a href="http://allwinnertech.com/" target="_blank" rel="noopener">Allwinner</a> joined <a href="https://www.linaro.org/" target="_blank" rel="noopener">Linaro</a> as part of the new linaro digital home group. After this, <a href="http://allwinnertech.com/" target="_blank" rel="noopener">AllWinner</a> stopped communicating with the <a href="http://linux-sunxi.org/Allwinner" target="_blank" rel="noopener">sunxi community</a>, as linaro membership apparently satisfies the marketing need to be seen as an open source friendly company. Despite <a href="https://www.linaro.org/" target="_blank" rel="noopener">Linaro</a> membership, <a href="http://allwinnertech.com/" target="_blank" rel="noopener">Allwinner</a> still violates the <a href="http://www.gnu.org/licenses/gpl-3.0.en.html" target="_blank" rel="noopener">GPL</a> on many counts. (cited from <a href="http://linux-sunxi.org/Allwinner" target="_blank" rel="noopener">http://linux-sunxi.org/Allwinner</a> .)<br></cite></p>
<h1 id="PART-A-Install-Ubuntu-Desktop-Built-By-Armbian-onto-Orange-Pi-Plus-2"><a href="#PART-A-Install-Ubuntu-Desktop-Built-By-Armbian-onto-Orange-Pi-Plus-2" class="headerlink" title="PART A: Install Ubuntu Desktop Built By Armbian onto Orange Pi Plus 2"></a>PART A: Install Ubuntu Desktop Built By Armbian onto Orange Pi Plus 2</h1><h2 id="1-Download-Armbian-Ubuntu-Desktop-for-Orange-Pi-Plus-2"><a href="#1-Download-Armbian-Ubuntu-Desktop-for-Orange-Pi-Plus-2" class="headerlink" title="1. Download Armbian Ubuntu Desktop for Orange Pi Plus 2"></a>1. Download Armbian Ubuntu Desktop for Orange Pi Plus 2</h2><p>We <strong>FIRST</strong> go visiting the website <a href="https://www.armbian.com/orange-pi-plus-2/" target="_blank" rel="noopener">https://www.armbian.com/orange-pi-plus-2/</a> and click <strong>Ubuntu desktop - legacy kernel</strong> icon, a file named <strong>Armbian_5.38_Orangepiplus_Ubuntu_xenial_default_3.4.113_desktop.7z</strong> will be automatically downloaded.</p>
<p>Then, we extract this <strong>.7z</strong> file by<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line">$ 7za e Armbian_5.38_Orangepiplus_Ubuntu_xenial_default_3.4.113_desktop.7z </span><br><span class="line"></span><br><span class="line">7-Zip (A) [64] 9.20  Copyright (c) 1999-2010 Igor Pavlov  2010-11-18</span><br><span class="line">p7zip Version 9.20 (locale=en_CA.UTF-8,Utf16=on,HugeFiles=on,8 CPUs)</span><br><span class="line"></span><br><span class="line">Processing archive: Armbian_5.38_Orangepiplus_Ubuntu_xenial_default_3.4.113_desktop.7z</span><br><span class="line"></span><br><span class="line">Extracting  Armbian_5.38_Orangepiplus_Ubuntu_xenial_default_3.4.113_desktop.img</span><br><span class="line">Extracting  armbian.txt</span><br><span class="line">Extracting  armbian.txt.asc</span><br><span class="line">Extracting  Armbian_5.38_Orangepiplus_Ubuntu_xenial_default_3.4.113_desktop.img.asc</span><br><span class="line">Extracting  sha256sum.sha</span><br><span class="line"></span><br><span class="line">Everything is Ok</span><br><span class="line"></span><br><span class="line">Files: 5</span><br><span class="line">Size:       3061862273</span><br><span class="line">Compressed: 606477386</span><br></pre></td></tr></table></figure></p>
<h2 id="2-Install-Armbian-Ubuntu-Desktop-for-Orange-Pi-Plus-2"><a href="#2-Install-Armbian-Ubuntu-Desktop-for-Orange-Pi-Plus-2" class="headerlink" title="2. Install Armbian Ubuntu Desktop for Orange Pi Plus 2"></a>2. Install Armbian Ubuntu Desktop for Orange Pi Plus 2</h2><p>After the extracted image file is prepared, it’s the time to install the Armbian Ubuntu Desktop onto our TF card. We <strong>FIRST</strong> format the TF card:<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line">$ sudo mkfs.ext4 /dev/mmcblk0 </span><br><span class="line">[sudo] password <span class="keyword">for</span> jiapei: </span><br><span class="line">mke2fs 1.42.13 (17-May-2015)</span><br><span class="line">Found a dos partition table <span class="keyword">in</span> /dev/mmcblk0</span><br><span class="line">Proceed anyway? (y,n) y</span><br><span class="line">Discarding device blocks: <span class="keyword">done</span>                            </span><br><span class="line">Creating filesystem with 7791744 4k blocks and 1949696 inodes</span><br><span class="line">Filesystem UUID: 8873533f-4a66-4e8c-8633-844eaa90116d</span><br><span class="line">Superblock backups stored on blocks: </span><br><span class="line">        32768, 98304, 163840, 229376, 294912, 819200, 884736, 1605632, 2654208, </span><br><span class="line">        4096000</span><br><span class="line"></span><br><span class="line">Allocating group tables: <span class="keyword">done</span>                            </span><br><span class="line">Writing inode tables: <span class="keyword">done</span>                            </span><br><span class="line">Creating journal (32768 blocks): <span class="keyword">done</span></span><br><span class="line">Writing superblocks and filesystem accounting information: <span class="keyword">done</span></span><br></pre></td></tr></table></figure></p>
<p>Afterwards, use <strong>dd</strong> to install the downloaded Armbian Ubuntu Desktop image.<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">$ sudo dd bs=4M <span class="keyword">if</span>=Armbian_5.38_Orangepiplus_Ubuntu_xenial_default_3.4.113_desktop.img of=/dev/mmcblk0 conv=fsync</span><br><span class="line">[sudo] password <span class="keyword">for</span> jiapei: </span><br><span class="line">730+0 records <span class="keyword">in</span></span><br><span class="line">730+0 records out</span><br><span class="line">3061841920 bytes (3.1 GB, 2.9 GiB) copied, 381.133 s, 8.0 MB/s</span><br></pre></td></tr></table></figure></p>
<h2 id="3-Boot-Into-Armbian"><a href="#3-Boot-Into-Armbian" class="headerlink" title="3. Boot Into Armbian"></a>3. Boot Into Armbian</h2><p>After we unplug the TF card from the host and put it into the <a href="http://www.orangepi.org/orangepiplus2/" target="_blank" rel="noopener">Orange Pi Plus 2 board</a>, Armbian Ubuntu Desktop boots successfully. Make sure the username and password are respectively:</p>
<ul>
<li><strong>root</strong></li>
<li><strong>1234</strong><br>And you will notice that<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">You are required to change your password immediately (root enforced)</span><br><span class="line">Changing password <span class="keyword">for</span> root.</span><br><span class="line">(current) UNIX password:</span><br><span class="line">Enter new UNIX password:</span><br><span class="line">Retype new UNIX password:</span><br><span class="line">...</span><br></pre></td></tr></table></figure>
</li>
</ul>
<p>And, during the <strong>FIRST</strong> boot, we’ll be asked to create a <strong>NEW</strong> <strong>user</strong> besides <strong>root</strong>:<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line">Creating a new user account. Press &lt;Ctrl-C&gt; to abort</span><br><span class="line">Desktop enironment will not be enabled <span class="keyword">if</span> you abort the new user creation</span><br><span class="line"></span><br><span class="line">Please provide a username (eg. your forename): orangepiplus2</span><br><span class="line">Trying to add user orangepiplus2</span><br><span class="line">Adding user <span class="string">'orangepiplus2'</span> ...</span><br><span class="line">Adding new group <span class="string">'orangepiplus2'</span> (1000) ...</span><br><span class="line">Adding new user <span class="string">'orangepiplus2'</span> (1000) with group <span class="string">'orangepiplus2'</span> ...</span><br><span class="line">Creating home directory <span class="string">'/home/orangepiplus2'</span> ...</span><br><span class="line">Copying files from <span class="string">'/etc/ske1'</span> ...</span><br><span class="line">Enter new UNIX password:</span><br><span class="line">Retype new UNIX password:</span><br><span class="line">passwd: password updated successfully</span><br><span class="line">Changing the user information <span class="keyword">for</span> orangepiplus2</span><br><span class="line">Eter the new value, or press ENTER <span class="keyword">for</span> the default</span><br><span class="line">       Full Name []:</span><br><span class="line">       Room Number []:</span><br><span class="line">       Work Phone []:</span><br><span class="line">       Home Phone []:</span><br><span class="line">       Other []:</span><br><span class="line">Is the information correct? [Y/n] Y</span><br><span class="line">...</span><br></pre></td></tr></table></figure></p>
<p>Then, <a href="http://www.orangepi.org/orangepiplus2/" target="_blank" rel="noopener">Orange Pi Plus 2</a> will boot into GUI as follows.<br><img src="https://raw.githubusercontent.com/LongerVision/BSP/master/armbian/01_armbian_ubuntu_desktop_overview.jpg" alt="Armbian Ubuntu Desktop Overview"><br>We are now able to see the kernel version is of <strong>3.4.113</strong>, which is a very old <a href="https://www.kernel.org/" target="_blank" rel="noopener">Linux Kernel</a>.<br><img src="https://raw.githubusercontent.com/LongerVision/BSP/master/armbian/02_armbian_kernel_version.jpg" alt="Armbian Kernel Version"><br>We then <strong>update/upgrade</strong> all upgradable packages, and have the system rebooted.<br><img src="https://raw.githubusercontent.com/LongerVision/BSP/master/armbian/03_armbian_sudo_apt_update.jpg" alt="Armbian Apt Update"><br><img src="https://raw.githubusercontent.com/LongerVision/BSP/master/armbian/04_armbian_sudo_apt_upgrade.jpg" alt="Armbian Apt Upgrade"><br>After finishing the upgrading, <strong>Ubuntu</strong> has successfully upgraded from <strong>16.04.3</strong> to <strong>16.04.4*, but </strong>Linux Kernel<strong> is still of version </strong>3.4.113**.<br><img src="https://raw.githubusercontent.com/LongerVision/BSP/master/armbian/05_upgraded.jpg" alt="Armbian All Upgraded"></p>
<h1 id="PART-B-Build-The-Newest-Armbian-U-Boot-and-Linux-Kernel-for-Orange-Pi-Plus-2"><a href="#PART-B-Build-The-Newest-Armbian-U-Boot-and-Linux-Kernel-for-Orange-Pi-Plus-2" class="headerlink" title="PART B: Build The Newest Armbian U-Boot and Linux Kernel for Orange Pi Plus 2"></a>PART B: Build The Newest Armbian U-Boot and Linux Kernel for Orange Pi Plus 2</h1><p>As discussed in <strong>PART A</strong>, the current <a href="https://www.kernel.org/" target="_blank" rel="noopener">Linux Kernel</a> on our <a href="http://www.orangepi.org/orangepiplus2/" target="_blank" rel="noopener">Orange Pi Plus 2</a> is of an old version <strong>3.4.113</strong>. Are we able to upgrade the Linux Kernel to the most recent one? <strong>The ANSWER is of course YES</strong>.</p>
<h2 id="1-Download-Armbian"><a href="#1-Download-Armbian" class="headerlink" title="1. Download Armbian"></a>1. Download Armbian</h2><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ git <span class="built_in">clone</span> git@github.com:armbian/build.git armbian</span><br></pre></td></tr></table></figure>
<h2 id="2-Test-Compiling"><a href="#2-Test-Compiling" class="headerlink" title="2. Test Compiling"></a>2. Test Compiling</h2><p>We now try to compile <a href="https://www.armbian.com/" target="_blank" rel="noopener">Armbian</a> for our very <strong>FIRST</strong> attempt. This will help us to download a lot required packages, including all <a href="https://releases.linaro.org/components/toolchain/binaries/" target="_blank" rel="noopener">Linaro toolchains</a>, <a href="http://www.denx.de/wiki/U-Boot/WebHome" target="_blank" rel="noopener">U-Boot</a>, etc., and save those packages under folder <strong>cache</strong>,<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br></pre></td><td class="code"><pre><span class="line">$ <span class="built_in">cd</span> ./armbian</span><br><span class="line">$ ./compile.sh </span><br><span class="line">[ o.k. ] Using config file [ config-default.conf ]</span><br><span class="line">[ warn ] This script requires root privileges, trying to use sudo </span><br><span class="line">[sudo] password <span class="keyword">for</span> jiapei: </span><br><span class="line">[ o.k. ] Using config file [ config-default.conf ]</span><br><span class="line">[ o.k. ] This script will try to update</span><br><span class="line">Permission denied (publickey).</span><br><span class="line">fatal: Could not <span class="built_in">read</span> from remote repository.</span><br><span class="line"></span><br><span class="line">Please make sure you have the correct access rights</span><br><span class="line">and the repository exists.</span><br><span class="line">Already on <span class="string">'master'</span></span><br><span class="line">Your branch is up-to-date with <span class="string">'origin/master'</span>.</span><br><span class="line">[ o.k. ] Preparing [ host ]</span><br><span class="line">[ o.k. ] Build host OS release [ xenial ]</span><br><span class="line">[ o.k. ] Syncing clock [ host ]</span><br><span class="line">[ .... ] Downloading [ gcc-linaro-arm-linux-gnueabihf-4.8-2014.04_linux ]</span><br><span class="line"><span class="comment">######################################################################## 100.0%</span></span><br><span class="line"><span class="comment">######################################################################## 100.0%</span></span><br><span class="line">[ .... ] Verifying </span><br><span class="line">gpg: keyring `/home/jiapei/Downloads/OperatingSystems/linux/distros/armbian/armbian/cache/.gpg/pubring.gpg<span class="string">' created</span></span><br><span class="line"><span class="string">gpg: /home/jiapei/Downloads/OperatingSystems/linux/distros/armbian/armbian/cache/.gpg/trustdb.gpg: trustdb created</span></span><br><span class="line"><span class="string">gpg: error reading key: public key not found</span></span><br><span class="line"><span class="string">gpg: keyring `/home/jiapei/Downloads/OperatingSystems/linux/distros/armbian/armbian/cache/.gpg/secring.gpg'</span> created</span><br><span class="line">gpg: requesting key 8F427EAF from hkp server keyserver.ubuntu.com</span><br><span class="line">gpg: key 8F427EAF: public key <span class="string">"Linaro Toolchain Builder &lt;michael.hope+cbuild@linaro.org&gt;"</span> imported</span><br><span class="line">gpg: Total number processed: 1</span><br><span class="line">gpg:               imported: 1  (RSA: 1)</span><br><span class="line">gpg: assuming signed data <span class="keyword">in</span> `gcc-linaro-arm-linux-gnueabihf-4.8-2014.04_linux.tar.xz<span class="string">'</span></span><br><span class="line"><span class="string">gpg: Signature made Wed 16 Apr 2014 11:29:14 AM PDT using RSA key ID 8F427EAF</span></span><br><span class="line"><span class="string">gpg: Good signature from "Linaro Toolchain Builder &lt;michael.hope+cbuild@linaro.org&gt;"</span></span><br><span class="line"><span class="string">[ .... ] Extracting </span></span><br><span class="line"><span class="string">[ o.k. ] Download complete </span></span><br><span class="line"><span class="string">[ .... ] Downloading [ gcc-linaro-4.9.4-2017.01-x86_64_aarch64-linux-gnu ]</span></span><br><span class="line"><span class="string">######################################################################## 100.0%</span></span><br><span class="line"><span class="string">######################################################################## 100.0%</span></span><br><span class="line"><span class="string">[ .... ] Verifying </span></span><br><span class="line"><span class="string">[ .... ] Extracting </span></span><br><span class="line"><span class="string">[ o.k. ] Download complete </span></span><br><span class="line"><span class="string">[ .... ] Downloading [ gcc-linaro-4.9.4-2017.01-x86_64_arm-linux-gnueabi ]</span></span><br><span class="line"><span class="string">######################################################################## 100.0%</span></span><br><span class="line"><span class="string">######################################################################## 100.0%</span></span><br><span class="line"><span class="string">[ .... ] Verifying </span></span><br><span class="line"><span class="string">[ .... ] Extracting </span></span><br><span class="line"><span class="string">[ o.k. ] Download complete </span></span><br><span class="line"><span class="string">[ .... ] Downloading [ gcc-linaro-4.9.4-2017.01-x86_64_arm-linux-gnueabihf ]</span></span><br><span class="line"><span class="string">######################################################################## 100.0%</span></span><br><span class="line"><span class="string">######################################################################## 100.0%</span></span><br><span class="line"><span class="string">[ .... ] Verifying </span></span><br><span class="line"><span class="string">[ .... ] Extracting </span></span><br><span class="line"><span class="string">[ o.k. ] Download complete </span></span><br><span class="line"><span class="string">[ .... ] Downloading [ gcc-linaro-5.5.0-2017.10-x86_64_aarch64-linux-gnu ]</span></span><br><span class="line"><span class="string">######################################################################## 100.0%</span></span><br><span class="line"><span class="string">######################################################################## 100.0%</span></span><br><span class="line"><span class="string">[ .... ] Verifying </span></span><br><span class="line"><span class="string">[ .... ] Extracting </span></span><br><span class="line"><span class="string">[ o.k. ] Download complete </span></span><br><span class="line"><span class="string">[ .... ] Downloading [ gcc-linaro-5.5.0-2017.10-x86_64_arm-linux-gnueabi ]</span></span><br><span class="line"><span class="string">######################################################################## 100.0%</span></span><br><span class="line"><span class="string">######################################################################## 100.0%</span></span><br><span class="line"><span class="string">[ .... ] Verifying </span></span><br><span class="line"><span class="string">[ .... ] Extracting </span></span><br><span class="line"><span class="string">[ o.k. ] Download complete </span></span><br><span class="line"><span class="string">[ .... ] Downloading [ gcc-linaro-5.5.0-2017.10-x86_64_arm-linux-gnueabihf ]</span></span><br><span class="line"><span class="string">######################################################################## 100.0%</span></span><br><span class="line"><span class="string">######################################################################## 100.0%</span></span><br><span class="line"><span class="string">[ .... ] Verifying </span></span><br><span class="line"><span class="string">[ .... ] Extracting </span></span><br><span class="line"><span class="string">[ o.k. ] Download complete </span></span><br><span class="line"><span class="string">[ .... ] Downloading [ gcc-linaro-6.4.1-2017.11-x86_64_arm-linux-gnueabihf ]</span></span><br><span class="line"><span class="string">######################################################################## 100.0%</span></span><br><span class="line"><span class="string">######################################################################## 100.0%</span></span><br><span class="line"><span class="string">[ .... ] Verifying </span></span><br><span class="line"><span class="string">[ .... ] Extracting </span></span><br><span class="line"><span class="string">[ o.k. ] Download complete </span></span><br><span class="line"><span class="string">[ .... ] Downloading [ gcc-linaro-6.4.1-2017.11-x86_64_aarch64-linux-gnu ]</span></span><br><span class="line"><span class="string">######################################################################## 100.0%</span></span><br><span class="line"><span class="string">######################################################################## 100.0%</span></span><br><span class="line"><span class="string">[ .... ] Verifying </span></span><br><span class="line"><span class="string">[ .... ] Extracting </span></span><br><span class="line"><span class="string">[ o.k. ] Download complete </span></span><br><span class="line"><span class="string">[ .... ] Downloading [ gcc-linaro-7.2.1-2017.11-x86_64_aarch64-linux-gnu ]</span></span><br><span class="line"><span class="string">######################################################################## 100.0%</span></span><br><span class="line"><span class="string">######################################################################## 100.0%</span></span><br><span class="line"><span class="string">[ .... ] Verifying </span></span><br><span class="line"><span class="string">[ .... ] Extracting </span></span><br><span class="line"><span class="string">[ o.k. ] Download complete </span></span><br><span class="line"><span class="string">[ .... ] Downloading [ gcc-linaro-7.2.1-2017.11-x86_64_arm-linux-gnueabihf ]</span></span><br><span class="line"><span class="string">######################################################################## 100.0%</span></span><br><span class="line"><span class="string">######################################################################## 100.0%</span></span><br><span class="line"><span class="string">[ .... ] Verifying </span></span><br><span class="line"><span class="string">[ .... ] Extracting </span></span><br><span class="line"><span class="string">[ o.k. ] Download complete</span></span><br></pre></td></tr></table></figure></p>
<p>Then, a canonical GUI will jump out onto the screen for you to make selections:<br><img src="https://raw.githubusercontent.com/LongerVision/BSP/master/armbian/06_what_to_build.jpg" alt="U-boot and kernel packages"><br><img src="https://raw.githubusercontent.com/LongerVision/BSP/master/armbian/07_kernel_configurations.jpg" alt="Show a kernel configuration menu before compilation"><br><img src="https://raw.githubusercontent.com/LongerVision/BSP/master/armbian/08_officialy_supported_boards.jpg" alt="Officially supported boards"></p>
<p>Clearly, our board <a href="http://www.orangepi.org/orangepiplus2/" target="_blank" rel="noopener">Orange Pi Plus 2</a> is <strong>NOT</strong> in the list. Therefore, we select <strong>Cancel</strong> here for now, and some <strong>ERROR</strong> messages will be generated as follows.<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">[ error ] ERROR <span class="keyword">in</span> <span class="keyword">function</span> <span class="built_in">source</span> [ main.sh:198 ]</span><br><span class="line">[ error ] No kernel branch selected </span><br><span class="line">[ o.k. ] Process terminated</span><br></pre></td></tr></table></figure></p>
<h2 id="3-Prepare-The-Board-Configuration-File"><a href="#3-Prepare-The-Board-Configuration-File" class="headerlink" title="3. Prepare The Board Configuration File"></a>3. Prepare The Board Configuration File</h2><p>We doublecheck the officially supported boards:<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line">$ <span class="built_in">cd</span> ./config/boards</span><br><span class="line">$ ls -1 *orangepi*</span><br><span class="line">orangepi2.conf</span><br><span class="line">orangepi2g-iot.csc</span><br><span class="line">orangepi.eos</span><br><span class="line">orangepilite.conf</span><br><span class="line">orangepimini.eos</span><br><span class="line">orangepione.conf</span><br><span class="line">orangepipc2.conf</span><br><span class="line">orangepipc.conf</span><br><span class="line">orangepipcplus.conf</span><br><span class="line">orangepiplus2e.conf</span><br><span class="line">orangepiplus.conf</span><br><span class="line">orangepiprime.conf</span><br><span class="line">orangepi-r1.conf</span><br><span class="line">orangepiwin.conf</span><br><span class="line">orangepizero.conf</span><br><span class="line">orangepizeroplus2-h3.conf</span><br><span class="line">orangepizeroplus2-h5.conf</span><br><span class="line">orangepizeroplus.conf</span><br></pre></td></tr></table></figure></p>
<p>As we can see, it is certain that our board <a href="http://www.orangepi.org/orangepiplus2/" target="_blank" rel="noopener">Orange Pi Plus 2</a> is <strong>NOT</strong> officially supported. Due to the <strong>trivial</strong> difference between <a href="http://www.orangepi.org/orangepiplus2/" target="_blank" rel="noopener">Orange Pi Plus 2</a> and <a href="http://www.orangepi.org/orangepiplus2e/" target="_blank" rel="noopener">Orange Pi Plus 2e</a>, we configure our <a href="http://www.orangepi.org/orangepiplus2/" target="_blank" rel="noopener">Orange Pi Plus 2</a> board as a <a href="http://www.orangepi.org/orangepiplus2e/" target="_blank" rel="noopener">Orange Pi Plus 2e</a> board by:<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ cp orangepiplus2e.conf orangepiplus2.conf</span><br></pre></td></tr></table></figure></p>
<p>Afterwards, we modify the file content in <strong>orangepiplus2.conf</strong> manually:<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ vim orangepiplus2.conf</span><br></pre></td></tr></table></figure></p>
<p>and, the file content is correspondingly modified to:<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># H3 quad core 2GB RAM WiFi eMMC</span></span><br><span class="line">BOARD_NAME=<span class="string">"Orange Pi+ 2"</span></span><br><span class="line">BOARDFAMILY=<span class="string">"sun8i"</span></span><br><span class="line">BOOTCONFIG=<span class="string">"orangepi_plus2_defconfig"</span></span><br><span class="line"><span class="comment">#</span></span><br><span class="line">MODULES=<span class="string">"8189fs #w1-sunxi #w1-gpio #w1-therm #gc2035 #vfe_v4l2 #sunxi-cir"</span></span><br><span class="line">MODULES_NEXT=<span class="string">"8189fs"</span></span><br><span class="line">CPUMIN=<span class="string">"408000"</span></span><br><span class="line">CPUMAX=<span class="string">"1296000"</span></span><br><span class="line"><span class="comment">#</span></span><br><span class="line">KERNEL_TARGET=<span class="string">"default,next,dev"</span></span><br><span class="line">CLI_TARGET=<span class="string">"stretch,xenial:next"</span></span><br><span class="line">DESKTOP_TARGET=<span class="string">"xenial:default"</span></span><br><span class="line"><span class="comment">#</span></span><br><span class="line">CLI_BETA_TARGET=<span class="string">""</span></span><br><span class="line">DESKTOP_BETA_TARGET=<span class="string">""</span></span><br><span class="line"><span class="comment">#</span></span><br><span class="line">RECOMMENDED=<span class="string">"Ubuntu_xenial_default_desktop:90,Debian_stretch_next:75"</span></span><br><span class="line"><span class="comment">#</span></span><br><span class="line">BOARDRATING=<span class="string">""</span></span><br><span class="line">CHIP=<span class="string">"http://docs.armbian.com/Hardware_Allwinner-H3/"</span></span><br><span class="line">HARDWARE=<span class="string">"http://www.orangepi.org/orangepiplus2/"</span></span><br><span class="line">FORUMS=<span class="string">"http://forum.armbian.com/index.php/forum/13-allwinner-h3/"</span></span><br><span class="line">BUY=<span class="string">"http://s.click.aliexpress.com/e/VbA6AEq"</span></span><br></pre></td></tr></table></figure></p>
<h2 id="4-Prepare-Board-Configuration-File-for-U-Boot"><a href="#4-Prepare-Board-Configuration-File-for-U-Boot" class="headerlink" title="4. Prepare Board Configuration File for U-Boot"></a>4. Prepare Board Configuration File for U-Boot</h2><p>Then, we recompile armbian with some particular options (Please refer to <a href="https://docs.armbian.com/Developer-Guide_Build-Options/" target="_blank" rel="noopener">Armbian Build Options</a> for parameter details):<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line">$ <span class="built_in">cd</span> ../../</span><br><span class="line">$ ./compile.sh BOARD=<span class="string">"orangepiplus2"</span> BRANCH=<span class="string">"next"</span> KERNEL_ONLY=<span class="string">"yes"</span> KERNEL_CONFIGURE=<span class="string">"no"</span></span><br><span class="line">[ o.k. ] Using config file [ config-default.conf ]</span><br><span class="line">[ warn ] This script requires root privileges, trying to use sudo </span><br><span class="line">[sudo] password <span class="keyword">for</span> jiapei: </span><br><span class="line">[ o.k. ] Using config file [ config-default.conf ]</span><br><span class="line">[ o.k. ] This script will try to update</span><br><span class="line">Permission denied (publickey).</span><br><span class="line">fatal: Could not <span class="built_in">read</span> from remote repository.</span><br><span class="line"></span><br><span class="line">Please make sure you have the correct access rights</span><br><span class="line">and the repository exists.</span><br><span class="line">Already on <span class="string">'master'</span></span><br><span class="line">Your branch is up-to-date with <span class="string">'origin/master'</span>.</span><br><span class="line">[ o.k. ] Command line: setting BOARD to [ orangepiplus2 ]</span><br><span class="line">[ o.k. ] Command line: setting BRANCH to [ next ]</span><br><span class="line">[ o.k. ] Command line: setting KERNEL_ONLY to [ no ]</span><br><span class="line">[ o.k. ] Command line: setting KERNEL_CONFIGURE to [ no ]</span><br><span class="line">[ o.k. ] Preparing [ host ]</span><br><span class="line">[ o.k. ] Build host OS release [ xenial ]</span><br><span class="line">[ o.k. ] Syncing clock [ host ]</span><br></pre></td></tr></table></figure></p>
<p>Again, the canonical GUI will jump out onto the screen for you to make selections, here we select <strong>Ubuntu Xenial 16.04 LTS</strong> and <strong>Image with console interface (server)</strong> respectively.<br><img src="https://raw.githubusercontent.com/LongerVision/BSP/master/armbian/09_target_OS_release.jpg" alt="Target OS release"><br><img src="https://raw.githubusercontent.com/LongerVision/BSP/master/armbian/10_target_image_type.jpg" alt="Target image type"></p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br></pre></td><td class="code"><pre><span class="line">[ o.k. ] Downloading sources </span><br><span class="line">[ o.k. ] Checking git sources [ u-boot v2017.11 ]</span><br><span class="line">[ .... ] Creating <span class="built_in">local</span> copy </span><br><span class="line">[ .... ] Fetching updates </span><br><span class="line">remote: Counting objects: 13853, <span class="keyword">done</span>.</span><br><span class="line">remote: Compressing objects: 100% (12500/12500), <span class="keyword">done</span>.</span><br><span class="line">remote: Total 13853 (delta 2493), reused 5244 (delta 1104)</span><br><span class="line">Receiving objects: 100% (13853/13853), 17.27 MiB | 1.00 MiB/s, <span class="keyword">done</span>.</span><br><span class="line">Resolving deltas: 100% (2493/2493), <span class="keyword">done</span>.</span><br><span class="line">From git://git.denx.de/u-boot</span><br><span class="line"> * tag               v2017.11   -&gt; FETCH_HEAD</span><br><span class="line">[ .... ] Checking out </span><br><span class="line">[ o.k. ] Checking git sources [ linux-mainline linux-4.14.y ]</span><br><span class="line">[ .... ] Creating <span class="built_in">local</span> copy </span><br><span class="line">[ .... ] Fetching updates </span><br><span class="line">remote: Counting objects: 65193, <span class="keyword">done</span>.</span><br><span class="line">remote: Compressing objects: 100% (60945/60945), <span class="keyword">done</span>.</span><br><span class="line">remote: Total 65193 (delta 5919), reused 26531 (delta 3272)</span><br><span class="line">Receiving objects: 100% (65193/65193), 172.40 MiB | 3.26 MiB/s, <span class="keyword">done</span>.</span><br><span class="line">Resolving deltas: 100% (5919/5919), <span class="keyword">done</span>.</span><br><span class="line">From git://git.kernel.org/pub/scm/linux/kernel/git/stable/linux-stable</span><br><span class="line"> * branch            linux-4.14.y -&gt; FETCH_HEAD</span><br><span class="line"> * [new branch]      linux-4.14.y -&gt; origin/linux-4.14.y</span><br><span class="line">[ .... ] Checking out </span><br><span class="line">[ o.k. ] Checking git sources [ sunxi-tools master ]</span><br><span class="line">[ .... ] Creating <span class="built_in">local</span> copy </span><br><span class="line">[ .... ] Fetching updates </span><br><span class="line">remote: Counting objects: 83, <span class="keyword">done</span>.</span><br><span class="line">remote: Compressing objects: 100% (78/78), <span class="keyword">done</span>.</span><br><span class="line">remote: Total 83 (delta 13), reused 33 (delta 4), pack-reused 0</span><br><span class="line">Unpacking objects: 100% (83/83), <span class="keyword">done</span>.</span><br><span class="line">From https://github.com/linux-sunxi/sunxi-tools</span><br><span class="line"> * branch            master     -&gt; FETCH_HEAD</span><br><span class="line"> * [new branch]      master     -&gt; origin/master</span><br><span class="line">[ .... ] Checking out </span><br><span class="line">[ o.k. ] Checking git sources [ rkbin-tools master ]</span><br><span class="line">[ .... ] Creating <span class="built_in">local</span> copy </span><br><span class="line">[ .... ] Fetching updates </span><br><span class="line">remote: Counting objects: 232, <span class="keyword">done</span>.</span><br><span class="line">remote: Compressing objects: 100% (182/182), <span class="keyword">done</span>.</span><br><span class="line">remote: Total 232 (delta 57), reused 209 (delta 50), pack-reused 0</span><br><span class="line">Receiving objects: 100% (232/232), 22.60 MiB | 8.32 MiB/s, <span class="keyword">done</span>.</span><br><span class="line">Resolving deltas: 100% (57/57), <span class="keyword">done</span>.</span><br><span class="line">From https://github.com/rockchip-linux/rkbin</span><br><span class="line"> * branch            master     -&gt; FETCH_HEAD</span><br><span class="line"> * [new branch]      master     -&gt; origin/master</span><br><span class="line">[ .... ] Checking out </span><br><span class="line">[ o.k. ] Checking git sources [ marvell-tools A3700_utils-armada-17.10 ]</span><br><span class="line">[ .... ] Creating <span class="built_in">local</span> copy </span><br><span class="line">[ .... ] Fetching updates </span><br><span class="line">remote: Counting objects: 294, <span class="keyword">done</span>.</span><br><span class="line">remote: Compressing objects: 100% (150/150), <span class="keyword">done</span>.</span><br><span class="line">remote: Total 294 (delta 151), reused 229 (delta 140), pack-reused 0</span><br><span class="line">Receiving objects: 100% (294/294), 5.80 MiB | 4.40 MiB/s, <span class="keyword">done</span>.</span><br><span class="line">Resolving deltas: 100% (151/151), <span class="keyword">done</span>.</span><br><span class="line">From https://github.com/MarvellEmbeddedProcessors/A3700-utils-marvell</span><br><span class="line"> * branch            A3700_utils-armada-17.10 -&gt; FETCH_HEAD</span><br><span class="line"> * [new branch]      A3700_utils-armada-17.10 -&gt; origin/A3700_utils-armada-17.10</span><br><span class="line">[ .... ] Checking out </span><br><span class="line">[ o.k. ] Checking git sources [ odroidc2-blobs master ]</span><br><span class="line">[ .... ] Creating <span class="built_in">local</span> copy </span><br><span class="line">[ .... ] Fetching updates </span><br><span class="line">remote: Counting objects: 13, <span class="keyword">done</span>.</span><br><span class="line">remote: Compressing objects: 100% (13/13), <span class="keyword">done</span>.</span><br><span class="line">remote: Total 13 (delta 0), reused 11 (delta 0), pack-reused 0</span><br><span class="line">Unpacking objects: 100% (13/13), <span class="keyword">done</span>.</span><br><span class="line">From https://github.com/armbian/odroidc2-blobs</span><br><span class="line"> * branch            master     -&gt; FETCH_HEAD</span><br><span class="line"> * [new branch]      master     -&gt; origin/master</span><br><span class="line">[ .... ] Checking out </span><br><span class="line">[ o.k. ] Compiling [ sunxi-tools ]</span><br><span class="line">Setting version information: 5c19710</span><br><span class="line"></span><br><span class="line">[ o.k. ] Installing [ rkbin-tools ]</span><br><span class="line">[ o.k. ] Cleaning output/debs <span class="keyword">for</span> [ orangepiplus2 next ]</span><br><span class="line">[ o.k. ] Cleaning [ u-boot/v2017.11 ]</span><br><span class="line">[ o.k. ] Compiling u-boot [ 2017.11 ]</span><br><span class="line">[ o.k. ] Compiler version [ arm-linux-gnueabihf-gcc 7.2.1 ]</span><br><span class="line">[ .... ] Checking out sources </span><br><span class="line">[ o.k. ] Cleaning [ u-boot/v2017.11 ]</span><br><span class="line">[ o.k. ] Started patching process <span class="keyword">for</span> [ u-boot sunxi-orangepiplus2-next ]</span><br><span class="line">[ o.k. ] Looking <span class="keyword">for</span> user patches <span class="keyword">in</span> [ userpatches/u-boot/u-boot-sunxi ]</span><br><span class="line">[ o.k. ] * [l][c] 0020-sunxi-call-fdt_fixup_ethernet-again-to-set-macaddr-f.patch </span><br><span class="line">[ o.k. ] * [l][c] 4kfix-limit-screen-to-full-hd.patch </span><br><span class="line">[ o.k. ] * [l][c] Add-A20-Olimex-SOM204-EVB-board.patch </span><br><span class="line">[ o.k. ] * [l][c] add-a20-olinuxino-micro-emmc-support.patch </span><br><span class="line">[ o.k. ] * [l][c] add-a20-optional-eMMC.patch </span><br><span class="line">[ o.k. ] * [l][c] add-bananapi-bpi-m2-zero.patch </span><br><span class="line">[ o.k. ] * [l][c] add-beelink-x2.patch </span><br><span class="line">[ o.k. ] * [l][c] add-nanopi-air-emmc.patch </span><br><span class="line">[ o.k. ] * [l][c] add-nanopi-duo.patch </span><br><span class="line">[ o.k. ] * [l][c] add-nanopi-m1-plus2-emmc.patch </span><br><span class="line">[ o.k. ] * [l][c] add-nanopineoplus2.patch </span><br><span class="line">[ o.k. ] * [l][c] add-orangepi-plus2-emmc.patch </span><br><span class="line">[ o.k. ] * [l][c] add-orangepi-zeroplus.patch </span><br><span class="line">[ o.k. ] * [l][c] add-orangepi-zeroplus2_h3.patch </span><br><span class="line">[ o.k. ] * [l][c] add-sunvell-r69.patch </span><br><span class="line">[ o.k. ] * [l][c] add-tritium.patch </span><br><span class="line">[ o.k. ] * [l][c] add_emmc_olinuxino_a64.patch </span><br><span class="line">[ o.k. ] * [l][c] add_emmc_orangepiwin.patch </span><br><span class="line">[ o.k. ] * [l][c] adjust-default-dram-clockspeeds.patch </span><br><span class="line">[ o.k. ] * [l][c] adjust-small-boards-cpufreq.patch </span><br><span class="line">[ o.k. ] * [l][c] <span class="built_in">enable</span>-DT-overlays-support.patch </span><br><span class="line">[ o.k. ] * [l][c] <span class="built_in">enable</span>-autoboot-keyed.patch </span><br><span class="line">[ o.k. ] * [l][c] fdt-setprop-fix-unaligned-access.patch </span><br><span class="line">[ o.k. ] * [l][c] fix-sdcard-detect-bpi-m2z.patch </span><br><span class="line">[ o.k. ] * [l][c] fix-sunxi-gpio-driver.patch </span><br><span class="line">[ o.k. ] * [l][c] fix-usb1-vbus-opiwin.patch </span><br><span class="line">[ o.k. ] * [l][c] h3-Fix-PLL1-setup-to-never-use-dividers.patch </span><br><span class="line">[ o.k. ] * [l][c] h3-enable-power-led.patch </span><br><span class="line">[ o.k. ] * [l][c] h3-set-safe-axi_apb-clock-dividers.patch </span><br><span class="line">[ o.k. ] * [l][c] lower-default-DRAM-freq-A64-H5.patch </span><br><span class="line">[ o.k. ] * [l][c] lower-default-cpufreq-H5.patch </span><br><span class="line">[ o.k. ] * [l][c] sun8i-set-machid.patch </span><br><span class="line">[ o.k. ] * [l][c] video-fix-vsync-polarity-bits.patch </span><br><span class="line">[ o.k. ] * [l][b] workaround-reboot-is-poweroff-olimex-a20.patch </span><br><span class="line">  HOSTCC  scripts/basic/fixdep</span><br><span class="line">  HOSTCC  scripts/kconfig/conf.o</span><br><span class="line">  SHIPPED scripts/kconfig/zconf.tab.c</span><br><span class="line">  SHIPPED scripts/kconfig/zconf.lex.c</span><br><span class="line">  SHIPPED scripts/kconfig/zconf.hash.c</span><br><span class="line">  HOSTCC  scripts/kconfig/zconf.tab.o</span><br><span class="line">  HOSTLD  scripts/kconfig/conf</span><br><span class="line">***</span><br><span class="line">*** Can<span class="string">'t find default configuration "arch/../configs/orangepi_plus2_defconfig"!</span></span><br><span class="line"><span class="string">***</span></span><br><span class="line"><span class="string">scripts/kconfig/Makefile:121: recipe for target '</span>orangepi_plus2_defconfig<span class="string">' failed</span></span><br><span class="line"><span class="string">make[1]: *** [orangepi_plus2_defconfig] Error 1</span></span><br><span class="line"><span class="string">Makefile:479: recipe for target '</span>orangepi_plus2_defconfig<span class="string">' failed</span></span><br><span class="line"><span class="string">make: *** [orangepi_plus2_defconfig] Error 2</span></span><br><span class="line"><span class="string">sed: can'</span>t <span class="built_in">read</span> .config: No such file or directory</span><br><span class="line">scripts/kconfig/conf  --silentoldconfig Kconfig</span><br><span class="line">***</span><br><span class="line">*** Configuration file <span class="string">".config"</span> not found!</span><br><span class="line">***</span><br><span class="line">*** Please run some configurator (e.g. <span class="string">"make oldconfig"</span> or</span><br><span class="line">*** <span class="string">"make menuconfig"</span> or <span class="string">"make xconfig"</span>).</span><br><span class="line">***</span><br><span class="line">scripts/kconfig/Makefile:46: recipe <span class="keyword">for</span> target <span class="string">'silentoldconfig'</span> failed</span><br><span class="line">make[2]: *** [silentoldconfig] Error 1</span><br><span class="line">Makefile:479: recipe <span class="keyword">for</span> target <span class="string">'silentoldconfig'</span> failed</span><br><span class="line">make[1]: *** [silentoldconfig] Error 2</span><br><span class="line">make: *** No rule to make target <span class="string">'include/config/auto.conf'</span>, needed by <span class="string">'include/config/uboot.release'</span>.  Stop.</span><br><span class="line">[ error ] ERROR <span class="keyword">in</span> <span class="keyword">function</span> compile_uboot [ compilation.sh:156 ]</span><br><span class="line">[ error ] U-boot compilation failed </span><br><span class="line">[ o.k. ] Process terminated</span><br></pre></td></tr></table></figure>
<p>We end up with <strong>ERROR</strong> messages again. Clearly, it’s because <strong>U-Boot</strong> does <strong>NOT</strong> support <strong>orangepi_plus2_defconfig</strong>. Therefore, we do the same to <strong>U-Boot</strong> board configuration by <strong>two</strong> steps:</p>
<h3 id="1-STEP-1"><a href="#1-STEP-1" class="headerlink" title="1) STEP 1:"></a>1) STEP 1:</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line">$ <span class="built_in">cd</span> ./cache/sources/u-boot/v2017.11/configs</span><br><span class="line">$ ls -1 *orangepi*</span><br><span class="line">orangepi_2_defconfig</span><br><span class="line">orangepi_2_defconfig.orig</span><br><span class="line">orangepi_lite_defconfig</span><br><span class="line">orangepi_one_defconfig</span><br><span class="line">orangepi_pc2_defconfig</span><br><span class="line">orangepi_pc2_defconfig.orig</span><br><span class="line">orangepi_pc_defconfig</span><br><span class="line">orangepi_pc_plus_defconfig</span><br><span class="line">orangepi_plus2e_defconfig</span><br><span class="line">orangepi_plus2e_defconfig.orig</span><br><span class="line">orangepi_plus_defconfig</span><br><span class="line">orangepi_plus_defconfig.orig</span><br><span class="line">orangepi_prime_defconfig</span><br><span class="line">orangepi_win_defconfig</span><br><span class="line">orangepi_win_defconfig.orig</span><br><span class="line">orangepi_zero_defconfig</span><br><span class="line">orangepi_zero_defconfig.orig</span><br><span class="line">orangepi_zero_plus2_defconfig</span><br><span class="line">orangepi_zero_plus2_h3_defconfig</span><br><span class="line">orangepizero_plus_defconfig</span><br></pre></td></tr></table></figure>
<p>Clearly, <strong>orangepi_plus2_defconfig</strong> is <strong>NOT</strong> in the list. Therefore, we do:<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">$ sudo cp orangepi_plus2e_defconfig orangepi_plus2_defconfig</span><br><span class="line">$ sudo vim orangepi_plus2_defconfig</span><br></pre></td></tr></table></figure></p>
<p>and ensure any <strong>plus2e</strong> is now <strong>plus2</strong>.<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line">$ cat orangepi_plus2_defconfig</span><br><span class="line">CONFIG_ARM=y</span><br><span class="line">CONFIG_ARCH_SUNXI=y</span><br><span class="line">CONFIG_MACH_SUN8I_H3=y</span><br><span class="line">CONFIG_DRAM_CLK=624</span><br><span class="line">CONFIG_DRAM_ZQ=3881979</span><br><span class="line">CONFIG_DRAM_ODT_EN=y</span><br><span class="line">CONFIG_MACPWR=<span class="string">"PD6"</span></span><br><span class="line">CONFIG_MMC_SUNXI_SLOT_EXTRA=2</span><br><span class="line">CONFIG_DEFAULT_DEVICE_TREE=<span class="string">"sun8i-h3-orangepi-plus2"</span></span><br><span class="line"><span class="comment"># CONFIG_SYS_MALLOC_CLEAR_ON_INIT is not set</span></span><br><span class="line">CONFIG_SPL=y</span><br><span class="line">CONFIG_SPL_I2C_SUPPORT=y</span><br><span class="line"><span class="comment"># CONFIG_CMD_FLASH is not set</span></span><br><span class="line"><span class="comment"># CONFIG_CMD_FPGA is not set</span></span><br><span class="line"><span class="comment"># CONFIG_SPL_DOS_PARTITION is not set</span></span><br><span class="line"><span class="comment"># CONFIG_SPL_ISO_PARTITION is not set</span></span><br><span class="line"><span class="comment"># CONFIG_SPL_EFI_PARTITION is not set</span></span><br><span class="line">CONFIG_SUN8I_EMAC=y</span><br><span class="line">CONFIG_SY8106A_POWER=y</span><br><span class="line">CONFIG_USB_EHCI_HCD=y</span><br><span class="line">CONFIG_SYS_USB_EVENT_POLL_VIA_INT_QUEUE=y</span><br></pre></td></tr></table></figure></p>
<h3 id="2-STEP-2"><a href="#2-STEP-2" class="headerlink" title="2) STEP 2:"></a>2) STEP 2:</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">$ <span class="built_in">cd</span> ./cache/sources/u-boot/v2017.11/arch/arm/dts</span><br><span class="line">$ ls -1 *sun8i-h3-orangepi*</span><br><span class="line">sun8i-h3-orangepi-2.dts</span><br><span class="line">sun8i-h3-orangepi-lite.dts</span><br><span class="line">sun8i-h3-orangepi-one.dts</span><br><span class="line">sun8i-h3-orangepi-pc.dts</span><br><span class="line">sun8i-h3-orangepi-pc-plus.dts</span><br><span class="line">sun8i-h3-orangepi-plus2e.dts</span><br><span class="line">sun8i-h3-orangepi-plus.dts</span><br><span class="line">sun8i-h3-orangepi-zeroplus2.dts</span><br></pre></td></tr></table></figure>
<p>Clearly, <strong>sun8i-h3-orangepi-plus2.dts</strong> is <strong>NOT</strong> in the list. Therefore, we do:<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">$ sudo cp sun8i-h3-orangepi-plus2e.dts sun8i-h3-orangepi-plus2.dts</span><br><span class="line">$ sudo vim sun8i-h3-orangepi-plus2.dts</span><br></pre></td></tr></table></figure></p>
<p>and ensure any <strong>2e/2E</strong> is now <strong>2</strong>.<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br></pre></td><td class="code"><pre><span class="line">$ cat sun8i-h3-orangepi-plus2.dts</span><br><span class="line">...... // ignore</span><br><span class="line">/*</span><br><span class="line"> * The Orange Pi Plus 2 is an extended version of the Orange Pi PC Plus 2,</span><br><span class="line"> * with 2G RAM and an external gbit ethernet phy.</span><br><span class="line"> */</span><br><span class="line"></span><br><span class="line"><span class="comment">#include "sun8i-h3-orangepi-pc-plus.dts"</span></span><br><span class="line"></span><br><span class="line">/ &#123;</span><br><span class="line">        model = <span class="string">"Xunlong Orange Pi Plus 2"</span>;</span><br><span class="line">        compatible = <span class="string">"xunlong,orangepi-plus2"</span>, <span class="string">"allwinner,sun8i-h3"</span>;</span><br><span class="line"></span><br><span class="line">        reg_gmac_3v3: gmac-3v3 &#123;</span><br><span class="line">                compatible = <span class="string">"regulator-fixed"</span>;</span><br><span class="line">                pinctrl-names = <span class="string">"default"</span>;</span><br><span class="line">                pinctrl-0 = &lt;&amp;gmac_power_pin_orangepi&gt;;</span><br><span class="line">                regulator-name = <span class="string">"gmac-3v3"</span>;</span><br><span class="line">                regulator-min-microvolt = &lt;3300000&gt;;</span><br><span class="line">                regulator-max-microvolt = &lt;3300000&gt;;</span><br><span class="line">                startup-delay-us = &lt;100000&gt;;</span><br><span class="line">                <span class="built_in">enable</span>-active-high;</span><br><span class="line">                gpio = &lt;&amp;pio 3 6 GPIO_ACTIVE_HIGH&gt;;</span><br><span class="line">        &#125;;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line">&amp;emac &#123;</span><br><span class="line">        /* The Orange Pi Plus 2 uses an external gbit phy */</span><br><span class="line">        pinctrl-names = <span class="string">"default"</span>;</span><br><span class="line">        pinctrl-0 = &lt;&amp;emac_rgmii_pins&gt;;</span><br><span class="line">        phy-supply = &lt;&amp;reg_gmac_3v3&gt;;</span><br><span class="line">        phy-mode = <span class="string">"rgmii"</span>;</span><br><span class="line">        /delete-property/allwinner,use-internal-phy;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line">&amp;pio &#123;</span><br><span class="line">        gmac_power_pin_orangepi: gmac_power_pin@0 &#123;</span><br><span class="line">                allwinner,pins = <span class="string">"PD6"</span>;</span><br><span class="line">                allwinner,<span class="keyword">function</span> = <span class="string">"gpio_out"</span>;</span><br><span class="line">                allwinner,drive = &lt;SUN4I_PINCTRL_10_MA&gt;;</span><br><span class="line">                allwinner,pull = &lt;SUN4I_PINCTRL_NO_PULL&gt;;</span><br><span class="line">        &#125;;</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure></p>
<h2 id="5-Build-the-Newest-Supported-Linux-Kernels"><a href="#5-Build-the-Newest-Supported-Linux-Kernels" class="headerlink" title="5. Build the Newest Supported Linux Kernels"></a>5. Build the Newest Supported Linux Kernels</h2><p>Before we build the system again, we just need to ensure our <strong>python</strong> is of version <strong>2</strong> instead of <strong>3</strong>, otherwise, you’ll get some <strong>ERROR</strong> message like:<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">ImportError: No module named _libfdt</span><br></pre></td></tr></table></figure></p>
<p><strong>NOW</strong>, we build the system <strong>AGAIN</strong>:<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br></pre></td><td class="code"><pre><span class="line">$ ./compile.sh BOARD=<span class="string">"orangepiplus2"</span> BRANCH=<span class="string">"next"</span> KERNEL_ONLY=<span class="string">"yes"</span> KERNEL_CONFIGURE=<span class="string">"no"</span></span><br><span class="line">[ o.k. ] Using config file [ config-default.conf ]</span><br><span class="line">[ warn ] This script requires root privileges, trying to use sudo </span><br><span class="line">[ o.k. ] Using config file [ config-default.conf ]</span><br><span class="line">[ o.k. ] This script will try to update</span><br><span class="line">Permission denied (publickey).</span><br><span class="line">fatal: Could not <span class="built_in">read</span> from remote repository.</span><br><span class="line"></span><br><span class="line">Please make sure you have the correct access rights</span><br><span class="line">and the repository exists.</span><br><span class="line">Already on <span class="string">'master'</span></span><br><span class="line">Your branch is up-to-date with <span class="string">'origin/master'</span>.</span><br><span class="line">[ o.k. ] Command line: setting BOARD to [ orangepiplus2 ]</span><br><span class="line">[ o.k. ] Command line: setting BRANCH to [ next ]</span><br><span class="line">[ o.k. ] Command line: setting KERNEL_ONLY to [ yes ]</span><br><span class="line">[ o.k. ] Command line: setting KERNEL_CONFIGURE to [ no ]</span><br><span class="line">[ o.k. ] Preparing [ host ]</span><br><span class="line">[ o.k. ] Build host OS release [ xenial ]</span><br><span class="line">[ o.k. ] Syncing clock [ host ]</span><br><span class="line">[ o.k. ] Downloading sources</span><br><span class="line">[ o.k. ] Checking git sources [ u-boot v2017.11 ]</span><br><span class="line">[ .... ] Checking out </span><br><span class="line">[ o.k. ] Checking git sources [ linux-mainline linux-4.14.y ]</span><br><span class="line">[ .... ] Up to date </span><br><span class="line">[ o.k. ] Checking git sources [ sunxi-tools master ]</span><br><span class="line">[ .... ] Up to date </span><br><span class="line">[ o.k. ] Checking git sources [ rkbin-tools master ]</span><br><span class="line">[ .... ] Up to date </span><br><span class="line">[ o.k. ] Checking git sources [ marvell-tools A3700_utils-armada-17.10 ]</span><br><span class="line">[ .... ] Up to date </span><br><span class="line">[ o.k. ] Checking git sources [ odroidc2-blobs master ]</span><br><span class="line">[ .... ] Up to date </span><br><span class="line">[ o.k. ] Cleaning output/debs <span class="keyword">for</span> [ orangepiplus2 next ]</span><br><span class="line">[ o.k. ] Cleaning [ u-boot/v2017.11 ]</span><br><span class="line">[ o.k. ] Compiling u-boot [ 2017.11 ]</span><br><span class="line">[ o.k. ] Compiler version [ arm-linux-gnueabihf-gcc 7.2.1 ]</span><br><span class="line">[ .... ] Checking out sources </span><br><span class="line">[ o.k. ] Cleaning [ u-boot/v2017.11 ]</span><br><span class="line">[ o.k. ] Started patching process <span class="keyword">for</span> [ u-boot sunxi-orangepiplus2-next ]</span><br><span class="line">[ o.k. ] Looking <span class="keyword">for</span> user patches <span class="keyword">in</span> [ userpatches/u-boot/u-boot-sunxi ]</span><br><span class="line">[ o.k. ] * [l][c] 0020-sunxi-call-fdt_fixup_ethernet-again-to-set-macaddr-f.patch </span><br><span class="line">[ o.k. ] * [l][c] 4kfix-limit-screen-to-full-hd.patch </span><br><span class="line">[ o.k. ] * [l][c] Add-A20-Olimex-SOM204-EVB-board.patch </span><br><span class="line">[ o.k. ] * [l][c] add-a20-olinuxino-micro-emmc-support.patch </span><br><span class="line">[ o.k. ] * [l][c] add-a20-optional-eMMC.patch </span><br><span class="line">[ o.k. ] * [l][c] add-bananapi-bpi-m2-zero.patch </span><br><span class="line">[ o.k. ] * [l][c] add-beelink-x2.patch </span><br><span class="line">[ o.k. ] * [l][c] add-nanopi-air-emmc.patch </span><br><span class="line">[ o.k. ] * [l][c] add-nanopi-duo.patch </span><br><span class="line">[ o.k. ] * [l][c] add-nanopi-m1-plus2-emmc.patch </span><br><span class="line">[ o.k. ] * [l][c] add-nanopineoplus2.patch </span><br><span class="line">[ o.k. ] * [l][c] add-orangepi-plus2-emmc.patch </span><br><span class="line">[ o.k. ] * [l][c] add-orangepi-zeroplus.patch </span><br><span class="line">[ o.k. ] * [l][c] add-orangepi-zeroplus2_h3.patch </span><br><span class="line">[ o.k. ] * [l][c] add-sunvell-r69.patch </span><br><span class="line">[ o.k. ] * [l][c] add-tritium.patch </span><br><span class="line">[ o.k. ] * [l][c] add_emmc_olinuxino_a64.patch </span><br><span class="line">[ o.k. ] * [l][c] add_emmc_orangepiwin.patch </span><br><span class="line">[ o.k. ] * [l][c] adjust-default-dram-clockspeeds.patch </span><br><span class="line">[ o.k. ] * [l][c] adjust-small-boards-cpufreq.patch </span><br><span class="line">[ o.k. ] * [l][c] <span class="built_in">enable</span>-DT-overlays-support.patch </span><br><span class="line">[ o.k. ] * [l][c] <span class="built_in">enable</span>-autoboot-keyed.patch </span><br><span class="line">[ o.k. ] * [l][c] fdt-setprop-fix-unaligned-access.patch </span><br><span class="line">[ o.k. ] * [l][c] fix-sdcard-detect-bpi-m2z.patch </span><br><span class="line">[ o.k. ] * [l][c] fix-sunxi-gpio-driver.patch </span><br><span class="line">[ o.k. ] * [l][c] fix-usb1-vbus-opiwin.patch </span><br><span class="line">[ o.k. ] * [l][c] h3-Fix-PLL1-setup-to-never-use-dividers.patch </span><br><span class="line">[ o.k. ] * [l][c] h3-enable-power-led.patch </span><br><span class="line">[ o.k. ] * [l][c] h3-set-safe-axi_apb-clock-dividers.patch </span><br><span class="line">[ o.k. ] * [l][c] lower-default-DRAM-freq-A64-H5.patch </span><br><span class="line">[ o.k. ] * [l][c] lower-default-cpufreq-H5.patch </span><br><span class="line">[ o.k. ] * [l][c] sun8i-set-machid.patch </span><br><span class="line">[ o.k. ] * [l][c] video-fix-vsync-polarity-bits.patch </span><br><span class="line">[ o.k. ] * [l][b] workaround-reboot-is-poweroff-olimex-a20.patch </span><br><span class="line">  HOSTCC  scripts/basic/fixdep</span><br><span class="line">  HOSTCC  scripts/kconfig/conf.o</span><br><span class="line">  HOSTCC  scripts/kconfig/zconf.tab.o</span><br><span class="line">  HOSTLD  scripts/kconfig/conf</span><br><span class="line"><span class="comment">#</span></span><br><span class="line"><span class="comment"># configuration written to .config</span></span><br><span class="line"><span class="comment">#</span></span><br><span class="line">scripts/kconfig/conf  --silentoldconfig Kconfig</span><br><span class="line">.config:1120:warning: override: reassigning to symbol BOOTDELAY</span><br><span class="line"><span class="comment">#</span></span><br><span class="line"><span class="comment"># configuration written to .config</span></span><br><span class="line"><span class="comment">#</span></span><br><span class="line">  CHK     include/config.h</span><br><span class="line">  UPD     include/config.h</span><br><span class="line">  GEN     include/autoconf.mk.dep</span><br><span class="line">  CFG     u-boot.cfg</span><br><span class="line">  CFG     spl/u-boot.cfg</span><br><span class="line">  GEN     include/autoconf.mk</span><br><span class="line">  GEN     spl/include/autoconf.mk</span><br><span class="line">  CHK     include/config/uboot.release</span><br><span class="line">  CHK     include/generated/timestamp_autogenerated.h</span><br><span class="line">  UPD     include/generated/timestamp_autogenerated.h</span><br><span class="line">  UPD     include/config/uboot.release</span><br><span class="line">  CHK     include/generated/version_autogenerated.h</span><br><span class="line">  HOSTCC  scripts/dtc/dtc.o</span><br><span class="line">  ......</span><br></pre></td></tr></table></figure></p>
<p>And, it took me about 5 minutes to have everything built.<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line">  ......</span><br><span class="line">patching file tools/include/tools/be_byteshift.h</span><br><span class="line">patching file tools/include/tools/le_byteshift.h</span><br><span class="line">  CLEAN   scripts/basic</span><br><span class="line">  CLEAN   scripts/dtc</span><br><span class="line">  CLEAN   scripts/kconfig</span><br><span class="line">  CLEAN   scripts/mod</span><br><span class="line">  CLEAN   scripts/selinux/genheaders</span><br><span class="line">  CLEAN   scripts/selinux/mdp</span><br><span class="line">  CLEAN   scripts</span><br><span class="line">dpkg-deb: building package &apos;linux-dtb-next-sunxi&apos; in &apos;../linux-dtb-next-sunxi_5.41_armhf.deb&apos;.</span><br><span class="line">dpkg-deb: building package &apos;linux-headers-next-sunxi&apos; in &apos;../linux-headers-next-sunxi_5.41_armhf.deb&apos;.</span><br><span class="line">dpkg-deb: building package &apos;linux-image-next-sunxi&apos; in &apos;../linux-image-next-sunxi_5.41_armhf.deb&apos;.</span><br><span class="line">dpkg-genchanges: warning: package linux-libc-dev-next-sunxi in control file but not in files list</span><br><span class="line">dpkg-genchanges: binary-only upload (no source code included)</span><br><span class="line">dpkg-deb: building package &apos;linux-source-4.14.22-next-sunxi&apos; in &apos;/home/jiapei/Downloads/OperatingSystems/linux/distros/armbian/armbian/.tmp/linux-source-next-sunxi_5.41_all.deb&apos;.</span><br><span class="line">[ o.k. ] Kernel build done [ @host ]</span><br><span class="line">[ o.k. ] Target directory [ /home/jiapei/Downloads/OperatingSystems/linux/distros/armbian/armbian/output/debs/ ]</span><br><span class="line">[ o.k. ] File name [ linux-image-next-sunxi_5.41_armhf.deb ]</span><br><span class="line">[ o.k. ] Runtime [ 5 min ]</span><br></pre></td></tr></table></figure></p>
<h1 id="PART-B-Copy-Linux-Kernel-DEBs-for-Orange-Pi-Plus-2"><a href="#PART-B-Copy-Linux-Kernel-DEBs-for-Orange-Pi-Plus-2" class="headerlink" title="PART B: Copy Linux Kernel DEBs for Orange Pi Plus 2"></a>PART B: Copy Linux Kernel DEBs for Orange Pi Plus 2</h1><h2 id="1-Doublecheck-Built-Linux-Kernel-Related-DEBs"><a href="#1-Doublecheck-Built-Linux-Kernel-Related-DEBs" class="headerlink" title="1. Doublecheck Built Linux Kernel Related DEBs"></a>1. Doublecheck Built Linux Kernel Related DEBs</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">$ cd ./output/debs</span><br><span class="line">$ ls -1 *</span><br><span class="line">linux-dtb-next-sunxi_5.41_armhf.deb</span><br><span class="line">linux-headers-next-sunxi_5.41_armhf.deb</span><br><span class="line">linux-image-next-sunxi_5.41_armhf.deb</span><br><span class="line">linux-source-next-sunxi_5.41_all.deb</span><br><span class="line">linux-u-boot-next-orangepiplus2_5.41_armhf.deb</span><br><span class="line"></span><br><span class="line">extra:</span><br></pre></td></tr></table></figure>
<p><strong>Five</strong> .deb files have been successfully generated, and the folder <strong>extra</strong> is empty.</p>
<h2 id="2-Copy-Built-DEBs-onto-TF-Card"><a href="#2-Copy-Built-DEBs-onto-TF-Card" class="headerlink" title="2. Copy Built DEBs onto TF Card"></a>2. Copy Built DEBs onto TF Card</h2><p>Since Armbian Ubuntu Desktop has already been installed on our TF card, after plugging TF card back to my host computer again, it’s automatically mounted as <strong>/media/jiapei/ab9545b9-0d2d-4927-83f3-fae97ced83a9</strong>. Then, we copy all <strong>five</strong> .deb files onto TF card by:<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ cp *.deb /media/jiapei/ab9545b9-0d2d-4927-83f3-fae97ced83a9/home/orangepiplus2/</span><br></pre></td></tr></table></figure></p>
<h1 id="PART-C-Install-the-Built-DEBs-Remove-the-Old-Kernel-s-and-Wifi-Configuration"><a href="#PART-C-Install-the-Built-DEBs-Remove-the-Old-Kernel-s-and-Wifi-Configuration" class="headerlink" title="PART C: Install the Built DEBs, Remove the Old Kernel(s), and Wifi Configuration"></a>PART C: Install the Built DEBs, Remove the Old Kernel(s), and Wifi Configuration</h1><p>Now we plug the TF card back into the <a href="http://www.orangepi.org/orangepiplus2/" target="_blank" rel="noopener">Orange Pi Plus 2 board</a> and boot into Armbian Ubuntu Desktop with kernel <strong>3.4.113</strong>. </p>
<h2 id="1-Install-NEW-Linux-Kernels"><a href="#1-Install-NEW-Linux-Kernels" class="headerlink" title="1. Install NEW Linux Kernels"></a>1. Install NEW Linux Kernels</h2><p>Single command will do.<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ sudo dpkg -i *.deb</span><br></pre></td></tr></table></figure></p>
<p><img src="https://raw.githubusercontent.com/LongerVision/BSP/master/armbian/11_debs_installed.jpg" alt="Install Built DEBs"><br>It’s OK for us <strong>NOT</strong> to upgrade u-boot.</p>
<h2 id="2-Remove-OLD-Linux-Kernel-s"><a href="#2-Remove-OLD-Linux-Kernel-s" class="headerlink" title="2. Remove OLD Linux Kernel(s)"></a>2. Remove OLD Linux Kernel(s)</h2><p>Reboot <a href="http://www.orangepi.org/orangepiplus2/" target="_blank" rel="noopener">Orange Pi Plus 2 board</a>, and you’ll see the <strong>NEW</strong> kernel <strong>4.14.22</strong> is now booted successfully. Now, it’s optional for us to remove old kernel(s) <strong>3.4.113</strong>. Two commands will do.<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">dpkg --list | grep linux-image</span><br></pre></td></tr></table></figure></p>
<p>will help to list all installed <a href="https://www.kernel.org/" target="_blank" rel="noopener">Linux Kernel</a>. And then, we remove all unwanted kernels, for instance:<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">dpkg --purge linux-image-sun8i</span><br></pre></td></tr></table></figure></p>
<p><img src="https://raw.githubusercontent.com/LongerVision/BSP/master/armbian/12_kernel_updated.jpg" alt="Remove Old Kernels"></p>
<h2 id="3-Wifi-Configuration"><a href="#3-Wifi-Configuration" class="headerlink" title="3. Wifi Configuration"></a>3. Wifi Configuration</h2><p>As known, <a href="http://www.orangepi.org/orangepiplus2/" target="_blank" rel="noopener">Orange Pi Plus 2 board</a> comes with Wifi 2.4G support. To enable Wifi for <a href="http://www.orangepi.org/orangepiplus2/" target="_blank" rel="noopener">Orange Pi Plus 2 board</a>, we need to make sure there are <strong>ONLY</strong> 3 effective lines in file <strong>/etc/network/interfaces</strong>:<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">source /etc/network/interfaces.d/*</span><br><span class="line">auto lo</span><br><span class="line">iface lo inet loopback</span><br></pre></td></tr></table></figure></p>
<p><img src="https://raw.githubusercontent.com/LongerVision/BSP/master/armbian/13_network_interfaces.jpg" alt="Network Interfaces"></p>
<p><strong>Finally</strong>, you are recommended to solve all the other issues about Ubuntu Desktop by <a href="http://www.google.com" target="_blank" rel="noopener">Google</a>.</p>

      
    </div>
    <footer class="article-footer">
      <a data-url="https://longervision.github.io/2018/01/11/orange-pi-plus-2-armbian/" data-id="cje6onrwf000jely7wk938ssq" class="article-share-link">Longer Vision</a>
      
      
  <ul class="article-tag-list"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/Orange-Pi-Plus-2-AllWinner-H3-Armbian-Ubuntu-Mainline-Linux-Kernel-BSP/">Orange Pi Plus 2, AllWinner H3, Armbian, Ubuntu, Mainline Linux Kernel, BSP</a></li></ul>

    </footer>
  </div>
  
</article>


  
    <article id="post-beaglebone-black-uboot-kernel" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="/2018/01/10/beaglebone-black-uboot-kernel/" class="article-date">
  <time datetime="2018-01-11T06:46:13.000Z" itemprop="datePublished">2018-01-10</time>
</a>
    
  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2018/01/10/beaglebone-black-uboot-kernel/">Build U-Boot and Linux Kernel for Beaglebone and Beaglebone Black</a>
    </h1>
  

      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <p>Happy new year everybody. How time flies. It is already 2018. <a href="http://www.longervision.com" target="_blank" rel="noopener">Longer Vision</a> has been struggling on this tough road towards a successful enterprise. Algorithms <strong>ONLY</strong> are <strong>NOT</strong> enough for nowadays business. <a href="https://en.wikipedia.org/wiki/Board_support_package" target="_blank" rel="noopener">BSP (board support package)</a> and <a href="https://en.wikipedia.org/wiki/Integrated_circuit_design" target="_blank" rel="noopener">IC design</a> are a must for a successful business nowadays. Thus, ever since 2018, <a href="http://www.longervision.com" target="_blank" rel="noopener">Longer Vision</a> is going to balance <strong>both</strong> hardware <strong>and</strong> software, particularly, <a href="http://www.arm.com/" target="_blank" rel="noopener">ARM</a> based open source embedded development board and computer vision algorithms.</p>
<p>In this blog, we are going to talk about how to build and flash <a href="http://www.denx.de/wiki/U-Boot/WebHome" target="_blank" rel="noopener">U-Boot</a> and <a href="https://www.kernel.org/" target="_blank" rel="noopener">Linux Kernel</a> onto a <a href="https://beagleboard.org/bone-original" target="_blank" rel="noopener">Beaglebone</a> and <a href="https://beagleboard.org/black" target="_blank" rel="noopener">Beaglebone Black</a>, which adopts <a href="http://www.ti.com/processors/sitara/arm-cortex-a8/am335x/overview.html" target="_blank" rel="noopener">TI AM335x</a> as its CPU. The board looks like (cited from <a href="https://beagleboard.org/black" target="_blank" rel="noopener">Beaglebone Black</a> ):</p>
<p><img src="https://raw.githubusercontent.com/LongerVision/BSP/master/ti/omap/beaglebone/black/images/BBB.jpg" alt="Beaglebone Black"></p>
<h1 id="PART-A-Cross-Compile-U-Boot-and-Linux-Kernel"><a href="#PART-A-Cross-Compile-U-Boot-and-Linux-Kernel" class="headerlink" title="PART A: Cross Compile U-Boot and Linux Kernel"></a>PART A: Cross Compile U-Boot and Linux Kernel</h1><h2 id="1-Linaro-GCC"><a href="#1-Linaro-GCC" class="headerlink" title="1. Linaro GCC"></a>1. Linaro GCC</h2><p><a href="https://www.linaro.org/" target="_blank" rel="noopener">Linaro</a> is a popular platform providing high-quality code for both <a href="https://www.kernel.org/" target="_blank" rel="noopener">Linux kernel</a> and <a href="https://developer.arm.com/open-source/gnu-toolchain/gnu-rm" target="_blank" rel="noopener">GCC tool chain</a>. Linaro’s GCC toolchain of varoius versions can be directly found <a href="https://releases.linaro.org/components/toolchain/binaries/" target="_blank" rel="noopener">here</a>. </p>
<p>Here, we download GCC latest-6 binary under <a href="https://releases.linaro.org/components/toolchain/binaries/latest-6/arm-linux-gnueabihf/" target="_blank" rel="noopener">arm-linux-gnueabihf</a>.</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">$ wget -c </span><br><span class="line">https://releases.linaro.org/components/toolchain/binaries/latest-6/arm-linux-gnueabihf/gcc-linaro-6.4.1-2017.11-x86_64_arm-linux-gnueabihf.tar.xz</span><br><span class="line">$ tar xf gcc-linaro-6.4.1-2017.11-x86_64_arm-linux-gnueabihf.tar.xz</span><br><span class="line">$ <span class="built_in">export</span> CC=`<span class="built_in">pwd</span>`/gcc-linaro-6.4.1-2017.11-x86_64_arm-linux-gnueabihf/bin/arm-linux-gnueabihf-</span><br></pre></td></tr></table></figure>
<p>Test the cross compiler:<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">$ <span class="variable">$&#123;CC&#125;</span>gcc --version</span><br><span class="line">arm-linux-gnueabihf-gcc (Linaro GCC 6.4-2017.11) 6.4.1 20171012</span><br><span class="line">Copyright (C) 2017 Free Software Foundation, Inc.</span><br><span class="line">This is free software; see the <span class="built_in">source</span> <span class="keyword">for</span> copying conditions.  There is NO</span><br><span class="line">warranty; not even <span class="keyword">for</span> MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.</span><br></pre></td></tr></table></figure></p>
<h2 id="2-U-Boot"><a href="#2-U-Boot" class="headerlink" title="2. U-Boot"></a>2. U-Boot</h2><p><a href="http://www.denx.de/wiki/U-Boot" target="_blank" rel="noopener">U-Boot</a> is a universal boot loader. For <a href="https://beagleboard.org/bone-original" target="_blank" rel="noopener">Beaglebone</a> and <a href="https://beagleboard.org/black" target="_blank" rel="noopener">Beaglebone Black</a>, there are two patches which has been maintained by <a href="http://eewiki.net/display/linuxonarm" target="_blank" rel="noopener">eewiki Linux on ARM</a> on <a href="https://github.com/eewiki/u-boot-patches" target="_blank" rel="noopener">github</a>.<br>We first download U-Boot and check out the latest release as follows:<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">$ git <span class="built_in">clone</span> https://github.com/u-boot/u-boot</span><br><span class="line">$ <span class="built_in">cd</span> u-boot/</span><br><span class="line">$ git checkout v2018.01</span><br></pre></td></tr></table></figure></p>
<p>Then check out the latest <a href="https://github.com/eewiki/u-boot-patches" target="_blank" rel="noopener">u-boot-patches</a> and patch two files under the latest release <a href="https://github.com/eewiki/u-boot-patches/tree/master/v2018.01" target="_blank" rel="noopener">v2018.01</a>:<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">$ <span class="built_in">cd</span> ../</span><br><span class="line">$ git <span class="built_in">clone</span> https://github.com/eewiki/u-boot-patches.git</span><br><span class="line">$ <span class="built_in">cd</span> ./u-boot-patches/v2018.01</span><br><span class="line">$ cp 0001-am335x_evm-uEnv.txt-bootz-n-fixes.patch ../../u-boot/</span><br><span class="line">$ cp 0002-U-Boot-BeagleBone-Cape-Manager.patch ../../u-boot/</span><br><span class="line">$ <span class="built_in">cd</span> ../../u-boot</span><br><span class="line">$ patch -p1 &lt; 0001-am335x_evm-uEnv.txt-bootz-n-fixes.patch</span><br><span class="line">$ patch -p1 &lt; 0002-U-Boot-BeagleBone-Cape-Manager.patch</span><br></pre></td></tr></table></figure></p>
<p>Finally, we configure and build U-Boot for <a href="https://beagleboard.org/bone-original" target="_blank" rel="noopener">Beaglebone</a> and <a href="https://beagleboard.org/black" target="_blank" rel="noopener">Beaglebone Black</a> as follows:<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">$ make ARCH=arm CROSS_COMPILE=<span class="variable">$&#123;CC&#125;</span> distclean</span><br><span class="line">$ make ARCH=arm CROSS_COMPILE=<span class="variable">$&#123;CC&#125;</span> am335x_evm_defconfig</span><br><span class="line">$ make ARCH=arm CROSS_COMPILE=<span class="variable">$&#123;CC&#125;</span></span><br></pre></td></tr></table></figure></p>
<h2 id="3-Linux-Kernel"><a href="#3-Linux-Kernel" class="headerlink" title="3. Linux Kernel"></a>3. Linux Kernel</h2><p>Due to Robert Nelson’s summary at <a href="http://eewiki.net/display/linuxonarm/BeagleBone+Black" target="_blank" rel="noopener">eewiki</a>, there are two ways to build <a href="https://beagleboard.org/bone-original" target="_blank" rel="noopener">Beaglebone</a> and <a href="https://beagleboard.org/black" target="_blank" rel="noopener">Beaglebone Black</a>:</p>
<ul>
<li><a href="https://github.com/RobertCNelson/bb-kernel" target="_blank" rel="noopener">Mainline</a></li>
<li><a href="https://github.com/RobertCNelson/ti-linux-kernel-dev" target="_blank" rel="noopener">TI BSP</a></li>
</ul>
<p>Their differences are:</p>
<ul>
<li>bb-kernel: based on <a href="https://github.com/RobertCNelson/bb-kernel" target="_blank" rel="noopener">mainline</a>, no-smp, optimized for AM335x devices.</li>
<li>ti-linux-kernel-dev: based on <a href="https://github.com/RobertCNelson/ti-linux-kernel-dev" target="_blank" rel="noopener">TI’s git tree</a>, smp, optimized for AM335x/AM43xx/AM57x devices.</li>
</ul>
<p>Here, we are going to use <a href="https://github.com/RobertCNelson/bb-kernel" target="_blank" rel="noopener">Mainline</a> to build our own Linux Kernel. We FIRST check out Robert Nelson’s <a href="https://github.com/RobertCNelson/bb-kernel" target="_blank" rel="noopener">bb-kernel</a>.</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">$ git <span class="built_in">clone</span> https://github.com/RobertCNelson/bb-kernel</span><br><span class="line">$ <span class="built_in">cd</span> bb-kernel/</span><br><span class="line">$ git checkout origin/am33x-v4.14 -b am33x-v4.14</span><br></pre></td></tr></table></figure>
<p>We then check out <a href="https://git.kernel.org/pub/scm/linux/kernel/git/stable/linux-stable.git" target="_blank" rel="noopener">Linus Torvalds’ stable Linux Kernel</a>, which can be also tracked on <a href="https://github.com/torvalds/linux" target="_blank" rel="noopener">github Torvalds Linux</a>. This will take you quite a while.<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ git <span class="built_in">clone</span> https://git.kernel.org/pub/scm/linux/kernel/git/stable/linux-stable.git</span><br></pre></td></tr></table></figure></p>
<p>Now, it’s the time to modify some of the configurations in .sh files under the checked out branch <strong>am33x-v4.14</strong>. </p>
<h3 id="1-version-sh"><a href="#1-version-sh" class="headerlink" title="1) version.sh"></a>1) version.sh</h3><p>Here, I’m using <strong>gcc_linaro_gnueabihf_6</strong> instead of <strong>gcc_linaro_gnueabihf_7</strong>.<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">toolchain=<span class="string">"gcc_linaro_gnueabihf_6"</span></span><br><span class="line"><span class="comment">#toolchain="gcc_linaro_gnueabihf_7"</span></span><br></pre></td></tr></table></figure></p>
<h3 id="2-system-sh"><a href="#2-system-sh" class="headerlink" title="2) system.sh"></a>2) system.sh</h3><p>A file named <strong>system.sh.sample</strong> has been provided for us to configure accordingly. We FIRST do a copy.<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ cp system.sh.sample system.sh</span><br></pre></td></tr></table></figure></p>
<p>Then, we manually re-specifying two MACROs <strong>CC</strong> and <strong>LINUX_GIT</strong>, respectively to two directories containing the above downloaded Linaro GCC compiler and the current Torvalds’ Linux Kernel. We also specify <strong>MMC</strong> for TF/SD Card as follows:<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">CC=.../gcc-linaro-6.4.1-2017.11-x86_64_arm-linux-gnueabihf/bin/arm-linux-gnueabihf-</span><br><span class="line">LINUX_GIT=.../linux-stable</span><br><span class="line">MMC=/dev/mmcblk0</span><br></pre></td></tr></table></figure></p>
<p>After the above configurations, we start building the Linux Kernel using the following command line. This will probably take you one hour.<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ ./build_kernel.sh</span><br></pre></td></tr></table></figure></p>
<p>When you see this <strong>Kernel Configuration</strong> page,<br><img src="https://raw.githubusercontent.com/LongerVision/BSP/master/ti/omap/beaglebone/black/images/kernelconfiguration.jpg" alt="Kernel Configuration"><br><strong>Exit</strong> right away without any modification. And you will see:<br><img src="https://raw.githubusercontent.com/LongerVision/BSP/master/ti/omap/beaglebone/black/images/afterkernelconfiguration.jpg" alt="After Kernel Configuration"><br>After a while, you will see <strong>Linux Kernel</strong> has been successfully built:<br><img src="https://raw.githubusercontent.com/LongerVision/BSP/master/ti/omap/beaglebone/black/images/kernelbuilt.jpg" alt="The Built Kernel"></p>
<h2 id="4-Root-File-System"><a href="#4-Root-File-System" class="headerlink" title="4. Root File System"></a>4. Root File System</h2><p>We then install the latest Debian (for now, Debian 9.3) according to Robert Nelson’s minimal operating system. Three commands are to be executed in a row for downloading, verifying, and extraction.<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">$ wget -c https://rcn-ee.com/rootfs/eewiki/minfs/debian-9.3-minimal-armhf-2017-12-09.tar.xz</span><br><span class="line">$ sha256sum debian-9.3-minimal-armhf-2017-12-09.tar.xz</span><br><span class="line">5120fcfb8ff8af013737fae52dc0a7ecc2f52563a9aa8f5aa288aff0f3943d61  debian-9.3-minimal-armhf-2017-12-09.tar.xz</span><br><span class="line">$ tar xf debian-9.3-minimal-armhf-2017-12-09.tar.xz</span><br></pre></td></tr></table></figure></p>
<p>Until now, most components for booting have been downloaded and built. It is the time for us to flash our own OS onto a SD card.</p>
<h1 id="PART-B-Install-the-Linux-OS-onto-SD-Card"><a href="#PART-B-Install-the-Linux-OS-onto-SD-Card" class="headerlink" title="PART B: Install the Linux OS onto SD Card"></a>PART B: Install the Linux OS onto SD Card</h1><h2 id="5-Setup-microSD-card"><a href="#5-Setup-microSD-card" class="headerlink" title="5. Setup microSD card"></a>5. Setup microSD card</h2><h3 id="1-TF-Card-Preparation"><a href="#1-TF-Card-Preparation" class="headerlink" title="1) TF Card Preparation"></a>1) TF Card Preparation</h3><p>We first check which block device that we are going to install our built system onto by command <strong>lsblk</strong>.<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">$ lsblk</span><br><span class="line">NAME    MAJ:MIN RM   SIZE RO TYPE MOUNTPOINT</span><br><span class="line">sdd       8:48   0 931.5G  0 disk </span><br><span class="line">└─sdd1    8:49   0 931.5G  0 part /media/jiapei/Data</span><br><span class="line">sdb       8:16   0 238.5G  0 disk </span><br><span class="line">├─sdb4    8:20   0   900M  0 part </span><br><span class="line">├─sdb2    8:18   0   128M  0 part </span><br><span class="line">├─sdb3    8:19   0 237.2G  0 part /media/jiapei/Win10</span><br><span class="line">└─sdb1    8:17   0   300M  0 part /boot/efi</span><br><span class="line">sr0      11:0    1  1024M  0 rom  </span><br><span class="line">sdc       8:32   0 238.5G  0 disk </span><br><span class="line">├─sdc2    8:34   0  30.5G  0 part [SWAP]</span><br><span class="line">├─sdc3    8:35   0 207.5G  0 part /</span><br><span class="line">└─sdc1    8:33   0   512M  0 part </span><br><span class="line">mmcblk0 179:0    0    15G  0 disk</span><br></pre></td></tr></table></figure></p>
<p>We then define a MACRO <strong>DISK</strong> to specify the TF card device.<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ <span class="built_in">export</span> DISK=/dev/mmcblk0</span><br></pre></td></tr></table></figure></p>
<p>Afterwards, erase partition table/labels on TF card by:<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ sudo dd <span class="keyword">if</span>=/dev/zero of=<span class="variable">$&#123;DISK&#125;</span> bs=1M count=10</span><br></pre></td></tr></table></figure></p>
<h3 id="2-Bootloader-installation"><a href="#2-Bootloader-installation" class="headerlink" title="2) Bootloader installation"></a>2) Bootloader installation</h3><p>Now, we install the built U-Boot onto the SD card:<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">$ sudo dd <span class="keyword">if</span>=./u-boot/MLO of=<span class="variable">$&#123;DISK&#125;</span> count=1 seek=1 bs=128k</span><br><span class="line">$ sudo dd <span class="keyword">if</span>=./u-boot/u-boot.img of=<span class="variable">$&#123;DISK&#125;</span> count=2 seek=1 bs=384k</span><br></pre></td></tr></table></figure></p>
<h3 id="3-Partition-Preparation"><a href="#3-Partition-Preparation" class="headerlink" title="3) Partition Preparation"></a>3) Partition Preparation</h3><p>We FIRST make sure which version of <strong>sfdisk</strong> is. In my case, it is of version 2.27.1<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">$ sudo sfdisk --version</span><br><span class="line">sfdisk from util-linux 2.27.1</span><br></pre></td></tr></table></figure></p>
<p>Then we create the partition layout by:<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">$ sudo sfdisk <span class="variable">$&#123;DISK&#125;</span> &lt;&lt;-__EOF__</span><br><span class="line">4M,,L,*</span><br><span class="line">__EOF__</span><br></pre></td></tr></table></figure></p>
<p>Afterwards, we need to format the created partition by <strong>mkfs.ext4</strong>. We also need to make sure which version of <strong>mkfs.ext4</strong> is. In my case, it is of version 1.42.13.<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">$ mkfs.ext4 -V</span><br><span class="line">mke2fs 1.42.13 (17-May-2015)</span><br><span class="line">        Using EXT2FS Library version 1.42.13</span><br></pre></td></tr></table></figure></p>
<p>Then, we format the partition by:<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ sudo mkfs.ext4 -L rootfs <span class="variable">$&#123;DISK&#125;</span>p1</span><br></pre></td></tr></table></figure></p>
<p>After formatting, the TF card should be able to be either automatically mounted or manually mounted by the following command:<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">$ sudo mkdir -p /media/rootfs/</span><br><span class="line">$ sudo mount <span class="variable">$&#123;DISK&#125;</span>p1 /media/rootfs/</span><br></pre></td></tr></table></figure></p>
<h3 id="4-Backup-Bootloader"><a href="#4-Backup-Bootloader" class="headerlink" title="4) Backup Bootloader"></a>4) Backup Bootloader</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">$ sudo mkdir -p /media/rootfs/opt/backup/uboot/</span><br><span class="line">$ sudo cp -v ./u-boot/MLO /media/rootfs/opt/backup/uboot/</span><br><span class="line">$ sudo cp -v ./u-boot/u-boot.img /media/rootfs/opt/backup/uboot/</span><br></pre></td></tr></table></figure>
<h3 id="5-Dealing-with-old-Bootloader-in-eMMC-Optional"><a href="#5-Dealing-with-old-Bootloader-in-eMMC-Optional" class="headerlink" title="5) Dealing with old Bootloader in eMMC (Optional)"></a>5) Dealing with old Bootloader in eMMC (Optional)</h3><p>If the old bootloader in eMMC is to be kept, please copy the following file <strong>uEnv.txt</strong> to <strong>/media/rootfs/</strong>.</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">##This will work with: Angstrom's 2013.06.20 u-boot.</span></span><br><span class="line"> </span><br><span class="line">loadaddr=0x82000000</span><br><span class="line">fdtaddr=0x88000000</span><br><span class="line">rdaddr=0x88080000</span><br><span class="line"> </span><br><span class="line">initrd_high=0xffffffff</span><br><span class="line">fdt_high=0xffffffff</span><br><span class="line"> </span><br><span class="line"><span class="comment">#for single partitions:</span></span><br><span class="line">mmcroot=/dev/mmcblk0p1</span><br><span class="line"> </span><br><span class="line">loadximage=load mmc 0:1 <span class="variable">$&#123;loadaddr&#125;</span> /boot/vmlinuz-<span class="variable">$&#123;uname_r&#125;</span></span><br><span class="line">loadxfdt=load mmc 0:1 <span class="variable">$&#123;fdtaddr&#125;</span> /boot/dtbs/<span class="variable">$&#123;uname_r&#125;</span>/<span class="variable">$&#123;fdtfile&#125;</span></span><br><span class="line">loadxrd=load mmc 0:1 <span class="variable">$&#123;rdaddr&#125;</span> /boot/initrd.img-<span class="variable">$&#123;uname_r&#125;</span>; setenv rdsize <span class="variable">$&#123;filesize&#125;</span></span><br><span class="line">loaduEnvtxt=load mmc 0:1 <span class="variable">$&#123;loadaddr&#125;</span> /boot/uEnv.txt ; env import -t <span class="variable">$&#123;loadaddr&#125;</span> <span class="variable">$&#123;filesize&#125;</span>;</span><br><span class="line">loadall=run loaduEnvtxt; run loadximage; run loadxfdt;</span><br><span class="line"> </span><br><span class="line">mmcargs=setenv bootargs console=tty0 console=<span class="variable">$&#123;console&#125;</span> <span class="variable">$&#123;optargs&#125;</span> <span class="variable">$&#123;cape_disable&#125;</span> <span class="variable">$&#123;cape_enable&#125;</span> root=<span class="variable">$&#123;mmcroot&#125;</span> rootfstype=<span class="variable">$&#123;mmcrootfstype&#125;</span> <span class="variable">$&#123;cmdline&#125;</span></span><br><span class="line"> </span><br><span class="line">uenvcmd=run loadall; run mmcargs; bootz <span class="variable">$&#123;loadaddr&#125;</span> - <span class="variable">$&#123;fdtaddr&#125;</span>;</span><br></pre></td></tr></table></figure>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ sudo cp -v ./uEnv.txt /media/rootfs/</span><br></pre></td></tr></table></figure>
<h2 id="6-Kernel-Installation"><a href="#6-Kernel-Installation" class="headerlink" title="6. Kernel Installation"></a>6. Kernel Installation</h2><h3 id="1-Export-MACRO-kernel-version"><a href="#1-Export-MACRO-kernel-version" class="headerlink" title="1) Export MACRO kernel_version"></a>1) Export MACRO <strong>kernel_version</strong></h3><p>Under the folder <strong>bb-kernel</strong>, a file named <strong>kernel_version</strong> was generated while building <a href="https://www.kernel.org/" target="_blank" rel="noopener">Linux kernel</a>. In my case, I was building the NEWEST kernel <strong>4.14.13-bone12</strong>. For convenience, we export a new MACRO <strong>kernel_version</strong>.<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">$ cat kernel_version </span><br><span class="line">4.14.13-bone12</span><br><span class="line">$ <span class="built_in">export</span> kernel_version=4.14.13-bone12</span><br></pre></td></tr></table></figure></p>
<h3 id="2-Extract-Debian-Root-File-System-onto-TF-Card"><a href="#2-Extract-Debian-Root-File-System-onto-TF-Card" class="headerlink" title="2) Extract Debian Root File System onto TF Card"></a>2) Extract Debian Root File System onto TF Card</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">$ sudo tar xfvp ./debian-9.3-minimal-armhf-2017-12-09/armhf-rootfs-debian-stretch.tar -C /media/rootfs/</span><br><span class="line">$ sync</span><br><span class="line">$ sudo chown root:root /media/rootfs/</span><br><span class="line">$ sudo chmod 755 /media/rootfs/</span><br></pre></td></tr></table></figure>
<h3 id="3-Set-uname-r-in-boot-uEnv-txt"><a href="#3-Set-uname-r-in-boot-uEnv-txt" class="headerlink" title="3) Set uname_r in /boot/uEnv.txt"></a>3) Set uname_r in /boot/uEnv.txt</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ sudo sh -c <span class="string">"echo 'uname_r=<span class="variable">$&#123;kernel_version&#125;</span>' &gt;&gt; /media/rootfs/boot/uEnv.txt"</span></span><br></pre></td></tr></table></figure>
<h3 id="4-Copy-Kernel-Image"><a href="#4-Copy-Kernel-Image" class="headerlink" title="4) Copy Kernel Image"></a>4) Copy Kernel Image</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ sudo cp -v ./bb-kernel/deploy/<span class="variable">$&#123;kernel_version&#125;</span>.zImage /media/rootfs/boot/vmlinuz-<span class="variable">$&#123;kernel_version&#125;</span></span><br></pre></td></tr></table></figure>
<h3 id="5-Copy-Kernel-Device-Tree-Binaries"><a href="#5-Copy-Kernel-Device-Tree-Binaries" class="headerlink" title="5) Copy Kernel Device Tree Binaries"></a>5) Copy Kernel Device Tree Binaries</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">$ sudo mkdir -p /media/rootfs/boot/dtbs/<span class="variable">$&#123;kernel_version&#125;</span>/</span><br><span class="line">$ sudo tar xfv ./bb-kernel/deploy/<span class="variable">$&#123;kernel_version&#125;</span>-dtbs.tar.gz -C /media/rootfs/boot/dtbs/<span class="variable">$&#123;kernel_version&#125;</span>/</span><br></pre></td></tr></table></figure>
<h3 id="6-Copy-Kernel-Modules"><a href="#6-Copy-Kernel-Modules" class="headerlink" title="6) Copy Kernel Modules"></a>6) Copy Kernel Modules</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ sudo tar xfv ./bb-kernel/deploy/<span class="variable">$&#123;kernel_version&#125;</span>-modules.tar.gz -C /media/rootfs/</span><br></pre></td></tr></table></figure>
<h3 id="7-Set-File-Systems-Table-etc-fstab"><a href="#7-Set-File-Systems-Table-etc-fstab" class="headerlink" title="7) Set File Systems Table (/etc/fstab)"></a>7) Set File Systems Table (/etc/fstab)</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ sudo sh -c <span class="string">"echo '/dev/mmcblk0p1  /  auto  errors=remount-ro  0  1' &gt;&gt; /media/rootfs/etc/fstab"</span></span><br></pre></td></tr></table></figure>
<h3 id="8-Networking"><a href="#8-Networking" class="headerlink" title="8) Networking"></a>8) Networking</h3><p>To enable the Internet for the FIRST booting, we need to do the network configuration:<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ sudo nano /media/rootfs/etc/network/interfaces</span><br></pre></td></tr></table></figure></p>
<p>Add the following content:<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">auto lo</span><br><span class="line">iface lo inet loopback</span><br><span class="line"> </span><br><span class="line">auto eth0</span><br><span class="line">iface eth0 inet dhcp</span><br></pre></td></tr></table></figure></p>
<p>In order to use a shared SD card with multiple BeagleBones, and always enable the Ethernet interface as <strong>eth0</strong>, we need to add a particular <strong>udev rule</strong> as:<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ sudo nano /media/rootfs/etc/udev/rules.d/70-persistent-net.rules</span><br></pre></td></tr></table></figure></p>
<p>Add the following content:<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># BeagleBone: net device ()</span></span><br><span class="line">SUBSYSTEM==<span class="string">"net"</span>, ACTION==<span class="string">"add"</span>, DRIVERS==<span class="string">"?*"</span>, ATTR&#123;dev_id&#125;==<span class="string">"0x0"</span>, ATTR&#123;<span class="built_in">type</span>&#125;==<span class="string">"1"</span>, KERNEL==<span class="string">"eth*"</span>, NAME=<span class="string">"eth0"</span></span><br></pre></td></tr></table></figure></p>
<h3 id="9-Remove-TF-Card"><a href="#9-Remove-TF-Card" class="headerlink" title="9) Remove TF Card"></a>9) Remove TF Card</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">$ sync</span><br><span class="line">$ sudo umount /media/rootfs</span><br></pre></td></tr></table></figure>
<h1 id="PART-C-Configurations-after-Booting-from-the-SD-Card"><a href="#PART-C-Configurations-after-Booting-from-the-SD-Card" class="headerlink" title="PART C: Configurations after Booting from the SD Card"></a>PART C: Configurations after Booting from the SD Card</h1><p>Insert TF card into a <a href="https://beagleboard.org/black" target="_blank" rel="noopener">Beaglebone Black</a>, connect BBB with an Internet cable, and connect a Micro HDMI cable on demand. After the flashing of on-board LEDs, you should be able to find the IP address of BBB via your router. All our future jobs are to be done via <strong>ssh</strong> command through this IP address. My personal preference is to set a static IP address for this particularly BBB in the router settings.</p>

      
    </div>
    <footer class="article-footer">
      <a data-url="https://longervision.github.io/2018/01/10/beaglebone-black-uboot-kernel/" data-id="cje6onrvt0000ely7do7vj01b" class="article-share-link">Longer Vision</a>
      
      
  <ul class="article-tag-list"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/Beaglebone-Beaglebone-Black-Linaro-GCC-U-Boot-Linux-Kernel-BSP/">Beaglebone, Beaglebone Black, Linaro GCC, U-Boot, Linux Kernel, BSP</a></li></ul>

    </footer>
  </div>
  
</article>


  
    <article id="post-opencv-internal-calibration-circle-grid" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="/2017/03/20/opencv-internal-calibration-circle-grid/" class="article-date">
  <time datetime="2017-03-20T18:11:11.000Z" itemprop="datePublished">2017-03-20</time>
</a>
    
  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2017/03/20/opencv-internal-calibration-circle-grid/">Camera Calibration Using a Circle Grid</a>
    </h1>
  

      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <h2 id="Preparation"><a href="#Preparation" class="headerlink" title="Preparation"></a>Preparation</h2><p>By reading two of our previous blogs <a href="https://longervision.github.io/2017/03/19/opencv-internal-calibration-chessboard/">Camera Calibration Using a Chessboard</a> and <a href="https://longervision.github.io/2017/03/13/opencv-external-posture-estimation-circle-grid/">Camera Posture Estimation Using Circle Grid Pattern</a>, it wouldn’t be hard to replace the chessboard by a circle grid to calculate camera calibration parameters.</p>
<h2 id="Coding"><a href="#Coding" class="headerlink" title="Coding"></a>Coding</h2><p>Our code can be found at <a href="https://github.com/LongerVision/OpenCV_Examples/blob/master/01_internal_camera_calibration/circle_grid.py" target="_blank" rel="noopener">OpenCV Examples</a>.</p>
<h3 id="First-of-all"><a href="#First-of-all" class="headerlink" title="First of all"></a>First of all</h3><p>As mentioned in <a href="https://longervision.github.io/2017/03/19/opencv-internal-calibration-chessboard/">Camera Calibration Using a Chessboard</a>, for intrinsic parameters estimation, namely, camera calibration, there is <strong>NO</strong> need to measure the circle unit size. And the circle gird is to be adopted is exactly the same one as used in <a href="https://longervision.github.io/2017/03/13/opencv-external-posture-estimation-circle-grid/">Camera Posture Estimation Using Circle Grid Pattern</a>:<br><img src="https://raw.githubusercontent.com/LongerVision/OpenCV_Examples/master/markers/pattern_acircles.png" alt="asymmetric_circle_grid" title="asymmetric_circle_grid"></p>
<h3 id="Secondly"><a href="#Secondly" class="headerlink" title="Secondly"></a>Secondly</h3><p>Required packages need to be imported.  </p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">import numpy as np</span><br><span class="line">import cv2</span><br><span class="line">import yaml</span><br></pre></td></tr></table></figure>
<h3 id="Thirdly"><a href="#Thirdly" class="headerlink" title="Thirdly"></a>Thirdly</h3><p>Some initialization work need to be done, including: 1) define the termination criteria when refine the corner sub-pixel later on; 2) blob detection parameters; 3) object points coordinators initialization.<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br></pre></td><td class="code"><pre><span class="line"># termination criteria</span><br><span class="line">criteria = (cv2.TERM_CRITERIA_EPS + cv2.TERM_CRITERIA_MAX_ITER, 30, 0.001)</span><br><span class="line"></span><br><span class="line">########################################Blob Detector##############################################</span><br><span class="line"></span><br><span class="line"># Setup SimpleBlobDetector parameters.</span><br><span class="line">blobParams = cv2.SimpleBlobDetector_Params()</span><br><span class="line"></span><br><span class="line"># Change thresholds</span><br><span class="line">blobParams.minThreshold = 8</span><br><span class="line">blobParams.maxThreshold = 255</span><br><span class="line"></span><br><span class="line"># Filter by Area.</span><br><span class="line">blobParams.filterByArea = True</span><br><span class="line">blobParams.minArea = 64     # minArea may be adjusted to suit for your experiment</span><br><span class="line">blobParams.maxArea = 2500   # maxArea may be adjusted to suit for your experiment</span><br><span class="line"></span><br><span class="line"># Filter by Circularity</span><br><span class="line">blobParams.filterByCircularity = True</span><br><span class="line">blobParams.minCircularity = 0.1</span><br><span class="line"></span><br><span class="line"># Filter by Convexity</span><br><span class="line">blobParams.filterByConvexity = True</span><br><span class="line">blobParams.minConvexity = 0.87</span><br><span class="line"></span><br><span class="line"># Filter by Inertia</span><br><span class="line">blobParams.filterByInertia = True</span><br><span class="line">blobParams.minInertiaRatio = 0.01</span><br><span class="line"></span><br><span class="line"># Create a detector with the parameters</span><br><span class="line">blobDetector = cv2.SimpleBlobDetector_create(blobParams)</span><br><span class="line"></span><br><span class="line">###################################################################################################</span><br><span class="line"></span><br><span class="line">###################################################################################################</span><br><span class="line"></span><br><span class="line"># Original blob coordinates, supposing all blobs are of z-coordinates 0</span><br><span class="line"># And, the distance between every two neighbour blob circle centers is 72 centimetres</span><br><span class="line"># In fact, any number can be used to replace 72.</span><br><span class="line"># Namely, the real size of the circle is pointless while calculating camera calibration parameters.</span><br><span class="line">objp = np.zeros((44, 3), np.float32)</span><br><span class="line">objp[0]  = (0  , 0  , 0)</span><br><span class="line">objp[1]  = (0  , 72 , 0)</span><br><span class="line">objp[2]  = (0  , 144, 0)</span><br><span class="line">objp[3]  = (0  , 216, 0)</span><br><span class="line">objp[4]  = (36 , 36 , 0)</span><br><span class="line">objp[5]  = (36 , 108, 0)</span><br><span class="line">objp[6]  = (36 , 180, 0)</span><br><span class="line">objp[7]  = (36 , 252, 0)</span><br><span class="line">objp[8]  = (72 , 0  , 0)</span><br><span class="line">objp[9]  = (72 , 72 , 0)</span><br><span class="line">objp[10] = (72 , 144, 0)</span><br><span class="line">objp[11] = (72 , 216, 0)</span><br><span class="line">objp[12] = (108, 36,  0)</span><br><span class="line">objp[13] = (108, 108, 0)</span><br><span class="line">objp[14] = (108, 180, 0)</span><br><span class="line">objp[15] = (108, 252, 0)</span><br><span class="line">objp[16] = (144, 0  , 0)</span><br><span class="line">objp[17] = (144, 72 , 0)</span><br><span class="line">objp[18] = (144, 144, 0)</span><br><span class="line">objp[19] = (144, 216, 0)</span><br><span class="line">objp[20] = (180, 36 , 0)</span><br><span class="line">objp[21] = (180, 108, 0)</span><br><span class="line">objp[22] = (180, 180, 0)</span><br><span class="line">objp[23] = (180, 252, 0)</span><br><span class="line">objp[24] = (216, 0  , 0)</span><br><span class="line">objp[25] = (216, 72 , 0)</span><br><span class="line">objp[26] = (216, 144, 0)</span><br><span class="line">objp[27] = (216, 216, 0)</span><br><span class="line">objp[28] = (252, 36 , 0)</span><br><span class="line">objp[29] = (252, 108, 0)</span><br><span class="line">objp[30] = (252, 180, 0)</span><br><span class="line">objp[31] = (252, 252, 0)</span><br><span class="line">objp[32] = (288, 0  , 0)</span><br><span class="line">objp[33] = (288, 72 , 0)</span><br><span class="line">objp[34] = (288, 144, 0)</span><br><span class="line">objp[35] = (288, 216, 0)</span><br><span class="line">objp[36] = (324, 36 , 0)</span><br><span class="line">objp[37] = (324, 108, 0)</span><br><span class="line">objp[38] = (324, 180, 0)</span><br><span class="line">objp[39] = (324, 252, 0)</span><br><span class="line">objp[40] = (360, 0  , 0)</span><br><span class="line">objp[41] = (360, 72 , 0)</span><br><span class="line">objp[42] = (360, 144, 0)</span><br><span class="line">objp[43] = (360, 216, 0)</span><br><span class="line">###################################################################################################</span><br><span class="line"></span><br><span class="line"># Arrays to store object points and image points from all the images.</span><br><span class="line">objpoints = [] # 3d point in real world space</span><br><span class="line">imgpoints = [] # 2d points in image plane.</span><br></pre></td></tr></table></figure></p>
<h3 id="Fourthly"><a href="#Fourthly" class="headerlink" title="Fourthly"></a>Fourthly</h3><p>After localizing 10 frames (<strong>10</strong> can be changed to any positive integer as you wish) of a grid of 2D circles, camera matrix and distortion coefficients can be calculated by invoking the function <strong>calibrateCamera</strong>. Here, we are testing on a real-time camera stream. Similar to <a href="https://longervision.github.io/2017/03/13/opencv-external-posture-estimation-circle-grid/">Camera Posture Estimation Using Circle Grid Pattern</a>, the trick is to do <strong>blobDetector.detect()</strong> and draw the detected blobs using <strong>cv2.drawKeypoints()</strong> before invoking <strong>cv2.findCirclesGrid()</strong>, so that the entire grid is easier to be found.  </p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><span class="line">cap = cv2.VideoCapture(0)</span><br><span class="line">found = 0</span><br><span class="line">while(found &lt; 10):  # Here, 10 can be changed to whatever number you like to choose</span><br><span class="line">    ret, img = cap.read() # Capture frame-by-frame</span><br><span class="line">    gray = cv2.cvtColor(img, cv2.COLOR_BGR2GRAY)</span><br><span class="line"></span><br><span class="line">    keypoints = blobDetector.detect(gray) # Detect blobs.</span><br><span class="line"></span><br><span class="line">    # Draw detected blobs as red circles. This helps cv2.findCirclesGrid() .</span><br><span class="line">    im_with_keypoints = cv2.drawKeypoints(img, keypoints, np.array([]), (0,255,0), cv2.DRAW_MATCHES_FLAGS_DRAW_RICH_KEYPOINTS)</span><br><span class="line">    im_with_keypoints_gray = cv2.cvtColor(im_with_keypoints, cv2.COLOR_BGR2GRAY)</span><br><span class="line">    ret, corners = cv2.findCirclesGrid(im_with_keypoints, (4,11), None, flags = cv2.CALIB_CB_ASYMMETRIC_GRID)   # Find the circle grid</span><br><span class="line"></span><br><span class="line">    if ret == True:</span><br><span class="line">        objpoints.append(objp)  # Certainly, every loop objp is the same, in 3D.</span><br><span class="line"></span><br><span class="line">        corners2 = cv2.cornerSubPix(im_with_keypoints_gray, corners, (11,11), (-1,-1), criteria)    # Refines the corner locations.</span><br><span class="line">        imgpoints.append(corners2)</span><br><span class="line"></span><br><span class="line">        # Draw and display the corners.</span><br><span class="line">        im_with_keypoints = cv2.drawChessboardCorners(img, (4,11), corners2, ret)</span><br><span class="line">        found += 1</span><br><span class="line"></span><br><span class="line">    cv2.imshow(&quot;img&quot;, im_with_keypoints) # display</span><br><span class="line">    cv2.waitKey(2)</span><br><span class="line"></span><br><span class="line"># When everything done, release the capture</span><br><span class="line">cap.release()</span><br><span class="line">cv2.destroyAllWindows()</span><br><span class="line"></span><br><span class="line">ret, mtx, dist, rvecs, tvecs = cv2.calibrateCamera(objpoints, imgpoints, gray.shape[::-1], None, None)</span><br></pre></td></tr></table></figure>
<h3 id="Finally"><a href="#Finally" class="headerlink" title="Finally"></a>Finally</h3><p>Write the calculated calibration parameters into a yaml file. Here, it is a bit tricky. Please bear in mind that you <strong>MUST</strong> call function <strong>tolist()</strong> to transform a numpy array to a list.  </p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"># It&apos;s very important to transform the matrix to list.</span><br><span class="line">data = &#123;&apos;camera_matrix&apos;: np.asarray(mtx).tolist(), &apos;dist_coeff&apos;: np.asarray(dist).tolist()&#125;</span><br><span class="line">with open(&quot;calibration.yaml&quot;, &quot;w&quot;) as f:</span><br><span class="line">    yaml.dump(data, f)</span><br></pre></td></tr></table></figure>
<h3 id="Additionally"><a href="#Additionally" class="headerlink" title="Additionally"></a>Additionally</h3><p>You may use the following piece of code to load the calibration parameters from file “calibration.yaml”.  </p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">with open(&apos;calibration.yaml&apos;) as f:</span><br><span class="line">    loadeddict = yaml.load(f)</span><br><span class="line">mtxloaded = loadeddict.get(&apos;camera_matrix&apos;)</span><br><span class="line">distloaded = loadeddict.get(&apos;dist_coeff&apos;)</span><br></pre></td></tr></table></figure>

      
    </div>
    <footer class="article-footer">
      <a data-url="https://longervision.github.io/2017/03/20/opencv-internal-calibration-circle-grid/" data-id="cje6onrwa000fely7f49ynlew" class="article-share-link">Longer Vision</a>
      
      
  <ul class="article-tag-list"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/Camera-Calibration-Circle-Grid-Marker-Pattern-OpenCV-Python/">Camera Calibration, Circle Grid, Marker, Pattern, OpenCV, Python</a></li></ul>

    </footer>
  </div>
  
</article>


  
    <article id="post-opencv-internal-calibration-chessboard" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="/2017/03/19/opencv-internal-calibration-chessboard/" class="article-date">
  <time datetime="2017-03-19T18:11:11.000Z" itemprop="datePublished">2017-03-19</time>
</a>
    
  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2017/03/19/opencv-internal-calibration-chessboard/">Camera Calibration Using a Chessboard</a>
    </h1>
  

      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <h2 id="Preparation"><a href="#Preparation" class="headerlink" title="Preparation"></a>Preparation</h2><p>Traditionally, a camera is calibrated using a chessboard. Existing documentations are already out there and have discussed camera calibration in detail, for example, <a href="http://opencv-python-tutroals.readthedocs.io/en/latest/py_tutorials/py_calib3d/py_calibration/py_calibration.html" target="_blank" rel="noopener">OpenCV-Python Tutorials</a>.</p>
<h2 id="Coding"><a href="#Coding" class="headerlink" title="Coding"></a>Coding</h2><p>Our code can be found at <a href="https://github.com/LongerVision/OpenCV_Examples/blob/master/01_internal_camera_calibration/chessboard.py" target="_blank" rel="noopener">OpenCV Examples</a>.</p>
<h3 id="First-of-all"><a href="#First-of-all" class="headerlink" title="First of all"></a>First of all</h3><p>Unlike estimating camera postures which is dealing with the extrinsic parameters, camera calibration is to calculate the intrinsic parameters. In such a case, there is <strong>NO</strong> need for us to measure the cell size of the chessboard. Anyway, the adopted chessboard is just an ordinary chessboard as:<br><img src="https://raw.githubusercontent.com/LongerVision/OpenCV_Examples/master/markers/pattern_chessboard.png" alt="pattern_chessboard" title="pattern_chessboard"></p>
<h3 id="Secondly"><a href="#Secondly" class="headerlink" title="Secondly"></a>Secondly</h3><p>Required packages need to be imported.  </p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">import numpy as np</span><br><span class="line">import cv2</span><br><span class="line">import yaml</span><br></pre></td></tr></table></figure>
<h3 id="Thirdly"><a href="#Thirdly" class="headerlink" title="Thirdly"></a>Thirdly</h3><p>Some initialization work need to be done, including: 1) define the termination criteria when refine the corner sub-pixel later on; 2) object points coordinators initialization.  </p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"># termination criteria</span><br><span class="line">criteria = (cv2.TERM_CRITERIA_EPS + cv2.TERM_CRITERIA_MAX_ITER, 30, 0.001)</span><br><span class="line"></span><br><span class="line"># prepare object points, like (0,0,0), (1,0,0), (2,0,0) ....,(6,5,0)</span><br><span class="line">objp = np.zeros((6*7,3), np.float32)</span><br><span class="line">objp[:,:2] = np.mgrid[0:7,0:6].T.reshape(-1,2)</span><br><span class="line"></span><br><span class="line"># Arrays to store object points and image points from all the images.</span><br><span class="line">objpoints = [] # 3d point in real world space</span><br><span class="line">imgpoints = [] # 2d points in image plane.</span><br></pre></td></tr></table></figure>
<h3 id="Fourthly"><a href="#Fourthly" class="headerlink" title="Fourthly"></a>Fourthly</h3><p>After localizing 10 frames (<strong>10</strong> can be changed to any positive integer as you wish) of a grid of 2D chessboard cell corners, camera matrix and distortion coefficients can be calculated by invoking the function <strong>calibrateCamera</strong>. Here, we are testing on a real-time camera stream.  </p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line">cap = cv2.VideoCapture(0)</span><br><span class="line">found = 0</span><br><span class="line">while(found &lt; 10):  # Here, 10 can be changed to whatever number you like to choose</span><br><span class="line">    ret, img = cap.read() # Capture frame-by-frame</span><br><span class="line">    gray = cv2.cvtColor(img, cv2.COLOR_BGR2GRAY)</span><br><span class="line"></span><br><span class="line">    # Find the chess board corners</span><br><span class="line">    ret, corners = cv2.findChessboardCorners(gray, (7,6),None)</span><br><span class="line"></span><br><span class="line">    # If found, add object points, image points (after refining them)</span><br><span class="line">    if ret == True:</span><br><span class="line">        objpoints.append(objp)   # Certainly, every loop objp is the same, in 3D.</span><br><span class="line">        corners2 = cv2.cornerSubPix(gray,corners,(11,11),(-1,-1),criteria)</span><br><span class="line">        imgpoints.append(corners2)</span><br><span class="line"></span><br><span class="line">        # Draw and display the corners</span><br><span class="line">        img = cv2.drawChessboardCorners(img, (7,6), corners2, ret)</span><br><span class="line">        found += 1</span><br><span class="line"></span><br><span class="line">    cv2.imshow(&apos;img&apos;, img)</span><br><span class="line">    cv2.waitKey(10)</span><br><span class="line"></span><br><span class="line"># When everything done, release the capture</span><br><span class="line">cap.release()</span><br><span class="line">cv2.destroyAllWindows()</span><br><span class="line"></span><br><span class="line">ret, mtx, dist, rvecs, tvecs = cv2.calibrateCamera(objpoints, imgpoints, gray.shape[::-1], None, None)</span><br></pre></td></tr></table></figure>
<h3 id="Finally"><a href="#Finally" class="headerlink" title="Finally"></a>Finally</h3><p>Write the calculated calibration parameters into a yaml file. Here, it is a bit tricky. Please bear in mind that you <strong>MUST</strong> call function <strong>tolist()</strong> to transform a numpy array to a list.  </p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"># It&apos;s very important to transform the matrix to list.</span><br><span class="line"></span><br><span class="line">data = &#123;&apos;camera_matrix&apos;: np.asarray(mtx).tolist(), &apos;dist_coeff&apos;: np.asarray(dist).tolist()&#125;</span><br><span class="line"></span><br><span class="line">with open(&quot;calibration.yaml&quot;, &quot;w&quot;) as f:</span><br><span class="line">    yaml.dump(data, f)</span><br></pre></td></tr></table></figure>
<h3 id="Additionally"><a href="#Additionally" class="headerlink" title="Additionally"></a>Additionally</h3><p>You may use the following piece of code to load the calibration parameters from file “calibration.yaml”.  </p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">with open(&apos;calibration.yaml&apos;) as f:</span><br><span class="line">    loadeddict = yaml.load(f)</span><br><span class="line"></span><br><span class="line">mtxloaded = loadeddict.get(&apos;camera_matrix&apos;)</span><br><span class="line">distloaded = loadeddict.get(&apos;dist_coeff&apos;)</span><br></pre></td></tr></table></figure>

      
    </div>
    <footer class="article-footer">
      <a data-url="https://longervision.github.io/2017/03/19/opencv-internal-calibration-chessboard/" data-id="cje6onrw9000dely7jsy7pqv3" class="article-share-link">Longer Vision</a>
      
      
  <ul class="article-tag-list"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/Camera-Calibration-Chessboard-Marker-Pattern-OpenCV-Python/">Camera Calibration, Chessboard, Marker, Pattern, OpenCV, Python</a></li></ul>

    </footer>
  </div>
  
</article>


  
    <article id="post-opencv-python-aruco" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="/2017/03/13/opencv-python-aruco/" class="article-date">
  <time datetime="2017-03-14T05:22:22.000Z" itemprop="datePublished">2017-03-13</time>
</a>
    
  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2017/03/13/opencv-python-aruco/">OpenCV Python ArUco Documentation</a>
    </h1>
  

      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <p>Open a bash terminal, and type in the following commands:<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">$ python</span><br><span class="line">Python 3.5.2 (default, Nov 17 2016, 17:05:23)</span><br><span class="line">[GCC 5.4.0 20160609] on linux</span><br><span class="line">Type &quot;help&quot;, &quot;copyright&quot;, &quot;credits&quot; or &quot;license&quot; for more information.</span><br><span class="line">&gt;&gt;&gt; import cv2</span><br><span class="line">&gt;&gt;&gt; help (cv2.aruco)</span><br></pre></td></tr></table></figure></p>
<p>Then, you will be able to see all the doc contents for <strong>cv2.aruco</strong>:<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br></pre></td><td class="code"><pre><span class="line">Help on module cv2.aruco in cv2:</span><br><span class="line"></span><br><span class="line">NAME</span><br><span class="line">    cv2.aruco</span><br><span class="line"></span><br><span class="line">FUNCTIONS</span><br><span class="line">    Board_create(...)</span><br><span class="line"></span><br><span class="line">        Board_create(objPoints, dictionary, ids) -&gt; retval</span><br><span class="line"></span><br><span class="line">    CharucoBoard_create(...)</span><br><span class="line"></span><br><span class="line">        CharucoBoard_create(squaresX, squaresY, squareLength, markerLength, dictionary) -&gt; retval</span><br><span class="line"></span><br><span class="line">    DetectorParameters_create(...)</span><br><span class="line"></span><br><span class="line">        DetectorParameters_create() -&gt; retval</span><br><span class="line"></span><br><span class="line">    Dictionary_create(...)</span><br><span class="line"></span><br><span class="line">        Dictionary_create(nMarkers, markerSize) -&gt; retval</span><br><span class="line"></span><br><span class="line">    Dictionary_create_from(...)</span><br><span class="line"></span><br><span class="line">        Dictionary_create_from(nMarkers, markerSize, baseDictionary) -&gt; retval</span><br><span class="line"></span><br><span class="line">    Dictionary_get(...)</span><br><span class="line"></span><br><span class="line">        Dictionary_get(dict) -&gt; retval</span><br><span class="line"></span><br><span class="line">    GridBoard_create(...)</span><br><span class="line"></span><br><span class="line">        GridBoard_create(markersX, markersY, markerLength, markerSeparation, dictionary[, firstMarker]) -&gt; retval</span><br><span class="line"></span><br><span class="line">    calibrateCameraAruco(...)</span><br><span class="line"></span><br><span class="line">        calibrateCameraAruco(corners, ids, counter, board, imageSize, cameraMatrix, distCoeffs[, rvecs[, tvecs[, flags[, criteria]]]]) -&gt; retval, cameraMatrix, distCoeffs, rvecs, tvecs</span><br><span class="line"></span><br><span class="line">    calibrateCameraArucoExtended(...)</span><br><span class="line"></span><br><span class="line">        calibrateCameraArucoExtended(corners, ids, counter, board, imageSize, cameraMatrix, distCoeffs[, rvecs[, tvecs[, stdDeviationsIntrinsics[, stdDeviationsExtrinsics[, perViewErrors[, flags[, criteria]</span><br><span class="line"></span><br><span class="line">]]]]]]) -&gt; retval, cameraMatrix, distCoeffs, rvecs, tvecs, stdDeviationsIntrinsics, stdDeviationsExtrinsics, perViewErrors</span><br><span class="line"></span><br><span class="line">    calibrateCameraCharuco(...)</span><br><span class="line"></span><br><span class="line">        calibrateCameraCharuco(charucoCorners, charucoIds, board, imageSize, cameraMatrix, distCoeffs[, rvecs[, tvecs[, flags[, criteria]]]]) -&gt; retval, cameraMatrix, distCoeffs, rvecs, tvecs</span><br><span class="line"></span><br><span class="line">    calibrateCameraCharucoExtended(...)</span><br><span class="line"></span><br><span class="line">        calibrateCameraCharucoExtended(charucoCorners, charucoIds, board, imageSize, cameraMatrix, distCoeffs[, rvecs[, tvecs[, stdDeviationsIntrinsics[, stdDeviationsExtrinsics[, perViewErrors[, flags[, cr</span><br><span class="line"></span><br><span class="line">iteria]]]]]]]) -&gt; retval, cameraMatrix, distCoeffs, rvecs, tvecs, stdDeviationsIntrinsics, stdDeviationsExtrinsics, perViewErrors</span><br><span class="line"></span><br><span class="line">    custom_dictionary(...)</span><br><span class="line"></span><br><span class="line">        custom_dictionary(nMarkers, markerSize) -&gt; retval</span><br><span class="line"></span><br><span class="line">    custom_dictionary_from(...)</span><br><span class="line"></span><br><span class="line">        custom_dictionary_from(nMarkers, markerSize, baseDictionary) -&gt; retval</span><br><span class="line"></span><br><span class="line">    detectCharucoDiamond(...)</span><br><span class="line"></span><br><span class="line">        detectCharucoDiamond(image, markerCorners, markerIds, squareMarkerLengthRate[, diamondCorners[, diamondIds[, cameraMatrix[, distCoeffs]]]]) -&gt; diamondCorners, diamondIds</span><br><span class="line"></span><br><span class="line">    detectMarkers(...)</span><br><span class="line"></span><br><span class="line">        detectMarkers(image, dictionary[, corners[, ids[, parameters[, rejectedImgPoints]]]]) -&gt; corners, ids, rejectedImgPoints</span><br><span class="line"></span><br><span class="line">    drawAxis(...)</span><br><span class="line"></span><br><span class="line">        drawAxis(image, cameraMatrix, distCoeffs, rvec, tvec, length) -&gt; image</span><br><span class="line"></span><br><span class="line">    drawDetectedCornersCharuco(...)</span><br><span class="line"></span><br><span class="line">        drawDetectedCornersCharuco(image, charucoCorners[, charucoIds[, cornerColor]]) -&gt; image</span><br><span class="line"></span><br><span class="line">    drawDetectedDiamonds(...)</span><br><span class="line"></span><br><span class="line">        drawDetectedDiamonds(image, diamondCorners[, diamondIds[, borderColor]]) -&gt; image</span><br><span class="line"></span><br><span class="line">    drawDetectedMarkers(...)</span><br><span class="line"></span><br><span class="line">        drawDetectedMarkers(image, corners[, ids[, borderColor]]) -&gt; image</span><br><span class="line"></span><br><span class="line">    drawMarker(...)</span><br><span class="line"></span><br><span class="line">        drawMarker(dictionary, id, sidePixels[, img[, borderBits]]) -&gt; img</span><br><span class="line"></span><br><span class="line">    drawPlanarBoard(...)</span><br><span class="line"></span><br><span class="line">        drawPlanarBoard(board, outSize[, img[, marginSize[, borderBits]]]) -&gt; img</span><br><span class="line"></span><br><span class="line">    estimatePoseBoard(...)</span><br><span class="line"></span><br><span class="line">        estimatePoseBoard(corners, ids, board, cameraMatrix, distCoeffs[, rvec[, tvec[, useExtrinsicGuess]]]) -&gt; retval, rvec, tvec</span><br><span class="line"></span><br><span class="line">    estimatePoseCharucoBoard(...)</span><br><span class="line"></span><br><span class="line">        estimatePoseCharucoBoard(charucoCorners, charucoIds, board, cameraMatrix, distCoeffs[, rvec[, tvec[, useExtrinsicGuess]]]) -&gt; retval, rvec, tvec</span><br><span class="line"></span><br><span class="line">    estimatePoseSingleMarkers(...)</span><br><span class="line"></span><br><span class="line">        estimatePoseSingleMarkers(corners, markerLength, cameraMatrix, distCoeffs[, rvecs[, tvecs]]) -&gt; rvecs, tvecs</span><br><span class="line"></span><br><span class="line">    getPredefinedDictionary(...)</span><br><span class="line"></span><br><span class="line">        getPredefinedDictionary(dict) -&gt; retval</span><br><span class="line"></span><br><span class="line">    interpolateCornersCharuco(...)</span><br><span class="line"></span><br><span class="line">        interpolateCornersCharuco(markerCorners, markerIds, image, board[, charucoCorners[, charucoIds[, cameraMatrix[, distCoeffs[, minMarkers]]]]]) -&gt; retval, charucoCorners, charucoIds</span><br><span class="line"></span><br><span class="line">    refineDetectedMarkers(...)</span><br><span class="line"></span><br><span class="line">        refineDetectedMarkers(image, board, detectedCorners, detectedIds, rejectedCorners[, cameraMatrix[, distCoeffs[, minRepDistance[, errorCorrectionRate[, checkAllOrders[, recoveredIdxs[, parameters]]]]]]]) -&gt; detectedCorners, detectedIds, rejectedCorners, recoveredIdxs</span><br><span class="line"></span><br><span class="line">DATA</span><br><span class="line">    DICT_4X4_100 = 1</span><br><span class="line">    DICT_4X4_1000 = 3</span><br><span class="line">    DICT_4X4_250 = 2</span><br><span class="line">    DICT_4X4_50 = 0</span><br><span class="line">    DICT_5X5_100 = 5</span><br><span class="line">    DICT_5X5_1000 = 7</span><br><span class="line">    DICT_5X5_250 = 6</span><br><span class="line">    DICT_5X5_50 = 4</span><br><span class="line">    DICT_6X6_100 = 9</span><br><span class="line">    DICT_6X6_1000 = 11</span><br><span class="line">    DICT_6X6_250 = 10</span><br><span class="line">    DICT_6X6_50 = 8</span><br><span class="line">    DICT_7X7_100 = 13</span><br><span class="line">    DICT_7X7_1000 = 15</span><br><span class="line">    DICT_7X7_250 = 14</span><br><span class="line">    DICT_7X7_50 = 12</span><br><span class="line">    DICT_ARUCO_ORIGINAL = 16</span><br><span class="line"></span><br><span class="line">FILE</span><br><span class="line">    (built-in)</span><br></pre></td></tr></table></figure></p>

      
    </div>
    <footer class="article-footer">
      <a data-url="https://longervision.github.io/2017/03/13/opencv-python-aruco/" data-id="cje6onrwd000hely7sgbxj7ui" class="article-share-link">Longer Vision</a>
      
      
  <ul class="article-tag-list"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/ArUco-Marker-Pattern-OpenCV-Python/">ArUco, Marker, Pattern, OpenCV, Python</a></li></ul>

    </footer>
  </div>
  
</article>


  
    <article id="post-opencv-external-posture-estimation-circle-grid" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="/2017/03/13/opencv-external-posture-estimation-circle-grid/" class="article-date">
  <time datetime="2017-03-13T18:11:11.000Z" itemprop="datePublished">2017-03-13</time>
</a>
    
  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2017/03/13/opencv-external-posture-estimation-circle-grid/">Camera Posture Estimation Using Circle Grid Pattern</a>
    </h1>
  

      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <h2 id="Preparation"><a href="#Preparation" class="headerlink" title="Preparation"></a>Preparation</h2><p>A widely used asymmetric circle grid pattern can be found in <a href="http://docs.opencv.org/2.4/_downloads/acircles_pattern.png" target="_blank" rel="noopener">doc of OpenCV 2.4</a>. Same as previous blogs, the camera needs to be calibrated beforehand. For this asymmetric circle grid example, a sequence of images (instead of a video stream) is tested.</p>
<h2 id="Coding"><a href="#Coding" class="headerlink" title="Coding"></a>Coding</h2><p>The code can be found at <a href="https://github.com/LongerVision/OpenCV_Examples/blob/master/02_external_camera_posture_estimation/circle_grid.py" target="_blank" rel="noopener">OpenCV Examples</a>.</p>
<h3 id="First-of-all"><a href="#First-of-all" class="headerlink" title="First of all"></a>First of all</h3><p>We need to ensure <strong>cv2.so</strong> is under our system path. <strong>cv2.so</strong> is specifically for OpenCV Python.  </p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">import sys</span><br><span class="line">sys.path.append(&apos;/usr/local/python/3.5&apos;)</span><br></pre></td></tr></table></figure>
<p>Then, we import some packages to be used (<strong>NO ArUco</strong>).  </p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">import os</span><br><span class="line">import cv2</span><br><span class="line">import numpy as np</span><br></pre></td></tr></table></figure>
<h3 id="Secondly"><a href="#Secondly" class="headerlink" title="Secondly"></a>Secondly</h3><p>We now load all camera calibration parameters, including: <strong>cameraMatrix</strong>, <strong>distCoeffs</strong>, etc. For example, your code might look like the following:  </p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">calibrationFile = &quot;calibrationFileName.xml&quot;</span><br><span class="line">calibrationParams = cv2.FileStorage(calibrationFile, cv2.FILE_STORAGE_READ)</span><br><span class="line">camera_matrix = calibrationParams.getNode(&quot;cameraMatrix&quot;).mat()</span><br><span class="line">dist_coeffs = calibrationParams.getNode(&quot;distCoeffs&quot;).mat()</span><br></pre></td></tr></table></figure>
<p>Since we are testing a calibrated fisheye camera, two extra parameters are to be loaded from the calibration file.  </p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">r = calibrationParams.getNode(&quot;R&quot;).mat()</span><br><span class="line">new_camera_matrix = calibrationParams.getNode(&quot;newCameraMatrix&quot;).mat()</span><br></pre></td></tr></table></figure>
<p>Afterwards, two mapping matrices are pre-calculated by calling function <a href="http://docs.opencv.org/trunk/da/d54/group__imgproc__transform.html#ga7dfb72c9cf9780a347fbe3d1c47e5d5a" target="_blank" rel="noopener">cv2.fisheye.initUndistortRectifyMap()</a> as (supposing the images to be processed are of 1080P):<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">image_size = (1920, 1080)</span><br><span class="line">map1, map2 = cv2.fisheye.initUndistortRectifyMap(camera_matrix, dist_coeffs, r, new_camera_matrix, image_size, cv2.CV_16SC2)</span><br></pre></td></tr></table></figure></p>
<h3 id="Thirdly"><a href="#Thirdly" class="headerlink" title="Thirdly"></a>Thirdly</h3><p>The circle pattern is to be loaded.<br><img src="https://raw.githubusercontent.com/LongerVision/OpenCV_Examples/master/markers/pattern_acircles.png" alt="asymmetric_circle_grid" title="asymmetric_circle_grid"><br>Here in our case, this asymmetric circle grid pattern is manually loaded as follows:<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br></pre></td><td class="code"><pre><span class="line"># Original blob coordinates</span><br><span class="line">objectPoints = np.zeros((44, 3))  # In this asymmetric circle grid, 44 circles are adopted.</span><br><span class="line">objectPoints[0]  = (0  , 0  , 0)</span><br><span class="line">objectPoints[1]  = (0  , 72 , 0)</span><br><span class="line">objectPoints[2]  = (0  , 144, 0)</span><br><span class="line">objectPoints[3]  = (0  , 216, 0)</span><br><span class="line">objectPoints[4]  = (36 , 36 , 0)</span><br><span class="line">objectPoints[5]  = (36 , 108, 0)</span><br><span class="line">objectPoints[6]  = (36 , 180, 0)</span><br><span class="line">objectPoints[7]  = (36 , 252, 0)</span><br><span class="line">objectPoints[8]  = (72 , 0  , 0)</span><br><span class="line">objectPoints[9]  = (72 , 72 , 0)</span><br><span class="line">objectPoints[10] = (72 , 144, 0)</span><br><span class="line">objectPoints[11] = (72 , 216, 0)</span><br><span class="line">objectPoints[12] = (108, 36,  0)</span><br><span class="line">objectPoints[13] = (108, 108, 0)</span><br><span class="line">objectPoints[14] = (108, 180, 0)</span><br><span class="line">objectPoints[15] = (108, 252, 0)</span><br><span class="line">objectPoints[16] = (144, 0  , 0)</span><br><span class="line">objectPoints[17] = (144, 72 , 0)</span><br><span class="line">objectPoints[18] = (144, 144, 0)</span><br><span class="line">objectPoints[19] = (144, 216, 0)</span><br><span class="line">objectPoints[20] = (180, 36 , 0)</span><br><span class="line">objectPoints[21] = (180, 108, 0)</span><br><span class="line">objectPoints[22] = (180, 180, 0)</span><br><span class="line">objectPoints[23] = (180, 252, 0)</span><br><span class="line">objectPoints[24] = (216, 0  , 0)</span><br><span class="line">objectPoints[25] = (216, 72 , 0)</span><br><span class="line">objectPoints[26] = (216, 144, 0)</span><br><span class="line">objectPoints[27] = (216, 216, 0)</span><br><span class="line">objectPoints[28] = (252, 36 , 0)</span><br><span class="line">objectPoints[29] = (252, 108, 0)</span><br><span class="line">objectPoints[30] = (252, 180, 0)</span><br><span class="line">objectPoints[31] = (252, 252, 0)</span><br><span class="line">objectPoints[32] = (288, 0  , 0)</span><br><span class="line">objectPoints[33] = (288, 72 , 0)</span><br><span class="line">objectPoints[34] = (288, 144, 0)</span><br><span class="line">objectPoints[35] = (288, 216, 0)</span><br><span class="line">objectPoints[36] = (324, 36 , 0)</span><br><span class="line">objectPoints[37] = (324, 108, 0)</span><br><span class="line">objectPoints[38] = (324, 180, 0)</span><br><span class="line">objectPoints[39] = (324, 252, 0)</span><br><span class="line">objectPoints[40] = (360, 0  , 0)</span><br><span class="line">objectPoints[41] = (360, 72 , 0)</span><br><span class="line">objectPoints[42] = (360, 144, 0)</span><br><span class="line">objectPoints[43] = (360, 216, 0)</span><br></pre></td></tr></table></figure></p>
<p>In our case, the distance between two neighbour circle centres (in the same column) is measured as 72 centimetres. Meanwhile, the axis at the origin is loaded as well, with respective length 300, 200, 100 centimetres.  </p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">axis = np.float32([[360,0,0], [0,240,0], [0,0,-120]]).reshape(-1,3)</span><br></pre></td></tr></table></figure>
<h3 id="Fourthly"><a href="#Fourthly" class="headerlink" title="Fourthly"></a>Fourthly</h3><p>Since we are going to use OpenCV’s SimpleBlobDetector for the blob detection, the SimpleBlobDetector’s parameters are to be created beforehand. The parameter values can be adjusted according to your own testing environments. The iteration <strong>criteria</strong> for the simple blob detection is also created at the same time.  </p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line"># Setup SimpleBlobDetector parameters.</span><br><span class="line">blobParams = cv2.SimpleBlobDetector_Params()</span><br><span class="line"></span><br><span class="line"># Change thresholds</span><br><span class="line">blobParams.minThreshold = 8</span><br><span class="line">blobParams.maxThreshold = 255</span><br><span class="line"></span><br><span class="line"># Filter by Area.</span><br><span class="line">blobParams.filterByArea = True</span><br><span class="line">blobParams.minArea = 64     # minArea may be adjusted to suit for your experiment</span><br><span class="line">blobParams.maxArea = 2500   # maxArea may be adjusted to suit for your experiment</span><br><span class="line"></span><br><span class="line"># Filter by Circularity</span><br><span class="line">blobParams.filterByCircularity = True</span><br><span class="line">blobParams.minCircularity = 0.1</span><br><span class="line"></span><br><span class="line"># Filter by Convexity</span><br><span class="line">blobParams.filterByConvexity = True</span><br><span class="line">blobParams.minConvexity = 0.87</span><br><span class="line"></span><br><span class="line"># Filter by Inertia</span><br><span class="line">blobParams.filterByInertia = True</span><br><span class="line">blobParams.minInertiaRatio = 0.01</span><br><span class="line"></span><br><span class="line"># Create a detector with the parameters</span><br><span class="line">blobDetector = cv2.SimpleBlobDetector_create(blobParams)</span><br><span class="line"></span><br><span class="line"># Create the iteration criteria</span><br><span class="line">criteria = (cv2.TERM_CRITERIA_EPS + cv2.TERM_CRITERIA_MAX_ITER, 30, 0.001)</span><br><span class="line">###################################################################################################</span><br></pre></td></tr></table></figure>
<h3 id="Finally"><a href="#Finally" class="headerlink" title="Finally"></a>Finally</h3><p>Estimate camera postures. Here, we are testing a sequence of images, rather than video streams. We first list all file names in sequence.  </p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">imgDir = &quot;imgSequence&quot;  # Specify the image directory</span><br><span class="line">imgFileNames = [os.path.join(imgDir, fn) for fn in next(os.walk(imgDir))[2]]</span><br><span class="line">nbOfImgs = len(imgFileNames)</span><br></pre></td></tr></table></figure>
<p>Then, we calculate the camera posture frame by frame:<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br></pre></td><td class="code"><pre><span class="line">for i in range(0, nbOfImgs-1):</span><br><span class="line">    img = cv2.imread(imgFileNames[i], cv2.IMREAD_COLOR)</span><br><span class="line">    imgRemapped = cv2.remap(img, map1, map2, cv2.INTER_LINEAR, cv2.BORDER_CONSTANT) # for fisheye remapping</span><br><span class="line">    imgRemapped_gray = cv2.cvtColor(imgRemapped, cv2.COLOR_BGR2GRAY)    # blobDetector.detect() requires gray image</span><br><span class="line"></span><br><span class="line">    keypoints = blobDetector.detect(imgRemapped_gray) # Detect blobs.</span><br><span class="line"></span><br><span class="line">    # Draw detected blobs as red circles. This helps cv2.findCirclesGrid() .</span><br><span class="line">    im_with_keypoints = cv2.drawKeypoints(imgRemapped, keypoints, np.array([]), (0,255,0), cv2.DRAW_MATCHES_FLAGS_DRAW_RICH_KEYPOINTS)</span><br><span class="line">    im_with_keypoints_gray = cv2.cvtColor(im_with_keypoints, cv2.COLOR_BGR2GRAY)</span><br><span class="line">    ret, corners = cv2.findCirclesGrid(im_with_keypoints, (4,11), None, flags = cv2.CALIB_CB_ASYMMETRIC_GRID)   # Find the circle grid</span><br><span class="line"></span><br><span class="line">    if ret == True:</span><br><span class="line">        corners2 = cv2.cornerSubPix(im_with_keypoints_gray, corners, (11,11), (-1,-1), criteria)    # Refines the corner locations.</span><br><span class="line"></span><br><span class="line">        # Draw and display the corners.</span><br><span class="line">        im_with_keypoints = cv2.drawChessboardCorners(imLeftRemapped, (4,11), corners2, ret)</span><br><span class="line"></span><br><span class="line">        # 3D posture</span><br><span class="line">        if len(corners2) == len(objectPoints):</span><br><span class="line">            retval, rvec, tvec = cv2.solvePnP(objectPoints, corners2, camera_matrix, dist_coeffs)</span><br><span class="line"></span><br><span class="line">        if retval:</span><br><span class="line">            projectedPoints, jac = cv2.projectPoints(objectPoints, rvec, tvec, camera_matrix, dist_coeffs)  # project 3D points to image plane</span><br><span class="line">            projectedAxis, jacAsix = cv2.projectPoints(axis, rvec, tvec, camera_matrix, dist_coeffs)    # project axis to image plane</span><br><span class="line">            for p in projectedPoints:</span><br><span class="line">                p = np.int32(p).reshape(-1,2)</span><br><span class="line">                cv2.circle(im_with_keypoints, (p[0][0], p[0][1]), 3, (0,0,255))</span><br><span class="line">            origin = tuple(corners2[0].ravel())</span><br><span class="line">            im_with_keypoints = cv2.line(im_with_keypoints, origin, tuple(projectedAxis[0].ravel()), (255,0,0), 2)</span><br><span class="line">            im_with_keypoints = cv2.line(im_with_keypoints, origin, tuple(projectedAxis[1].ravel()), (0,255,0), 2)</span><br><span class="line">            im_with_keypoints = cv2.line(im_with_keypoints, origin, tuple(projectedAxis[2].ravel()), (0,0,255), 2)</span><br><span class="line"></span><br><span class="line">    cv2.imshow(&quot;circlegrid&quot;, im_with_keypoints) # display</span><br><span class="line"></span><br><span class="line">    cv2.waitKey(2)</span><br></pre></td></tr></table></figure></p>
<p>The drawn axis is just the world coordinators and orientations estimated from the images taken by the testing camera.</p>

      
    </div>
    <footer class="article-footer">
      <a data-url="https://longervision.github.io/2017/03/13/opencv-external-posture-estimation-circle-grid/" data-id="cje6onrw8000bely7ysrr4pxu" class="article-share-link">Longer Vision</a>
      
      
  <ul class="article-tag-list"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/Camera-Posture-Estimation-Circle-Grid-Marker-Pattern-OpenCV-Python/">Camera Posture Estimation, Circle Grid, Marker, Pattern, OpenCV, Python</a></li></ul>

    </footer>
  </div>
  
</article>


  
    <article id="post-opencv-external-posture-estimation-ChArUco-board" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="/2017/03/12/opencv-external-posture-estimation-ChArUco-board/" class="article-date">
  <time datetime="2017-03-13T05:22:22.000Z" itemprop="datePublished">2017-03-12</time>
</a>
    
  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2017/03/12/opencv-external-posture-estimation-ChArUco-board/">Camera Posture Estimation Using A ChArUco Board</a>
    </h1>
  

      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <h2 id="Preparation"><a href="#Preparation" class="headerlink" title="Preparation"></a>Preparation</h2><p>ChAruco is an integrated marker, which combines a chessboard with an aruco marker. The code is also very similar to the code in our previous blog <a href="https://longervision.github.io/2017/03/12/opencv-external-posture-estimation-ArUco-board/">aruco board</a>.</p>
<h2 id="Coding"><a href="#Coding" class="headerlink" title="Coding"></a>Coding</h2><p>The code can be found at <a href="https://github.com/LongerVision/OpenCV_Examples/blob/master/02_external_camera_posture_estimation/ChArUco_board.py" target="_blank" rel="noopener">OpenCV Examples</a>. And the code in the first two subsections are exactly the same as what’s written in our previous blogs. We’ll neglect the first two subsections ever since.</p>
<h3 id="First-of-all"><a href="#First-of-all" class="headerlink" title="First of all"></a>First of all</h3><p>Exactly the same as in previous blogs.</p>
<h3 id="Secondly"><a href="#Secondly" class="headerlink" title="Secondly"></a>Secondly</h3><p>Exactly the same as in previous blogs.</p>
<h3 id="Thirdly"><a href="#Thirdly" class="headerlink" title="Thirdly"></a>Thirdly</h3><p>Dictionary <strong>aruco.DICT_6X6_1000</strong> is integrated with a chessboard to construct a grid charuco board. The experimenting board is of size <strong>5*7</strong>, which looks like:<br><img src="https://raw.githubusercontent.com/LongerVision/OpenCV_Examples/master/markers/board_charuco_57.png" alt="charuco.DICT_6X6_1000.board57" title="charuco.DICT_6X6_1000.board57">  </p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">aruco_dict = aruco.Dictionary_get( aruco.DICT_6X6_1000 )</span><br></pre></td></tr></table></figure>
<p>After having this aruco board marker printed, the edge lengths of this chessboard and aruco marker (displayed in the white cell of the chessboard) are to be measured and stored in two variables <strong>squareLength</strong> and <strong>markerLength</strong>, which are used to create the <strong>5*7</strong> grid board.  </p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">squareLength = 40   # Here, our measurement unit is centimetre.</span><br><span class="line">markerLength = 30   # Here, our measurement unit is centimetre.</span><br><span class="line">board = aruco.CharucoBoard_create(5, 7, squareLength, markerLength, aruco_dict)</span><br></pre></td></tr></table></figure>
<p>Meanwhile, create aruco detector with default parameters.  </p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">arucoParams = aruco.DetectorParameters_create()</span><br></pre></td></tr></table></figure>
<h3 id="Finally"><a href="#Finally" class="headerlink" title="Finally"></a>Finally</h3><p>Now, let’s test on a video stream, a .mp4 file.<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">videoFile = &quot;charuco_board_57.mp4&quot;</span><br><span class="line">cap = cv2.VideoCapture(videoFile)</span><br></pre></td></tr></table></figure></p>
<p>Then, we calculate the camera posture frame by frame:  </p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line">while(True):</span><br><span class="line">    ret, frame = cap.read() # Capture frame-by-frame</span><br><span class="line">    if ret == True:</span><br><span class="line">        frame_remapped = cv2.remap(frame, map1, map2, cv2.INTER_LINEAR, cv2.BORDER_CONSTANT)    # for fisheye remapping</span><br><span class="line">        frame_remapped_gray = cv2.cvtColor(frame_remapped, cv2.COLOR_BGR2GRAY)</span><br><span class="line"></span><br><span class="line">        corners, ids, rejectedImgPoints = aruco.detectMarkers(frame_remapped_gray, aruco_dict, parameters=arucoParams)  # First, detect markers</span><br><span class="line">        aruco.refineDetectedMarkers(frame_remapped_gray, board, corners, ids, rejectedImgPoints)</span><br><span class="line"></span><br><span class="line">        if ids != None: # if there is at least one marker detected</span><br><span class="line">            charucoretval, charucoCorners, charucoIds = aruco.interpolateCornersCharuco(corners, ids, frame_remapped_gray, board)</span><br><span class="line">            im_with_charuco_board = aruco.drawDetectedCornersCharuco(frame_remapped, charucoCorners, charucoIds, (0,255,0))</span><br><span class="line">            retval, rvec, tvec = aruco.estimatePoseCharucoBoard(charucoCorners, charucoIds, board, camera\_matrix, dist_coeffs)  # posture estimation from a charuco board</span><br><span class="line">            if retval == True:</span><br><span class="line">                im_with_charuco_board = aruco.drawAxis(im_with_charuco_board, camera_matrix, dist_coeffs, rvec, tvec, 100)  # axis length 100 can be changed according to your requirement</span><br><span class="line">        else:</span><br><span class="line">            im_with_charuco_left = frame_remapped</span><br><span class="line"></span><br><span class="line">        cv2.imshow(&quot;charucoboard&quot;, im\_with\_charuco_board)</span><br><span class="line"></span><br><span class="line">        if cv2.waitKey(2) &amp; 0xFF == ord(&apos;q&apos;):</span><br><span class="line">            break</span><br><span class="line">    else:</span><br><span class="line">        break</span><br></pre></td></tr></table></figure>
<p>The drawn axis is just the world coordinators and orientations estimated from the images taken by the testing camera.<br>At the end of the code, we release the video capture handle and destroy all opening windows.  </p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">cap.release()   # When everything done, release the capture</span><br><span class="line">cv2.destroyAllWindows()</span><br></pre></td></tr></table></figure>
      
    </div>
    <footer class="article-footer">
      <a data-url="https://longervision.github.io/2017/03/12/opencv-external-posture-estimation-ChArUco-board/" data-id="cje6onrw70009ely76x4ycpl0" class="article-share-link">Longer Vision</a>
      
      
  <ul class="article-tag-list"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/Camera-Posture-Estimation-ChArUco-Board-Pattern-OpenCV-Python/">Camera Posture Estimation, ChArUco Board, Pattern, OpenCV, Python</a></li></ul>

    </footer>
  </div>
  
</article>


  
    <article id="post-opencv-external-posture-estimation-ArUco-board" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="/2017/03/12/opencv-external-posture-estimation-ArUco-board/" class="article-date">
  <time datetime="2017-03-12T18:11:11.000Z" itemprop="datePublished">2017-03-12</time>
</a>
    
  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2017/03/12/opencv-external-posture-estimation-ArUco-board/">Camera Posture Estimation Using An ArUco Board</a>
    </h1>
  

      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <h2 id="Preparation"><a href="#Preparation" class="headerlink" title="Preparation"></a>Preparation</h2><p>Today, let’s test on an aruco board, instead of a <a href="https://longervision.github.io/2017/03/10/opencv-external-posture-estimation-ArUco-single-marker/">single marker</a> or a <a href="https://longervision.github.io/2017/03/11/opencv-external-posture-estimation-ArUco-diamond/">diamond marker</a>. Again, you need to make sure your camera has already been calibrated. In the coding section, it’s assumed that you can successfully load the camera calibration parameters.</p>
<h2 id="Coding"><a href="#Coding" class="headerlink" title="Coding"></a>Coding</h2><p>The code can be found at <a href="https://github.com/LongerVision/OpenCV_Examples/blob/master/02_external_camera_posture_estimation/ArUco_board.py" target="_blank" rel="noopener">OpenCV Examples</a>.</p>
<h3 id="First-of-all"><a href="#First-of-all" class="headerlink" title="First of all"></a>First of all</h3><p>We need to ensure <strong>cv2.so</strong> is under our system path. <strong>cv2.so</strong> is specifically for OpenCV Python.</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">import sys</span><br><span class="line">sys.path.append(&apos;/usr/local/python/3.5&apos;)</span><br></pre></td></tr></table></figure>
<p>Then, we import some packages to be used.<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">import os</span><br><span class="line">import cv2</span><br><span class="line">from cv2 import aruco</span><br><span class="line">import numpy as np</span><br></pre></td></tr></table></figure></p>
<h3 id="Secondly"><a href="#Secondly" class="headerlink" title="Secondly"></a>Secondly</h3><p>Again, we need to load all camera calibration parameters, including: <strong>cameraMatrix</strong>, <strong>distCoeffs</strong>, etc. :</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">calibrationFile = &quot;calibrationFileName.xml&quot;</span><br><span class="line">calibrationParams = cv2.FileStorage(calibrationFile, cv2.FILE\_STORAGE\_READ)</span><br><span class="line">camera_matrix = calibrationParams.getNode(&quot;cameraMatrix&quot;).mat()</span><br><span class="line">dist_coeffs = calibrationParams.getNode(&quot;distCoeffs&quot;).mat()</span><br></pre></td></tr></table></figure>
<p>If you are using a calibrated fisheye camera like us, two extra parameters are to be loaded from the calibration file.</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">r = calibrationParams.getNode(&quot;R&quot;).mat()</span><br><span class="line">new\_camera\_matrix = calibrationParams.getNode(&quot;newCameraMatrix&quot;).mat()</span><br></pre></td></tr></table></figure>
<p>Afterwards, two mapping matrices are pre-calculated by calling function <a href="http://docs.opencv.org/trunk/da/d54/group__imgproc__transform.html#ga7dfb72c9cf9780a347fbe3d1c47e5d5a" target="_blank" rel="noopener">cv2.fisheye.initUndistortRectifyMap()</a> as (supposing the images to be processed are of 1080P):</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">image_size = (1920, 1080)</span><br><span class="line">map1, map2 = cv2.fisheye.initUndistortRectifyMap(camera_matrix, dist_coeffs, r, new_camera_matrix, image_size, cv2.CV_16SC2)</span><br></pre></td></tr></table></figure>
<h3 id="Thirdly"><a href="#Thirdly" class="headerlink" title="Thirdly"></a>Thirdly</h3><p>In our test, the dictionary <strong>aruco.DICT_6X6_1000</strong> is adopted as the unit pattern to construct a grid board. The board is of size <strong>5*7</strong>, which looks like:<br><img src="https://raw.githubusercontent.com/LongerVision/OpenCV_Examples/master/markers/board_aruco_57.png" alt="aruco.DICT_6X6_1000.board57" title="aruco.DICT_6X6_1000.board57"></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">aruco_dict = aruco.Dictionary_get( aruco.DICT_6X6_1000 )</span><br></pre></td></tr></table></figure>
<p>After having this aruco board marker printed, the edge lengths of this particular aruco marker and the distance between two neighbour markers are to be measured and stored in two variables <strong>markerLength</strong> and <strong>markerSeparation</strong>, which are used to create the <strong>5*7</strong> grid board.  </p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">markerLength = 40   # Here, our measurement unit is centimetre.</span><br><span class="line">markerSeparation = 8   # Here, our measurement unit is centimetre.</span><br><span class="line">board = aruco.GridBoard\_create(5, 7, markerLength, markerSeparation, aruco\_dict)</span><br></pre></td></tr></table></figure>
<p>Meanwhile, create aruco detector with default parameters.  </p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">arucoParams = aruco.DetectorParameters_create()</span><br></pre></td></tr></table></figure>
<h3 id="Finally"><a href="#Finally" class="headerlink" title="Finally"></a>Finally</h3><p>Now, let’s test on a video stream, a .mp4 file. We first load the video file and initialize a video capture handle.  </p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">videoFile = &quot;aruco\_board\_57.mp4&quot;</span><br><span class="line">cap = cv2.VideoCapture(videoFile)</span><br></pre></td></tr></table></figure>
<p>Then, we calculate the camera posture frame by frame:<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line">while(True):</span><br><span class="line">    ret, frame = cap.read() # Capture frame-by-frame</span><br><span class="line">    if ret == True:</span><br><span class="line">        frame\_remapped = cv2.remap(frame, map1, map2, cv2.INTER\_LINEAR, cv2.BORDER_CONSTANT)     # for fisheye remapping</span><br><span class="line">        frame\_remapped\_gray = cv2.cvtColor(frame\_remapped, cv2.COLOR\_BGR2GRAY)</span><br><span class="line"></span><br><span class="line">        corners, ids, rejectedImgPoints = aruco.detectMarkers(frame\_remapped\_gray, aruco_dict, parameters=arucoParams)  # First, detect markers</span><br><span class="line">        aruco.refineDetectedMarkers(frame\_remapped\_gray, board, corners, ids, rejectedImgPoints)</span><br><span class="line"></span><br><span class="line">        if ids != None: # if there is at least one marker detected</span><br><span class="line">            im\_with\_aruco\_board = aruco.drawDetectedMarkers(frame\_remapped, corners, ids, (0,255,0))</span><br><span class="line">            retval, rvec, tvec = aruco.estimatePoseBoard(corners, ids, board, camera\_matrix, dist\_coeffs)  # posture estimation from a diamond</span><br><span class="line">            if retval != 0:</span><br><span class="line">                im_with_aruco_board = aruco.drawAxis(im_with_aruco_board, camera_matrix, dist_coeffs, rvec, tvec, 100)  # axis length 100 can be changed according to your requirement</span><br><span class="line">        else:</span><br><span class="line">            im_with_aruco_board = frame_remapped</span><br><span class="line"></span><br><span class="line">        cv2.imshow(&quot;arucoboard&quot;, im_with_aruco_board)</span><br><span class="line"></span><br><span class="line">        if cv2.waitKey(2) &amp; 0xFF == ord(&apos;q&apos;):</span><br><span class="line">            break</span><br><span class="line">    else:</span><br><span class="line">        break</span><br></pre></td></tr></table></figure></p>
<p>The drawn axis is just the world coordinators and orientations estimated from the images taken by the testing camera.<br>At the end of the code, we release the video capture handle and destroy all opening windows.  </p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">cap.release()   # When everything done, release the capture</span><br><span class="line">cv2.destroyAllWindows()</span><br></pre></td></tr></table></figure>

      
    </div>
    <footer class="article-footer">
      <a data-url="https://longervision.github.io/2017/03/12/opencv-external-posture-estimation-ArUco-board/" data-id="cje6onrw30004ely7sdcz4leh" class="article-share-link">Longer Vision</a>
      
      
  <ul class="article-tag-list"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/Camera-Posture-Estimation-ArUco-Board-Pattern-OpenCV-Python/">Camera Posture Estimation, ArUco Board, Pattern, OpenCV, Python</a></li></ul>

    </footer>
  </div>
  
</article>


  
    <article id="post-opencv-external-posture-estimation-ArUco-diamond" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="/2017/03/11/opencv-external-posture-estimation-ArUco-diamond/" class="article-date">
  <time datetime="2017-03-11T19:11:11.000Z" itemprop="datePublished">2017-03-11</time>
</a>
    
  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/2017/03/11/opencv-external-posture-estimation-ArUco-diamond/">Camera Posture Estimation Using An ArUco Diamond Marker</a>
    </h1>
  

      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <h2 id="Preparation"><a href="#Preparation" class="headerlink" title="Preparation"></a>Preparation</h2><p>Very similar to our previous post <a href="../../10/opencv-external-posture-estimation-ArUco-single-marker/">Camera Posture Estimation Using A Single aruco Marker</a>, you need to make sure your camera has already been calibrated. In the coding section, it’s assumed that you can successfully load the camera calibration parameters.</p>
<h2 id="Coding"><a href="#Coding" class="headerlink" title="Coding"></a>Coding</h2><p>The code can be found at <a href="https://github.com/LongerVision/OpenCV_Examples/blob/master/02_external_camera_posture_estimation/ArUco_diamond.py" target="_blank" rel="noopener">OpenCV Examples</a>.</p>
<h3 id="First-of-all"><a href="#First-of-all" class="headerlink" title="First of all"></a>First of all</h3><p>We need to ensure <strong>cv2.so</strong> is under our system path. <strong>cv2.so</strong> is specifically for OpenCV Python.  </p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">import sys</span><br><span class="line">sys.path.append(&apos;/usr/local/python/3.5&apos;)</span><br></pre></td></tr></table></figure>
<p>Then, we import some packages to be used.<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">import os</span><br><span class="line">import cv2</span><br><span class="line">from cv2 import aruco</span><br><span class="line">import numpy as np</span><br></pre></td></tr></table></figure></p>
<h3 id="Secondly"><a href="#Secondly" class="headerlink" title="Secondly"></a>Secondly</h3><p>Again, we need to load all camera calibration parameters, including: <strong>cameraMatrix</strong>, <strong>distCoeffs</strong>, etc. :  </p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">calibrationFile = &quot;calibrationFileName.xml&quot;</span><br><span class="line">calibrationParams = cv2.FileStorage(calibrationFile, cv2.FILE_STORAGE_READ)</span><br><span class="line">camera_matrix = calibrationParams.getNode(&quot;cameraMatrix&quot;).mat()</span><br><span class="line">dist_coeffs = calibrationParams.getNode(&quot;distCoeffs&quot;).mat()</span><br></pre></td></tr></table></figure>
<p>If you are using a calibrated fisheye camera like us, two extra parameters are to be loaded from the calibration file.  </p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">r = calibrationParams.getNode(&quot;R&quot;).mat()</span><br><span class="line">new_camera_matrix = calibrationParams.getNode(&quot;newCameraMatrix&quot;).mat()</span><br></pre></td></tr></table></figure>
<p>Afterwards, two mapping matrices are pre-calculated by calling function <a href="http://docs.opencv.org/trunk/da/d54/group__imgproc__transform.html#ga7dfb72c9cf9780a347fbe3d1c47e5d5a" target="_blank" rel="noopener">cv2.fisheye.initUndistortRectifyMap()</a> as (supposing the images to be processed are of 1080P):</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">image_size = (1920, 1080)</span><br><span class="line">map1, map2 = cv2.fisheye.initUndistortRectifyMap(camera_matrix, dist_coeffs, r, new_camera_matrix, image_size, cv2.CV_16SC2)</span><br></pre></td></tr></table></figure>
<h3 id="Thirdly"><a href="#Thirdly" class="headerlink" title="Thirdly"></a>Thirdly</h3><p>The dictionary <strong>aruco.DICT_6X6_250</strong> is to be loaded. Although current OpenCV provides four groups of <a href="http://docs.opencv.org/trunk/d9/d6a/group__aruco.html" target="_blank" rel="noopener">aruco</a> patterns, <strong>4X4</strong>, <strong>5X5</strong>, <strong>6X6</strong>, <strong>7X7</strong>, etc., it seems OpenCV Python does NOT provide a function named <a href="http://docs.opencv.org/trunk/d9/d6a/group__aruco.html#gaf71fb897d5f03f7424c0c84715aa6228" target="_blank" rel="noopener">drawCharucoDiamond()</a>. Therefore, we have to refer to the C++ tutorial <a href="http://docs.opencv.org/trunk/d5/d07/tutorial_charuco_diamond_detection.html" target="_blank" rel="noopener">Detection of Diamond Markers</a>. And, we directly use this particular diamond marker in the tutorial:<br><img src="https://raw.githubusercontent.com/LongerVision/OpenCV_Examples/master/markers/board_charuco_diamond.png" alt="aruco.DICT_6X6_250.diamond" title="aruco.DICT_6X6_250.diamond"></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">aruco_dict = aruco.Dictionary_get( aruco.DICT_6X6_250 )</span><br></pre></td></tr></table></figure>
<p>After having this aruco diamond marker printed, the edge lengths of this particular diamond marker are to be measured and stored in two variables <strong>squareLength</strong> and <strong>markerLength</strong>.  </p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">squareLength = 40   # Here, our measurement unit is centimetre.</span><br><span class="line">markerLength = 25   # Here, our measurement unit is centimetre.</span><br></pre></td></tr></table></figure>
<p>Meanwhile, create aruco detector with default parameters.<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">arucoParams = aruco.DetectorParameters_create()</span><br></pre></td></tr></table></figure></p>
<h3 id="Finally"><a href="#Finally" class="headerlink" title="Finally"></a>Finally</h3><p>This time, let’s test on a video stream, a .mp4 file. We first load the video file and initialize a video capture handle.  </p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">videoFile = &quot;aruco_diamond.mp4&quot;</span><br><span class="line">cap = cv2.VideoCapture(videoFile)</span><br></pre></td></tr></table></figure>
<p>Then, we calculate the camera posture frame by frame:  </p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line">while(True):</span><br><span class="line">    ret, frame = cap.read() # Capture frame-by-frame</span><br><span class="line">    if ret == True:</span><br><span class="line">        frame_remapped = cv2.remap(frame, map1, map2, cv2.INTER_LINEAR, cv2.BORDER_CONSTANT)     # for fisheye remapping</span><br><span class="line">        frame_remapped_gray = cv2.cvtColor(frame_remapped, cv2.COLOR\_BGR2GRAY)</span><br><span class="line"></span><br><span class="line">        corners, ids, rejectedImgPoints = aruco.detectMarkers(frame_remapped_gray, aruco_dict, parameters=arucoParams)  # First, detect markers</span><br><span class="line"></span><br><span class="line">        if ids != None: # if there is at least one marker detected</span><br><span class="line">            diamondCorners, diamondIds = aruco.detectCharucoDiamond(frame_remapped_gray, corners, ids, squareLength/markerLength)   # Second, detect diamond markers</span><br><span class="line">            if len(diamondCorners) &gt;= 1:    # if there is at least one diamond detected</span><br><span class="line">                im_with_diamond = aruco.drawDetectedDiamonds(frame_remapped, diamondCorners, diamondIds, (0,255,0))</span><br><span class="line">                rvec, tvec = aruco.estimatePoseSingleMarkers(diamondCorners, squareLength, camera_matrix, dist_coeffs)  # posture estimation from a diamond</span><br><span class="line">                im_with_diamond = aruco.drawAxis(im_with_diamond, camera_matrix, dist_coeffs, rvec, tvec, 100)  # axis length 100 can be changed according to your requirement</span><br><span class="line">        else:</span><br><span class="line">            im_with_diamond = frame_remapped</span><br><span class="line"></span><br><span class="line">        cv2.imshow(&quot;diamondLeft&quot;, im_with_diamond)   # display</span><br><span class="line"></span><br><span class="line">        if cv2.waitKey(2) &amp; 0xFF == ord(&apos;q&apos;):   # press &apos;q&apos; to quit</span><br><span class="line">            break</span><br><span class="line">    else:</span><br><span class="line">        break</span><br></pre></td></tr></table></figure>
<p>The drawn axis is just the world coordinators and orientations estimated from the images taken by the testing camera.<br>At the end of the code, we release the video capture handle and destroy all opening windows.</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">cap.release()   # When everything done, release the capture</span><br><span class="line">cv2.destroyAllWindows()</span><br></pre></td></tr></table></figure>

      
    </div>
    <footer class="article-footer">
      <a data-url="https://longervision.github.io/2017/03/11/opencv-external-posture-estimation-ArUco-diamond/" data-id="cje6onrw40005ely7xwdkstj1" class="article-share-link">Longer Vision</a>
      
      
  <ul class="article-tag-list"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/Camera-Posture-Estimation-ArUco-Diamond-Marker-Pattern-OpenCV-Python/">Camera Posture Estimation, ArUco, Diamond Marker, Pattern, OpenCV, Python</a></li></ul>

    </footer>
  </div>
  
</article>


  


  <nav id="page-nav">
    
    <span class="page-number current">1</span><a class="page-number" href="/page/2/">2</a><a class="extend next" rel="next" href="/page/2/">Next &raquo;</a>
  </nav>

</section>
        
          <aside id="sidebar">
  
    

  
    
  <div class="widget-wrap">
    <h3 class="widget-title">Tags</h3>
    <div class="widget">
      <ul class="tag-list"><li class="tag-list-item"><a class="tag-list-link" href="/tags/ArUco-Marker-Pattern-OpenCV-Python/">ArUco, Marker, Pattern, OpenCV, Python</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Beaglebone-Beaglebone-Black-Linaro-GCC-U-Boot-Linux-Kernel-BSP/">Beaglebone, Beaglebone Black, Linaro GCC, U-Boot, Linux Kernel, BSP</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Camera-Calibration-Chessboard-Marker-Pattern-OpenCV-Python/">Camera Calibration, Chessboard, Marker, Pattern, OpenCV, Python</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Camera-Calibration-Circle-Grid-Marker-Pattern-OpenCV-Python/">Camera Calibration, Circle Grid, Marker, Pattern, OpenCV, Python</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Camera-Posture-Estimation-ArUco-Board-Pattern-OpenCV-Python/">Camera Posture Estimation, ArUco Board, Pattern, OpenCV, Python</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Camera-Posture-Estimation-ArUco-Diamond-Marker-Pattern-OpenCV-Python/">Camera Posture Estimation, ArUco, Diamond Marker, Pattern, OpenCV, Python</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Camera-Posture-Estimation-ArUco-Marker-Pattern-OpenCV-Python/">Camera Posture Estimation, ArUco, Marker, Pattern, OpenCV, Python</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Camera-Posture-Estimation-ChArUco-Board-Pattern-OpenCV-Python/">Camera Posture Estimation, ChArUco Board, Pattern, OpenCV, Python</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Camera-Posture-Estimation-Circle-Grid-Marker-Pattern-OpenCV-Python/">Camera Posture Estimation, Circle Grid, Marker, Pattern, OpenCV, Python</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Longer-Vision-Technology-Computer-Vision-Machine-Vision/">Longer Vision Technology, Computer Vision, Machine Vision</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/NanoPi-NEO-AllWinner-H3-Armbian-Debian-Mainline-Linux-Kernel-BSP/">NanoPi NEO, AllWinner H3, Armbian, Debian, Mainline Linux Kernel, BSP</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Orange-Pi-Plus-2-AllWinner-H3-Armbian-Ubuntu-Mainline-Linux-Kernel-BSP/">Orange Pi Plus 2, AllWinner H3, Armbian, Ubuntu, Mainline Linux Kernel, BSP</a></li></ul>
    </div>
  </div>


  
    
  <div class="widget-wrap">
    <h3 class="widget-title">Tag Cloud</h3>
    <div class="widget tagcloud">
      <a href="/tags/ArUco-Marker-Pattern-OpenCV-Python/" style="font-size: 10px;">ArUco, Marker, Pattern, OpenCV, Python</a> <a href="/tags/Beaglebone-Beaglebone-Black-Linaro-GCC-U-Boot-Linux-Kernel-BSP/" style="font-size: 10px;">Beaglebone, Beaglebone Black, Linaro GCC, U-Boot, Linux Kernel, BSP</a> <a href="/tags/Camera-Calibration-Chessboard-Marker-Pattern-OpenCV-Python/" style="font-size: 10px;">Camera Calibration, Chessboard, Marker, Pattern, OpenCV, Python</a> <a href="/tags/Camera-Calibration-Circle-Grid-Marker-Pattern-OpenCV-Python/" style="font-size: 10px;">Camera Calibration, Circle Grid, Marker, Pattern, OpenCV, Python</a> <a href="/tags/Camera-Posture-Estimation-ArUco-Board-Pattern-OpenCV-Python/" style="font-size: 10px;">Camera Posture Estimation, ArUco Board, Pattern, OpenCV, Python</a> <a href="/tags/Camera-Posture-Estimation-ArUco-Diamond-Marker-Pattern-OpenCV-Python/" style="font-size: 10px;">Camera Posture Estimation, ArUco, Diamond Marker, Pattern, OpenCV, Python</a> <a href="/tags/Camera-Posture-Estimation-ArUco-Marker-Pattern-OpenCV-Python/" style="font-size: 10px;">Camera Posture Estimation, ArUco, Marker, Pattern, OpenCV, Python</a> <a href="/tags/Camera-Posture-Estimation-ChArUco-Board-Pattern-OpenCV-Python/" style="font-size: 10px;">Camera Posture Estimation, ChArUco Board, Pattern, OpenCV, Python</a> <a href="/tags/Camera-Posture-Estimation-Circle-Grid-Marker-Pattern-OpenCV-Python/" style="font-size: 10px;">Camera Posture Estimation, Circle Grid, Marker, Pattern, OpenCV, Python</a> <a href="/tags/Longer-Vision-Technology-Computer-Vision-Machine-Vision/" style="font-size: 10px;">Longer Vision Technology, Computer Vision, Machine Vision</a> <a href="/tags/NanoPi-NEO-AllWinner-H3-Armbian-Debian-Mainline-Linux-Kernel-BSP/" style="font-size: 10px;">NanoPi NEO, AllWinner H3, Armbian, Debian, Mainline Linux Kernel, BSP</a> <a href="/tags/Orange-Pi-Plus-2-AllWinner-H3-Armbian-Ubuntu-Mainline-Linux-Kernel-BSP/" style="font-size: 10px;">Orange Pi Plus 2, AllWinner H3, Armbian, Ubuntu, Mainline Linux Kernel, BSP</a>
    </div>
  </div>

  
    
  <div class="widget-wrap">
    <h3 class="widget-title">Archives</h3>
    <div class="widget">
      <ul class="archive-list"><li class="archive-list-item"><a class="archive-list-link" href="/archives/2018/02/">February 2018</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2018/01/">January 2018</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2017/03/">March 2017</a></li></ul>
    </div>
  </div>


  
    
  <div class="widget-wrap">
    <h3 class="widget-title">Recent Posts</h3>
    <div class="widget">
      <ul>
        
          <li>
            <a href="/2018/02/24/nanopi-neo-armbian/">Install Armbian Debian Server with the Newest Supported Mainline Linux Kernel onto NanoPi NEO</a>
          </li>
        
          <li>
            <a href="/2018/01/11/orange-pi-plus-2-armbian/">Install Armbian Ubuntu Desktop with the Newest Supported Mainline Linux Kernel onto Orange Pi Plus 2</a>
          </li>
        
          <li>
            <a href="/2018/01/10/beaglebone-black-uboot-kernel/">Build U-Boot and Linux Kernel for Beaglebone and Beaglebone Black</a>
          </li>
        
          <li>
            <a href="/2017/03/20/opencv-internal-calibration-circle-grid/">Camera Calibration Using a Circle Grid</a>
          </li>
        
          <li>
            <a href="/2017/03/19/opencv-internal-calibration-chessboard/">Camera Calibration Using a Chessboard</a>
          </li>
        
      </ul>
    </div>
  </div>

  
</aside>
        
      </div>
      <footer id="footer">
  
  <div class="outer">
    <div id="footer-info" class="inner">
      &copy; 2018 Longer Vision<br>
      Powered by <a href="http://www.longervision.com/" target="_blank">Longer Vision</a>
    </div>
  </div>
</footer>
    </div>
    <nav id="mobile-nav">
  
    <a href="/" class="mobile-nav-link">Home</a>
  
    <a href="/archives" class="mobile-nav-link">Archives</a>
  
</nav>
    

<script src="//ajax.googleapis.com/ajax/libs/jquery/2.0.3/jquery.min.js"></script>


  <link rel="stylesheet" href="/fancybox/jquery.fancybox.css">
  <script src="/fancybox/jquery.fancybox.pack.js"></script>


<script src="/js/script.js"></script>



  </div>
</body>
</html>